import React, { useState } from 'react'

const ERROR_IMG_SRC =
  'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODgiIGhlaWdodD0iODgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBvcGFjaXR5PSIuMyIgZmlsbD0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIzLjciPjxyZWN0IHg9IjE2IiB5PSIxNiIgd2lkdGg9IjU2IiBoZWlnaHQ9IjU2IiByeD0iNiIvPjxwYXRoIGQ9Im0xNiA1OCAxNi0xOCAzMiAzMiIvPjxjaXJjbGUgY3g9IjUzIiBjeT0iMzUiIHI9IjciLz48L3N2Zz4KCg=='

export function ImageWithFallback(props: React.ImgHTMLAttributes<HTMLImageElement>) {
  const [didError, setDidError] = useState(false)

  const handleError = () => {
    setDidError(true)
  }

  const { src, alt, style, className, ...rest } = props

  return didError ? (
    <div
      className={`inline-block bg-gray-100 text-center align-middle ${className ?? ''}`}
      style={style}
    >
      <div className="flex items-center justify-center w-full h-full">
        <img src={ERROR_IMG_SRC} alt="Error loading image" {...rest} data-original-url={src} />
      </div>
    </div>
  ) : (
    <img src={src} alt={alt} className={className} style={style} {...rest} onError={handleError} />
  )
}

"use client";

import * as React from "react";
import * as AccordionPrimitive from "@radix-ui/react-accordion";
import { ChevronDownIcon } from "lucide-react";

import { cn } from "./utils";

function Accordion({
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Root>) {
  return <AccordionPrimitive.Root data-slot="accordion" {...props} />;
}

function AccordionItem({
  className,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Item>) {
  return (
    <AccordionPrimitive.Item
      data-slot="accordion-item"
      className={cn("border-b last:border-b-0", className)}
      {...props}
    />
  );
}

function AccordionTrigger({
  className,
  children,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Trigger>) {
  return (
    <AccordionPrimitive.Header className="flex">
      <AccordionPrimitive.Trigger
        data-slot="accordion-trigger"
        className={cn(
          "focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",
          className,
        )}
        {...props}
      >
        {children}
        <ChevronDownIcon className="text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200" />
      </AccordionPrimitive.Trigger>
    </AccordionPrimitive.Header>
  );
}

function AccordionContent({
  className,
  children,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Content>) {
  return (
    <AccordionPrimitive.Content
      data-slot="accordion-content"
      className="data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm"
      {...props}
    >
      <div className={cn("pt-0 pb-4", className)}>{children}</div>
    </AccordionPrimitive.Content>
  );
}

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent };

"use client";

import * as React from "react";
import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog";

import { cn } from "./utils";
import { buttonVariants } from "./button";

function AlertDialog({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Root>) {
  return <AlertDialogPrimitive.Root data-slot="alert-dialog" {...props} />;
}

function AlertDialogTrigger({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Trigger>) {
  return (
    <AlertDialogPrimitive.Trigger data-slot="alert-dialog-trigger" {...props} />
  );
}

function AlertDialogPortal({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Portal>) {
  return (
    <AlertDialogPrimitive.Portal data-slot="alert-dialog-portal" {...props} />
  );
}

function AlertDialogOverlay({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Overlay>) {
  return (
    <AlertDialogPrimitive.Overlay
      data-slot="alert-dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className,
      )}
      {...props}
    />
  );
}

function AlertDialogContent({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Content>) {
  return (
    <AlertDialogPortal>
      <AlertDialogOverlay />
      <AlertDialogPrimitive.Content
        data-slot="alert-dialog-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className,
        )}
        {...props}
      />
    </AlertDialogPortal>
  );
}

function AlertDialogHeader({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function AlertDialogFooter({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-dialog-footer"
      className={cn(
        "flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",
        className,
      )}
      {...props}
    />
  );
}

function AlertDialogTitle({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Title>) {
  return (
    <AlertDialogPrimitive.Title
      data-slot="alert-dialog-title"
      className={cn("text-lg font-semibold", className)}
      {...props}
    />
  );
}

function AlertDialogDescription({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Description>) {
  return (
    <AlertDialogPrimitive.Description
      data-slot="alert-dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

function AlertDialogAction({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Action>) {
  return (
    <AlertDialogPrimitive.Action
      className={cn(buttonVariants(), className)}
      {...props}
    />
  );
}

function AlertDialogCancel({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Cancel>) {
  return (
    <AlertDialogPrimitive.Cancel
      className={cn(buttonVariants({ variant: "outline" }), className)}
      {...props}
    />
  );
}

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
};

import * as React from "react";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "./utils";

const alertVariants = cva(
  "relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",
  {
    variants: {
      variant: {
        default: "bg-card text-card-foreground",
        destructive:
          "text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  },
);

function Alert({
  className,
  variant,
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof alertVariants>) {
  return (
    <div
      data-slot="alert"
      role="alert"
      className={cn(alertVariants({ variant }), className)}
      {...props}
    />
  );
}

function AlertTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-title"
      className={cn(
        "col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",
        className,
      )}
      {...props}
    />
  );
}

function AlertDescription({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-description"
      className={cn(
        "text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",
        className,
      )}
      {...props}
    />
  );
}

export { Alert, AlertTitle, AlertDescription };

"use client";

import * as AspectRatioPrimitive from "@radix-ui/react-aspect-ratio";

function AspectRatio({
  ...props
}: React.ComponentProps<typeof AspectRatioPrimitive.Root>) {
  return <AspectRatioPrimitive.Root data-slot="aspect-ratio" {...props} />;
}

export { AspectRatio };

"use client";

import * as React from "react";
import * as AvatarPrimitive from "@radix-ui/react-avatar";

import { cn } from "./utils";

function Avatar({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Root>) {
  return (
    <AvatarPrimitive.Root
      data-slot="avatar"
      className={cn(
        "relative flex size-10 shrink-0 overflow-hidden rounded-full",
        className,
      )}
      {...props}
    />
  );
}

function AvatarImage({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Image>) {
  return (
    <AvatarPrimitive.Image
      data-slot="avatar-image"
      className={cn("aspect-square size-full", className)}
      {...props}
    />
  );
}

function AvatarFallback({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Fallback>) {
  return (
    <AvatarPrimitive.Fallback
      data-slot="avatar-fallback"
      className={cn(
        "bg-muted flex size-full items-center justify-center rounded-full",
        className,
      )}
      {...props}
    />
  );
}

export { Avatar, AvatarImage, AvatarFallback };

import * as React from "react";
import { Slot } from "@radix-ui/react-slot";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "./utils";

const badgeVariants = cva(
  "inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",
        destructive:
          "border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  },
);

function Badge({
  className,
  variant,
  asChild = false,
  ...props
}: React.ComponentProps<"span"> &
  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : "span";

  return (
    <Comp
      data-slot="badge"
      className={cn(badgeVariants({ variant }), className)}
      {...props}
    />
  );
}

export { Badge, badgeVariants };

import * as React from "react";
import { Slot } from "@radix-ui/react-slot";
import { ChevronRight, MoreHorizontal } from "lucide-react";

import { cn } from "./utils";

function Breadcrumb({ ...props }: React.ComponentProps<"nav">) {
  return <nav aria-label="breadcrumb" data-slot="breadcrumb" {...props} />;
}

function BreadcrumbList({ className, ...props }: React.ComponentProps<"ol">) {
  return (
    <ol
      data-slot="breadcrumb-list"
      className={cn(
        "text-muted-foreground flex flex-wrap items-center gap-1.5 text-sm break-words sm:gap-2.5",
        className,
      )}
      {...props}
    />
  );
}

function BreadcrumbItem({ className, ...props }: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="breadcrumb-item"
      className={cn("inline-flex items-center gap-1.5", className)}
      {...props}
    />
  );
}

function BreadcrumbLink({
  asChild,
  className,
  ...props
}: React.ComponentProps<"a"> & {
  asChild?: boolean;
}) {
  const Comp = asChild ? Slot : "a";

  return (
    <Comp
      data-slot="breadcrumb-link"
      className={cn("hover:text-foreground transition-colors", className)}
      {...props}
    />
  );
}

function BreadcrumbPage({ className, ...props }: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="breadcrumb-page"
      role="link"
      aria-disabled="true"
      aria-current="page"
      className={cn("text-foreground font-normal", className)}
      {...props}
    />
  );
}

function BreadcrumbSeparator({
  children,
  className,
  ...props
}: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="breadcrumb-separator"
      role="presentation"
      aria-hidden="true"
      className={cn("[&>svg]:size-3.5", className)}
      {...props}
    >
      {children ?? <ChevronRight />}
    </li>
  );
}

function BreadcrumbEllipsis({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="breadcrumb-ellipsis"
      role="presentation"
      aria-hidden="true"
      className={cn("flex size-9 items-center justify-center", className)}
      {...props}
    >
      <MoreHorizontal className="size-4" />
      <span className="sr-only">More</span>
    </span>
  );
}

export {
  Breadcrumb,
  BreadcrumbList,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbPage,
  BreadcrumbSeparator,
  BreadcrumbEllipsis,
};

import * as React from "react";
import { Slot } from "@radix-ui/react-slot";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "./utils";

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost:
          "hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-9 px-4 py-2 has-[>svg]:px-3",
        sm: "h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",
        lg: "h-10 rounded-md px-6 has-[>svg]:px-4",
        icon: "size-9 rounded-md",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
);

function Button({
  className,
  variant,
  size,
  asChild = false,
  ...props
}: React.ComponentProps<"button"> &
  VariantProps<typeof buttonVariants> & {
    asChild?: boolean;
  }) {
  const Comp = asChild ? Slot : "button";

  return (
    <Comp
      data-slot="button"
      className={cn(buttonVariants({ variant, size, className }))}
      {...props}
    />
  );
}

export { Button, buttonVariants };

"use client";

import * as React from "react";
import { ChevronLeft, ChevronRight } from "lucide-react";
import { DayPicker } from "react-day-picker";

import { cn } from "./utils";
import { buttonVariants } from "./button";

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  ...props
}: React.ComponentProps<typeof DayPicker>) {
  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn("p-3", className)}
      classNames={{
        months: "flex flex-col sm:flex-row gap-2",
        month: "flex flex-col gap-4",
        caption: "flex justify-center pt-1 relative items-center w-full",
        caption_label: "text-sm font-medium",
        nav: "flex items-center gap-1",
        nav_button: cn(
          buttonVariants({ variant: "outline" }),
          "size-7 bg-transparent p-0 opacity-50 hover:opacity-100",
        ),
        nav_button_previous: "absolute left-1",
        nav_button_next: "absolute right-1",
        table: "w-full border-collapse space-x-1",
        head_row: "flex",
        head_cell:
          "text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]",
        row: "flex w-full mt-2",
        cell: cn(
          "relative p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([aria-selected])]:bg-accent [&:has([aria-selected].day-range-end)]:rounded-r-md",
          props.mode === "range"
            ? "[&:has(>.day-range-end)]:rounded-r-md [&:has(>.day-range-start)]:rounded-l-md first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md"
            : "[&:has([aria-selected])]:rounded-md",
        ),
        day: cn(
          buttonVariants({ variant: "ghost" }),
          "size-8 p-0 font-normal aria-selected:opacity-100",
        ),
        day_range_start:
          "day-range-start aria-selected:bg-primary aria-selected:text-primary-foreground",
        day_range_end:
          "day-range-end aria-selected:bg-primary aria-selected:text-primary-foreground",
        day_selected:
          "bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",
        day_today: "bg-accent text-accent-foreground",
        day_outside:
          "day-outside text-muted-foreground aria-selected:text-muted-foreground",
        day_disabled: "text-muted-foreground opacity-50",
        day_range_middle:
          "aria-selected:bg-accent aria-selected:text-accent-foreground",
        day_hidden: "invisible",
        ...classNames,
      }}
      components={{
        IconLeft: ({ className, ...props }) => (
          <ChevronLeft className={cn("size-4", className)} {...props} />
        ),
        IconRight: ({ className, ...props }) => (
          <ChevronRight className={cn("size-4", className)} {...props} />
        ),
      }}
      {...props}
    />
  );
}

export { Calendar };

import * as React from "react";

import { cn } from "./utils";

function Card({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card"
      className={cn(
        "bg-card text-card-foreground flex flex-col gap-6 rounded-xl border",
        className,
      )}
      {...props}
    />
  );
}

function CardHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-header"
      className={cn(
        "@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 pt-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",
        className,
      )}
      {...props}
    />
  );
}

function CardTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <h4
      data-slot="card-title"
      className={cn("leading-none", className)}
      {...props}
    />
  );
}

function CardDescription({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <p
      data-slot="card-description"
      className={cn("text-muted-foreground", className)}
      {...props}
    />
  );
}

function CardAction({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-action"
      className={cn(
        "col-start-2 row-span-2 row-start-1 self-start justify-self-end",
        className,
      )}
      {...props}
    />
  );
}

function CardContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-content"
      className={cn("px-6 [&:last-child]:pb-6", className)}
      {...props}
    />
  );
}

function CardFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-footer"
      className={cn("flex items-center px-6 pb-6 [.border-t]:pt-6", className)}
      {...props}
    />
  );
}

export {
  Card,
  CardHeader,
  CardFooter,
  CardTitle,
  CardAction,
  CardDescription,
  CardContent,
};

"use client";

import * as React from "react";
import useEmblaCarousel, {
  type UseEmblaCarouselType,
} from "embla-carousel-react";
import { ArrowLeft, ArrowRight } from "lucide-react";

import { cn } from "./utils";
import { Button } from "./button";

type CarouselApi = UseEmblaCarouselType[1];
type UseCarouselParameters = Parameters<typeof useEmblaCarousel>;
type CarouselOptions = UseCarouselParameters[0];
type CarouselPlugin = UseCarouselParameters[1];

type CarouselProps = {
  opts?: CarouselOptions;
  plugins?: CarouselPlugin;
  orientation?: "horizontal" | "vertical";
  setApi?: (api: CarouselApi) => void;
};

type CarouselContextProps = {
  carouselRef: ReturnType<typeof useEmblaCarousel>[0];
  api: ReturnType<typeof useEmblaCarousel>[1];
  scrollPrev: () => void;
  scrollNext: () => void;
  canScrollPrev: boolean;
  canScrollNext: boolean;
} & CarouselProps;

const CarouselContext = React.createContext<CarouselContextProps | null>(null);

function useCarousel() {
  const context = React.useContext(CarouselContext);

  if (!context) {
    throw new Error("useCarousel must be used within a <Carousel />");
  }

  return context;
}

function Carousel({
  orientation = "horizontal",
  opts,
  setApi,
  plugins,
  className,
  children,
  ...props
}: React.ComponentProps<"div"> & CarouselProps) {
  const [carouselRef, api] = useEmblaCarousel(
    {
      ...opts,
      axis: orientation === "horizontal" ? "x" : "y",
    },
    plugins,
  );
  const [canScrollPrev, setCanScrollPrev] = React.useState(false);
  const [canScrollNext, setCanScrollNext] = React.useState(false);

  const onSelect = React.useCallback((api: CarouselApi) => {
    if (!api) return;
    setCanScrollPrev(api.canScrollPrev());
    setCanScrollNext(api.canScrollNext());
  }, []);

  const scrollPrev = React.useCallback(() => {
    api?.scrollPrev();
  }, [api]);

  const scrollNext = React.useCallback(() => {
    api?.scrollNext();
  }, [api]);

  const handleKeyDown = React.useCallback(
    (event: React.KeyboardEvent<HTMLDivElement>) => {
      if (event.key === "ArrowLeft") {
        event.preventDefault();
        scrollPrev();
      } else if (event.key === "ArrowRight") {
        event.preventDefault();
        scrollNext();
      }
    },
    [scrollPrev, scrollNext],
  );

  React.useEffect(() => {
    if (!api || !setApi) return;
    setApi(api);
  }, [api, setApi]);

  React.useEffect(() => {
    if (!api) return;
    onSelect(api);
    api.on("reInit", onSelect);
    api.on("select", onSelect);

    return () => {
      api?.off("select", onSelect);
    };
  }, [api, onSelect]);

  return (
    <CarouselContext.Provider
      value={{
        carouselRef,
        api: api,
        opts,
        orientation:
          orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),
        scrollPrev,
        scrollNext,
        canScrollPrev,
        canScrollNext,
      }}
    >
      <div
        onKeyDownCapture={handleKeyDown}
        className={cn("relative", className)}
        role="region"
        aria-roledescription="carousel"
        data-slot="carousel"
        {...props}
      >
        {children}
      </div>
    </CarouselContext.Provider>
  );
}

function CarouselContent({ className, ...props }: React.ComponentProps<"div">) {
  const { carouselRef, orientation } = useCarousel();

  return (
    <div
      ref={carouselRef}
      className="overflow-hidden"
      data-slot="carousel-content"
    >
      <div
        className={cn(
          "flex",
          orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col",
          className,
        )}
        {...props}
      />
    </div>
  );
}

function CarouselItem({ className, ...props }: React.ComponentProps<"div">) {
  const { orientation } = useCarousel();

  return (
    <div
      role="group"
      aria-roledescription="slide"
      data-slot="carousel-item"
      className={cn(
        "min-w-0 shrink-0 grow-0 basis-full",
        orientation === "horizontal" ? "pl-4" : "pt-4",
        className,
      )}
      {...props}
    />
  );
}

function CarouselPrevious({
  className,
  variant = "outline",
  size = "icon",
  ...props
}: React.ComponentProps<typeof Button>) {
  const { orientation, scrollPrev, canScrollPrev } = useCarousel();

  return (
    <Button
      data-slot="carousel-previous"
      variant={variant}
      size={size}
      className={cn(
        "absolute size-8 rounded-full",
        orientation === "horizontal"
          ? "top-1/2 -left-12 -translate-y-1/2"
          : "-top-12 left-1/2 -translate-x-1/2 rotate-90",
        className,
      )}
      disabled={!canScrollPrev}
      onClick={scrollPrev}
      {...props}
    >
      <ArrowLeft />
      <span className="sr-only">Previous slide</span>
    </Button>
  );
}

function CarouselNext({
  className,
  variant = "outline",
  size = "icon",
  ...props
}: React.ComponentProps<typeof Button>) {
  const { orientation, scrollNext, canScrollNext } = useCarousel();

  return (
    <Button
      data-slot="carousel-next"
      variant={variant}
      size={size}
      className={cn(
        "absolute size-8 rounded-full",
        orientation === "horizontal"
          ? "top-1/2 -right-12 -translate-y-1/2"
          : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",
        className,
      )}
      disabled={!canScrollNext}
      onClick={scrollNext}
      {...props}
    >
      <ArrowRight />
      <span className="sr-only">Next slide</span>
    </Button>
  );
}

export {
  type CarouselApi,
  Carousel,
  CarouselContent,
  CarouselItem,
  CarouselPrevious,
  CarouselNext,
};

"use client";

import * as React from "react";
import * as RechartsPrimitive from "recharts";

import { cn } from "./utils";

// Format: { THEME_NAME: CSS_SELECTOR }
const THEMES = { light: "", dark: ".dark" } as const;

export type ChartConfig = {
  [k in string]: {
    label?: React.ReactNode;
    icon?: React.ComponentType;
  } & (
    | { color?: string; theme?: never }
    | { color?: never; theme: Record<keyof typeof THEMES, string> }
  );
};

type ChartContextProps = {
  config: ChartConfig;
};

const ChartContext = React.createContext<ChartContextProps | null>(null);

function useChart() {
  const context = React.useContext(ChartContext);

  if (!context) {
    throw new Error("useChart must be used within a <ChartContainer />");
  }

  return context;
}

function ChartContainer({
  id,
  className,
  children,
  config,
  ...props
}: React.ComponentProps<"div"> & {
  config: ChartConfig;
  children: React.ComponentProps<
    typeof RechartsPrimitive.ResponsiveContainer
  >["children"];
}) {
  const uniqueId = React.useId();
  const chartId = `chart-${id || uniqueId.replace(/:/g, "")}`;

  return (
    <ChartContext.Provider value={{ config }}>
      <div
        data-slot="chart"
        data-chart={chartId}
        className={cn(
          "[&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border flex aspect-video justify-center text-xs [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-hidden [&_.recharts-sector]:outline-hidden [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-surface]:outline-hidden",
          className,
        )}
        {...props}
      >
        <ChartStyle id={chartId} config={config} />
        <RechartsPrimitive.ResponsiveContainer>
          {children}
        </RechartsPrimitive.ResponsiveContainer>
      </div>
    </ChartContext.Provider>
  );
}

const ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {
  const colorConfig = Object.entries(config).filter(
    ([, config]) => config.theme || config.color,
  );

  if (!colorConfig.length) {
    return null;
  }

  return (
    <style
      dangerouslySetInnerHTML={{
        __html: Object.entries(THEMES)
          .map(
            ([theme, prefix]) => `
${prefix} [data-chart=${id}] {
${colorConfig
  .map(([key, itemConfig]) => {
    const color =
      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||
      itemConfig.color;
    return color ? `  --color-${key}: ${color};` : null;
  })
  .join("\n")}
}
`,
          )
          .join("\n"),
      }}
    />
  );
};

const ChartTooltip = RechartsPrimitive.Tooltip;

function ChartTooltipContent({
  active,
  payload,
  className,
  indicator = "dot",
  hideLabel = false,
  hideIndicator = false,
  label,
  labelFormatter,
  labelClassName,
  formatter,
  color,
  nameKey,
  labelKey,
}: React.ComponentProps<typeof RechartsPrimitive.Tooltip> &
  React.ComponentProps<"div"> & {
    hideLabel?: boolean;
    hideIndicator?: boolean;
    indicator?: "line" | "dot" | "dashed";
    nameKey?: string;
    labelKey?: string;
  }) {
  const { config } = useChart();

  const tooltipLabel = React.useMemo(() => {
    if (hideLabel || !payload?.length) {
      return null;
    }

    const [item] = payload;
    const key = `${labelKey || item?.dataKey || item?.name || "value"}`;
    const itemConfig = getPayloadConfigFromPayload(config, item, key);
    const value =
      !labelKey && typeof label === "string"
        ? config[label as keyof typeof config]?.label || label
        : itemConfig?.label;

    if (labelFormatter) {
      return (
        <div className={cn("font-medium", labelClassName)}>
          {labelFormatter(value, payload)}
        </div>
      );
    }

    if (!value) {
      return null;
    }

    return <div className={cn("font-medium", labelClassName)}>{value}</div>;
  }, [
    label,
    labelFormatter,
    payload,
    hideLabel,
    labelClassName,
    config,
    labelKey,
  ]);

  if (!active || !payload?.length) {
    return null;
  }

  const nestLabel = payload.length === 1 && indicator !== "dot";

  return (
    <div
      className={cn(
        "border-border/50 bg-background grid min-w-[8rem] items-start gap-1.5 rounded-lg border px-2.5 py-1.5 text-xs shadow-xl",
        className,
      )}
    >
      {!nestLabel ? tooltipLabel : null}
      <div className="grid gap-1.5">
        {payload.map((item, index) => {
          const key = `${nameKey || item.name || item.dataKey || "value"}`;
          const itemConfig = getPayloadConfigFromPayload(config, item, key);
          const indicatorColor = color || item.payload.fill || item.color;

          return (
            <div
              key={item.dataKey}
              className={cn(
                "[&>svg]:text-muted-foreground flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5",
                indicator === "dot" && "items-center",
              )}
            >
              {formatter && item?.value !== undefined && item.name ? (
                formatter(item.value, item.name, item, index, item.payload)
              ) : (
                <>
                  {itemConfig?.icon ? (
                    <itemConfig.icon />
                  ) : (
                    !hideIndicator && (
                      <div
                        className={cn(
                          "shrink-0 rounded-[2px] border-(--color-border) bg-(--color-bg)",
                          {
                            "h-2.5 w-2.5": indicator === "dot",
                            "w-1": indicator === "line",
                            "w-0 border-[1.5px] border-dashed bg-transparent":
                              indicator === "dashed",
                            "my-0.5": nestLabel && indicator === "dashed",
                          },
                        )}
                        style={
                          {
                            "--color-bg": indicatorColor,
                            "--color-border": indicatorColor,
                          } as React.CSSProperties
                        }
                      />
                    )
                  )}
                  <div
                    className={cn(
                      "flex flex-1 justify-between leading-none",
                      nestLabel ? "items-end" : "items-center",
                    )}
                  >
                    <div className="grid gap-1.5">
                      {nestLabel ? tooltipLabel : null}
                      <span className="text-muted-foreground">
                        {itemConfig?.label || item.name}
                      </span>
                    </div>
                    {item.value && (
                      <span className="text-foreground font-mono font-medium tabular-nums">
                        {item.value.toLocaleString()}
                      </span>
                    )}
                  </div>
                </>
              )}
            </div>
          );
        })}
      </div>
    </div>
  );
}

const ChartLegend = RechartsPrimitive.Legend;

function ChartLegendContent({
  className,
  hideIcon = false,
  payload,
  verticalAlign = "bottom",
  nameKey,
}: React.ComponentProps<"div"> &
  Pick<RechartsPrimitive.LegendProps, "payload" | "verticalAlign"> & {
    hideIcon?: boolean;
    nameKey?: string;
  }) {
  const { config } = useChart();

  if (!payload?.length) {
    return null;
  }

  return (
    <div
      className={cn(
        "flex items-center justify-center gap-4",
        verticalAlign === "top" ? "pb-3" : "pt-3",
        className,
      )}
    >
      {payload.map((item) => {
        const key = `${nameKey || item.dataKey || "value"}`;
        const itemConfig = getPayloadConfigFromPayload(config, item, key);

        return (
          <div
            key={item.value}
            className={cn(
              "[&>svg]:text-muted-foreground flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3",
            )}
          >
            {itemConfig?.icon && !hideIcon ? (
              <itemConfig.icon />
            ) : (
              <div
                className="h-2 w-2 shrink-0 rounded-[2px]"
                style={{
                  backgroundColor: item.color,
                }}
              />
            )}
            {itemConfig?.label}
          </div>
        );
      })}
    </div>
  );
}

// Helper to extract item config from a payload.
function getPayloadConfigFromPayload(
  config: ChartConfig,
  payload: unknown,
  key: string,
) {
  if (typeof payload !== "object" || payload === null) {
    return undefined;
  }

  const payloadPayload =
    "payload" in payload &&
    typeof payload.payload === "object" &&
    payload.payload !== null
      ? payload.payload
      : undefined;

  let configLabelKey: string = key;

  if (
    key in payload &&
    typeof payload[key as keyof typeof payload] === "string"
  ) {
    configLabelKey = payload[key as keyof typeof payload] as string;
  } else if (
    payloadPayload &&
    key in payloadPayload &&
    typeof payloadPayload[key as keyof typeof payloadPayload] === "string"
  ) {
    configLabelKey = payloadPayload[
      key as keyof typeof payloadPayload
    ] as string;
  }

  return configLabelKey in config
    ? config[configLabelKey]
    : config[key as keyof typeof config];
}

export {
  ChartContainer,
  ChartTooltip,
  ChartTooltipContent,
  ChartLegend,
  ChartLegendContent,
  ChartStyle,
};

"use client";

import * as React from "react";
import * as CheckboxPrimitive from "@radix-ui/react-checkbox";
import { CheckIcon } from "lucide-react";

import { cn } from "./utils";

function Checkbox({
  className,
  ...props
}: React.ComponentProps<typeof CheckboxPrimitive.Root>) {
  return (
    <CheckboxPrimitive.Root
      data-slot="checkbox"
      className={cn(
        "peer border bg-input-background dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className,
      )}
      {...props}
    >
      <CheckboxPrimitive.Indicator
        data-slot="checkbox-indicator"
        className="flex items-center justify-center text-current transition-none"
      >
        <CheckIcon className="size-3.5" />
      </CheckboxPrimitive.Indicator>
    </CheckboxPrimitive.Root>
  );
}

export { Checkbox };

"use client";

import * as CollapsiblePrimitive from "@radix-ui/react-collapsible";

function Collapsible({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.Root>) {
  return <CollapsiblePrimitive.Root data-slot="collapsible" {...props} />;
}

function CollapsibleTrigger({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.CollapsibleTrigger>) {
  return (
    <CollapsiblePrimitive.CollapsibleTrigger
      data-slot="collapsible-trigger"
      {...props}
    />
  );
}

function CollapsibleContent({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.CollapsibleContent>) {
  return (
    <CollapsiblePrimitive.CollapsibleContent
      data-slot="collapsible-content"
      {...props}
    />
  );
}

export { Collapsible, CollapsibleTrigger, CollapsibleContent };

"use client";

import * as React from "react";
import { Command as CommandPrimitive } from "cmdk";
import { SearchIcon } from "lucide-react";

import { cn } from "./utils";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from "./dialog";

function Command({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive>) {
  return (
    <CommandPrimitive
      data-slot="command"
      className={cn(
        "bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",
        className,
      )}
      {...props}
    />
  );
}

function CommandDialog({
  title = "Command Palette",
  description = "Search for a command to run...",
  children,
  ...props
}: React.ComponentProps<typeof Dialog> & {
  title?: string;
  description?: string;
}) {
  return (
    <Dialog {...props}>
      <DialogHeader className="sr-only">
        <DialogTitle>{title}</DialogTitle>
        <DialogDescription>{description}</DialogDescription>
      </DialogHeader>
      <DialogContent className="overflow-hidden p-0">
        <Command className="[&_[cmdk-group-heading]]:text-muted-foreground **:data-[slot=command-input-wrapper]:h-12 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group]]:px-2 [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  );
}

function CommandInput({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Input>) {
  return (
    <div
      data-slot="command-input-wrapper"
      className="flex h-9 items-center gap-2 border-b px-3"
    >
      <SearchIcon className="size-4 shrink-0 opacity-50" />
      <CommandPrimitive.Input
        data-slot="command-input"
        className={cn(
          "placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50",
          className,
        )}
        {...props}
      />
    </div>
  );
}

function CommandList({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.List>) {
  return (
    <CommandPrimitive.List
      data-slot="command-list"
      className={cn(
        "max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto",
        className,
      )}
      {...props}
    />
  );
}

function CommandEmpty({
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Empty>) {
  return (
    <CommandPrimitive.Empty
      data-slot="command-empty"
      className="py-6 text-center text-sm"
      {...props}
    />
  );
}

function CommandGroup({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Group>) {
  return (
    <CommandPrimitive.Group
      data-slot="command-group"
      className={cn(
        "text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium",
        className,
      )}
      {...props}
    />
  );
}

function CommandSeparator({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Separator>) {
  return (
    <CommandPrimitive.Separator
      data-slot="command-separator"
      className={cn("bg-border -mx-1 h-px", className)}
      {...props}
    />
  );
}

function CommandItem({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Item>) {
  return (
    <CommandPrimitive.Item
      data-slot="command-item"
      className={cn(
        "data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  );
}

function CommandShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="command-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className,
      )}
      {...props}
    />
  );
}

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
};

"use client";

import * as React from "react";
import * as ContextMenuPrimitive from "@radix-ui/react-context-menu";
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react";

import { cn } from "./utils";

function ContextMenu({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Root>) {
  return <ContextMenuPrimitive.Root data-slot="context-menu" {...props} />;
}

function ContextMenuTrigger({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Trigger>) {
  return (
    <ContextMenuPrimitive.Trigger data-slot="context-menu-trigger" {...props} />
  );
}

function ContextMenuGroup({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Group>) {
  return (
    <ContextMenuPrimitive.Group data-slot="context-menu-group" {...props} />
  );
}

function ContextMenuPortal({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Portal>) {
  return (
    <ContextMenuPrimitive.Portal data-slot="context-menu-portal" {...props} />
  );
}

function ContextMenuSub({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Sub>) {
  return <ContextMenuPrimitive.Sub data-slot="context-menu-sub" {...props} />;
}

function ContextMenuRadioGroup({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.RadioGroup>) {
  return (
    <ContextMenuPrimitive.RadioGroup
      data-slot="context-menu-radio-group"
      {...props}
    />
  );
}

function ContextMenuSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.SubTrigger> & {
  inset?: boolean;
}) {
  return (
    <ContextMenuPrimitive.SubTrigger
      data-slot="context-menu-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto" />
    </ContextMenuPrimitive.SubTrigger>
  );
}

function ContextMenuSubContent({
  className,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.SubContent>) {
  return (
    <ContextMenuPrimitive.SubContent
      data-slot="context-menu-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-context-menu-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg",
        className,
      )}
      {...props}
    />
  );
}

function ContextMenuContent({
  className,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Content>) {
  return (
    <ContextMenuPrimitive.Portal>
      <ContextMenuPrimitive.Content
        data-slot="context-menu-content"
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-context-menu-content-available-height) min-w-[8rem] origin-(--radix-context-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",
          className,
        )}
        {...props}
      />
    </ContextMenuPrimitive.Portal>
  );
}

function ContextMenuItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Item> & {
  inset?: boolean;
  variant?: "default" | "destructive";
}) {
  return (
    <ContextMenuPrimitive.Item
      data-slot="context-menu-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  );
}

function ContextMenuCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.CheckboxItem>) {
  return (
    <ContextMenuPrimitive.CheckboxItem
      data-slot="context-menu-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <ContextMenuPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </ContextMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </ContextMenuPrimitive.CheckboxItem>
  );
}

function ContextMenuRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.RadioItem>) {
  return (
    <ContextMenuPrimitive.RadioItem
      data-slot="context-menu-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <ContextMenuPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </ContextMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </ContextMenuPrimitive.RadioItem>
  );
}

function ContextMenuLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Label> & {
  inset?: boolean;
}) {
  return (
    <ContextMenuPrimitive.Label
      data-slot="context-menu-label"
      data-inset={inset}
      className={cn(
        "text-foreground px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",
        className,
      )}
      {...props}
    />
  );
}

function ContextMenuSeparator({
  className,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Separator>) {
  return (
    <ContextMenuPrimitive.Separator
      data-slot="context-menu-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  );
}

function ContextMenuShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="context-menu-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className,
      )}
      {...props}
    />
  );
}

export {
  ContextMenu,
  ContextMenuTrigger,
  ContextMenuContent,
  ContextMenuItem,
  ContextMenuCheckboxItem,
  ContextMenuRadioItem,
  ContextMenuLabel,
  ContextMenuSeparator,
  ContextMenuShortcut,
  ContextMenuGroup,
  ContextMenuPortal,
  ContextMenuSub,
  ContextMenuSubContent,
  ContextMenuSubTrigger,
  ContextMenuRadioGroup,
};

"use client";

import * as React from "react";
import * as DialogPrimitive from "@radix-ui/react-dialog";
import { XIcon } from "lucide-react";

import { cn } from "./utils";

function Dialog({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Root>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />;
}

function DialogTrigger({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />;
}

function DialogPortal({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Portal>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />;
}

function DialogClose({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />;
}

function DialogOverlay({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className,
      )}
      {...props}
    />
  );
}

function DialogContent({
  className,
  children,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Content>) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className,
        )}
        {...props}
      >
        {children}
        <DialogPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4">
          <XIcon />
          <span className="sr-only">Close</span>
        </DialogPrimitive.Close>
      </DialogPrimitive.Content>
    </DialogPortal>
  );
}

function DialogHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function DialogFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn(
        "flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",
        className,
      )}
      {...props}
    />
  );
}

function DialogTitle({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  );
}

function DialogDescription({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
};

"use client";

import * as React from "react";
import { Drawer as DrawerPrimitive } from "vaul";

import { cn } from "./utils";

function Drawer({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Root>) {
  return <DrawerPrimitive.Root data-slot="drawer" {...props} />;
}

function DrawerTrigger({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Trigger>) {
  return <DrawerPrimitive.Trigger data-slot="drawer-trigger" {...props} />;
}

function DrawerPortal({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Portal>) {
  return <DrawerPrimitive.Portal data-slot="drawer-portal" {...props} />;
}

function DrawerClose({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Close>) {
  return <DrawerPrimitive.Close data-slot="drawer-close" {...props} />;
}

function DrawerOverlay({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Overlay>) {
  return (
    <DrawerPrimitive.Overlay
      data-slot="drawer-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className,
      )}
      {...props}
    />
  );
}

function DrawerContent({
  className,
  children,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Content>) {
  return (
    <DrawerPortal data-slot="drawer-portal">
      <DrawerOverlay />
      <DrawerPrimitive.Content
        data-slot="drawer-content"
        className={cn(
          "group/drawer-content bg-background fixed z-50 flex h-auto flex-col",
          "data-[vaul-drawer-direction=top]:inset-x-0 data-[vaul-drawer-direction=top]:top-0 data-[vaul-drawer-direction=top]:mb-24 data-[vaul-drawer-direction=top]:max-h-[80vh] data-[vaul-drawer-direction=top]:rounded-b-lg data-[vaul-drawer-direction=top]:border-b",
          "data-[vaul-drawer-direction=bottom]:inset-x-0 data-[vaul-drawer-direction=bottom]:bottom-0 data-[vaul-drawer-direction=bottom]:mt-24 data-[vaul-drawer-direction=bottom]:max-h-[80vh] data-[vaul-drawer-direction=bottom]:rounded-t-lg data-[vaul-drawer-direction=bottom]:border-t",
          "data-[vaul-drawer-direction=right]:inset-y-0 data-[vaul-drawer-direction=right]:right-0 data-[vaul-drawer-direction=right]:w-3/4 data-[vaul-drawer-direction=right]:border-l data-[vaul-drawer-direction=right]:sm:max-w-sm",
          "data-[vaul-drawer-direction=left]:inset-y-0 data-[vaul-drawer-direction=left]:left-0 data-[vaul-drawer-direction=left]:w-3/4 data-[vaul-drawer-direction=left]:border-r data-[vaul-drawer-direction=left]:sm:max-w-sm",
          className,
        )}
        {...props}
      >
        <div className="bg-muted mx-auto mt-4 hidden h-2 w-[100px] shrink-0 rounded-full group-data-[vaul-drawer-direction=bottom]/drawer-content:block" />
        {children}
      </DrawerPrimitive.Content>
    </DrawerPortal>
  );
}

function DrawerHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="drawer-header"
      className={cn("flex flex-col gap-1.5 p-4", className)}
      {...props}
    />
  );
}

function DrawerFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="drawer-footer"
      className={cn("mt-auto flex flex-col gap-2 p-4", className)}
      {...props}
    />
  );
}

function DrawerTitle({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Title>) {
  return (
    <DrawerPrimitive.Title
      data-slot="drawer-title"
      className={cn("text-foreground font-semibold", className)}
      {...props}
    />
  );
}

function DrawerDescription({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Description>) {
  return (
    <DrawerPrimitive.Description
      data-slot="drawer-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Drawer,
  DrawerPortal,
  DrawerOverlay,
  DrawerTrigger,
  DrawerClose,
  DrawerContent,
  DrawerHeader,
  DrawerFooter,
  DrawerTitle,
  DrawerDescription,
};

"use client";

import * as React from "react";
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu";
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react";

import { cn } from "./utils";

function DropdownMenu({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Root>) {
  return <DropdownMenuPrimitive.Root data-slot="dropdown-menu" {...props} />;
}

function DropdownMenuPortal({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Portal>) {
  return (
    <DropdownMenuPrimitive.Portal data-slot="dropdown-menu-portal" {...props} />
  );
}

function DropdownMenuTrigger({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Trigger>) {
  return (
    <DropdownMenuPrimitive.Trigger
      data-slot="dropdown-menu-trigger"
      {...props}
    />
  );
}

function DropdownMenuContent({
  className,
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Content>) {
  return (
    <DropdownMenuPrimitive.Portal>
      <DropdownMenuPrimitive.Content
        data-slot="dropdown-menu-content"
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",
          className,
        )}
        {...props}
      />
    </DropdownMenuPrimitive.Portal>
  );
}

function DropdownMenuGroup({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Group>) {
  return (
    <DropdownMenuPrimitive.Group data-slot="dropdown-menu-group" {...props} />
  );
}

function DropdownMenuItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Item> & {
  inset?: boolean;
  variant?: "default" | "destructive";
}) {
  return (
    <DropdownMenuPrimitive.Item
      data-slot="dropdown-menu-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  );
}

function DropdownMenuCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.CheckboxItem>) {
  return (
    <DropdownMenuPrimitive.CheckboxItem
      data-slot="dropdown-menu-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <DropdownMenuPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </DropdownMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </DropdownMenuPrimitive.CheckboxItem>
  );
}

function DropdownMenuRadioGroup({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioGroup>) {
  return (
    <DropdownMenuPrimitive.RadioGroup
      data-slot="dropdown-menu-radio-group"
      {...props}
    />
  );
}

function DropdownMenuRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioItem>) {
  return (
    <DropdownMenuPrimitive.RadioItem
      data-slot="dropdown-menu-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <DropdownMenuPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </DropdownMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </DropdownMenuPrimitive.RadioItem>
  );
}

function DropdownMenuLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Label> & {
  inset?: boolean;
}) {
  return (
    <DropdownMenuPrimitive.Label
      data-slot="dropdown-menu-label"
      data-inset={inset}
      className={cn(
        "px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",
        className,
      )}
      {...props}
    />
  );
}

function DropdownMenuSeparator({
  className,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Separator>) {
  return (
    <DropdownMenuPrimitive.Separator
      data-slot="dropdown-menu-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  );
}

function DropdownMenuShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="dropdown-menu-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className,
      )}
      {...props}
    />
  );
}

function DropdownMenuSub({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Sub>) {
  return <DropdownMenuPrimitive.Sub data-slot="dropdown-menu-sub" {...props} />;
}

function DropdownMenuSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubTrigger> & {
  inset?: boolean;
}) {
  return (
    <DropdownMenuPrimitive.SubTrigger
      data-slot="dropdown-menu-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8",
        className,
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto size-4" />
    </DropdownMenuPrimitive.SubTrigger>
  );
}

function DropdownMenuSubContent({
  className,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubContent>) {
  return (
    <DropdownMenuPrimitive.SubContent
      data-slot="dropdown-menu-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg",
        className,
      )}
      {...props}
    />
  );
}

export {
  DropdownMenu,
  DropdownMenuPortal,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuGroup,
  DropdownMenuLabel,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioGroup,
  DropdownMenuRadioItem,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuSub,
  DropdownMenuSubTrigger,
  DropdownMenuSubContent,
};

"use client";

import * as React from "react";
import * as LabelPrimitive from "@radix-ui/react-label";
import { Slot } from "@radix-ui/react-slot";
import {
  Controller,
  FormProvider,
  useFormContext,
  useFormState,
  type ControllerProps,
  type FieldPath,
  type FieldValues,
} from "react-hook-form";

import { cn } from "./utils";
import { Label } from "./label";

const Form = FormProvider;

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
> = {
  name: TName;
};

const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue,
);

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  );
};

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext);
  const itemContext = React.useContext(FormItemContext);
  const { getFieldState } = useFormContext();
  const formState = useFormState({ name: fieldContext.name });
  const fieldState = getFieldState(fieldContext.name, formState);

  if (!fieldContext) {
    throw new Error("useFormField should be used within <FormField>");
  }

  const { id } = itemContext;

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  };
};

type FormItemContextValue = {
  id: string;
};

const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue,
);

function FormItem({ className, ...props }: React.ComponentProps<"div">) {
  const id = React.useId();

  return (
    <FormItemContext.Provider value={{ id }}>
      <div
        data-slot="form-item"
        className={cn("grid gap-2", className)}
        {...props}
      />
    </FormItemContext.Provider>
  );
}

function FormLabel({
  className,
  ...props
}: React.ComponentProps<typeof LabelPrimitive.Root>) {
  const { error, formItemId } = useFormField();

  return (
    <Label
      data-slot="form-label"
      data-error={!!error}
      className={cn("data-[error=true]:text-destructive", className)}
      htmlFor={formItemId}
      {...props}
    />
  );
}

function FormControl({ ...props }: React.ComponentProps<typeof Slot>) {
  const { error, formItemId, formDescriptionId, formMessageId } =
    useFormField();

  return (
    <Slot
      data-slot="form-control"
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  );
}

function FormDescription({ className, ...props }: React.ComponentProps<"p">) {
  const { formDescriptionId } = useFormField();

  return (
    <p
      data-slot="form-description"
      id={formDescriptionId}
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

function FormMessage({ className, ...props }: React.ComponentProps<"p">) {
  const { error, formMessageId } = useFormField();
  const body = error ? String(error?.message ?? "") : props.children;

  if (!body) {
    return null;
  }

  return (
    <p
      data-slot="form-message"
      id={formMessageId}
      className={cn("text-destructive text-sm", className)}
      {...props}
    >
      {body}
    </p>
  );
}

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
};

"use client";

import * as React from "react";
import * as HoverCardPrimitive from "@radix-ui/react-hover-card";

import { cn } from "./utils";

function HoverCard({
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Root>) {
  return <HoverCardPrimitive.Root data-slot="hover-card" {...props} />;
}

function HoverCardTrigger({
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Trigger>) {
  return (
    <HoverCardPrimitive.Trigger data-slot="hover-card-trigger" {...props} />
  );
}

function HoverCardContent({
  className,
  align = "center",
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Content>) {
  return (
    <HoverCardPrimitive.Portal data-slot="hover-card-portal">
      <HoverCardPrimitive.Content
        data-slot="hover-card-content"
        align={align}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-64 origin-(--radix-hover-card-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",
          className,
        )}
        {...props}
      />
    </HoverCardPrimitive.Portal>
  );
}

export { HoverCard, HoverCardTrigger, HoverCardContent };

"use client";

import * as React from "react";
import { OTPInput, OTPInputContext } from "input-otp";
import { MinusIcon } from "lucide-react";

import { cn } from "./utils";

function InputOTP({
  className,
  containerClassName,
  ...props
}: React.ComponentProps<typeof OTPInput> & {
  containerClassName?: string;
}) {
  return (
    <OTPInput
      data-slot="input-otp"
      containerClassName={cn(
        "flex items-center gap-2 has-disabled:opacity-50",
        containerClassName,
      )}
      className={cn("disabled:cursor-not-allowed", className)}
      {...props}
    />
  );
}

function InputOTPGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="input-otp-group"
      className={cn("flex items-center gap-1", className)}
      {...props}
    />
  );
}

function InputOTPSlot({
  index,
  className,
  ...props
}: React.ComponentProps<"div"> & {
  index: number;
}) {
  const inputOTPContext = React.useContext(OTPInputContext);
  const { char, hasFakeCaret, isActive } = inputOTPContext?.slots[index] ?? {};

  return (
    <div
      data-slot="input-otp-slot"
      data-active={isActive}
      className={cn(
        "data-[active=true]:border-ring data-[active=true]:ring-ring/50 data-[active=true]:aria-invalid:ring-destructive/20 dark:data-[active=true]:aria-invalid:ring-destructive/40 aria-invalid:border-destructive data-[active=true]:aria-invalid:border-destructive dark:bg-input/30 border-input relative flex h-9 w-9 items-center justify-center border-y border-r text-sm bg-input-background transition-all outline-none first:rounded-l-md first:border-l last:rounded-r-md data-[active=true]:z-10 data-[active=true]:ring-[3px]",
        className,
      )}
      {...props}
    >
      {char}
      {hasFakeCaret && (
        <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
          <div className="animate-caret-blink bg-foreground h-4 w-px duration-1000" />
        </div>
      )}
    </div>
  );
}

function InputOTPSeparator({ ...props }: React.ComponentProps<"div">) {
  return (
    <div data-slot="input-otp-separator" role="separator" {...props}>
      <MinusIcon />
    </div>
  );
}

export { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator };

import * as React from "react";

import { cn } from "./utils";

function Input({ className, type, ...props }: React.ComponentProps<"input">) {
  return (
    <input
      type={type}
      data-slot="input"
      className={cn(
        "file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        "focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]",
        "aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
        className,
      )}
      {...props}
    />
  );
}

export { Input };

"use client";

import * as React from "react";
import * as LabelPrimitive from "@radix-ui/react-label";

import { cn } from "./utils";

function Label({
  className,
  ...props
}: React.ComponentProps<typeof LabelPrimitive.Root>) {
  return (
    <LabelPrimitive.Root
      data-slot="label"
      className={cn(
        "flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",
        className,
      )}
      {...props}
    />
  );
}

export { Label };

"use client";

import * as React from "react";
import * as MenubarPrimitive from "@radix-ui/react-menubar";
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react";

import { cn } from "./utils";

function Menubar({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Root>) {
  return (
    <MenubarPrimitive.Root
      data-slot="menubar"
      className={cn(
        "bg-background flex h-9 items-center gap-1 rounded-md border p-1 shadow-xs",
        className,
      )}
      {...props}
    />
  );
}

function MenubarMenu({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {
  return <MenubarPrimitive.Menu data-slot="menubar-menu" {...props} />;
}

function MenubarGroup({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Group>) {
  return <MenubarPrimitive.Group data-slot="menubar-group" {...props} />;
}

function MenubarPortal({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {
  return <MenubarPrimitive.Portal data-slot="menubar-portal" {...props} />;
}

function MenubarRadioGroup({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {
  return (
    <MenubarPrimitive.RadioGroup data-slot="menubar-radio-group" {...props} />
  );
}

function MenubarTrigger({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Trigger>) {
  return (
    <MenubarPrimitive.Trigger
      data-slot="menubar-trigger"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex items-center rounded-sm px-2 py-1 text-sm font-medium outline-hidden select-none",
        className,
      )}
      {...props}
    />
  );
}

function MenubarContent({
  className,
  align = "start",
  alignOffset = -4,
  sideOffset = 8,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Content>) {
  return (
    <MenubarPortal>
      <MenubarPrimitive.Content
        data-slot="menubar-content"
        align={align}
        alignOffset={alignOffset}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[12rem] origin-(--radix-menubar-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-md",
          className,
        )}
        {...props}
      />
    </MenubarPortal>
  );
}

function MenubarItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Item> & {
  inset?: boolean;
  variant?: "default" | "destructive";
}) {
  return (
    <MenubarPrimitive.Item
      data-slot="menubar-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  );
}

function MenubarCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.CheckboxItem>) {
  return (
    <MenubarPrimitive.CheckboxItem
      data-slot="menubar-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-xs py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <MenubarPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </MenubarPrimitive.ItemIndicator>
      </span>
      {children}
    </MenubarPrimitive.CheckboxItem>
  );
}

function MenubarRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.RadioItem>) {
  return (
    <MenubarPrimitive.RadioItem
      data-slot="menubar-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-xs py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <MenubarPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </MenubarPrimitive.ItemIndicator>
      </span>
      {children}
    </MenubarPrimitive.RadioItem>
  );
}

function MenubarLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Label> & {
  inset?: boolean;
}) {
  return (
    <MenubarPrimitive.Label
      data-slot="menubar-label"
      data-inset={inset}
      className={cn(
        "px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",
        className,
      )}
      {...props}
    />
  );
}

function MenubarSeparator({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Separator>) {
  return (
    <MenubarPrimitive.Separator
      data-slot="menubar-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  );
}

function MenubarShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="menubar-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className,
      )}
      {...props}
    />
  );
}

function MenubarSub({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {
  return <MenubarPrimitive.Sub data-slot="menubar-sub" {...props} />;
}

function MenubarSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.SubTrigger> & {
  inset?: boolean;
}) {
  return (
    <MenubarPrimitive.SubTrigger
      data-slot="menubar-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-none select-none data-[inset]:pl-8",
        className,
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto h-4 w-4" />
    </MenubarPrimitive.SubTrigger>
  );
}

function MenubarSubContent({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.SubContent>) {
  return (
    <MenubarPrimitive.SubContent
      data-slot="menubar-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-menubar-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg",
        className,
      )}
      {...props}
    />
  );
}

export {
  Menubar,
  MenubarPortal,
  MenubarMenu,
  MenubarTrigger,
  MenubarContent,
  MenubarGroup,
  MenubarSeparator,
  MenubarLabel,
  MenubarItem,
  MenubarShortcut,
  MenubarCheckboxItem,
  MenubarRadioGroup,
  MenubarRadioItem,
  MenubarSub,
  MenubarSubTrigger,
  MenubarSubContent,
};

import * as React from "react";
import * as NavigationMenuPrimitive from "@radix-ui/react-navigation-menu";
import { cva } from "class-variance-authority";
import { ChevronDownIcon } from "lucide-react";

import { cn } from "./utils";

function NavigationMenu({
  className,
  children,
  viewport = true,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Root> & {
  viewport?: boolean;
}) {
  return (
    <NavigationMenuPrimitive.Root
      data-slot="navigation-menu"
      data-viewport={viewport}
      className={cn(
        "group/navigation-menu relative flex max-w-max flex-1 items-center justify-center",
        className,
      )}
      {...props}
    >
      {children}
      {viewport && <NavigationMenuViewport />}
    </NavigationMenuPrimitive.Root>
  );
}

function NavigationMenuList({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.List>) {
  return (
    <NavigationMenuPrimitive.List
      data-slot="navigation-menu-list"
      className={cn(
        "group flex flex-1 list-none items-center justify-center gap-1",
        className,
      )}
      {...props}
    />
  );
}

function NavigationMenuItem({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Item>) {
  return (
    <NavigationMenuPrimitive.Item
      data-slot="navigation-menu-item"
      className={cn("relative", className)}
      {...props}
    />
  );
}

const navigationMenuTriggerStyle = cva(
  "group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=open]:hover:bg-accent data-[state=open]:text-accent-foreground data-[state=open]:focus:bg-accent data-[state=open]:bg-accent/50 focus-visible:ring-ring/50 outline-none transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1",
);

function NavigationMenuTrigger({
  className,
  children,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Trigger>) {
  return (
    <NavigationMenuPrimitive.Trigger
      data-slot="navigation-menu-trigger"
      className={cn(navigationMenuTriggerStyle(), "group", className)}
      {...props}
    >
      {children}{" "}
      <ChevronDownIcon
        className="relative top-[1px] ml-1 size-3 transition duration-300 group-data-[state=open]:rotate-180"
        aria-hidden="true"
      />
    </NavigationMenuPrimitive.Trigger>
  );
}

function NavigationMenuContent({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Content>) {
  return (
    <NavigationMenuPrimitive.Content
      data-slot="navigation-menu-content"
      className={cn(
        "data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 top-0 left-0 w-full p-2 pr-2.5 md:absolute md:w-auto",
        "group-data-[viewport=false]/navigation-menu:bg-popover group-data-[viewport=false]/navigation-menu:text-popover-foreground group-data-[viewport=false]/navigation-menu:data-[state=open]:animate-in group-data-[viewport=false]/navigation-menu:data-[state=closed]:animate-out group-data-[viewport=false]/navigation-menu:data-[state=closed]:zoom-out-95 group-data-[viewport=false]/navigation-menu:data-[state=open]:zoom-in-95 group-data-[viewport=false]/navigation-menu:data-[state=open]:fade-in-0 group-data-[viewport=false]/navigation-menu:data-[state=closed]:fade-out-0 group-data-[viewport=false]/navigation-menu:top-full group-data-[viewport=false]/navigation-menu:mt-1.5 group-data-[viewport=false]/navigation-menu:overflow-hidden group-data-[viewport=false]/navigation-menu:rounded-md group-data-[viewport=false]/navigation-menu:border group-data-[viewport=false]/navigation-menu:shadow group-data-[viewport=false]/navigation-menu:duration-200 **:data-[slot=navigation-menu-link]:focus:ring-0 **:data-[slot=navigation-menu-link]:focus:outline-none",
        className,
      )}
      {...props}
    />
  );
}

function NavigationMenuViewport({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Viewport>) {
  return (
    <div
      className={cn(
        "absolute top-full left-0 isolate z-50 flex justify-center",
      )}
    >
      <NavigationMenuPrimitive.Viewport
        data-slot="navigation-menu-viewport"
        className={cn(
          "origin-top-center bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border shadow md:w-[var(--radix-navigation-menu-viewport-width)]",
          className,
        )}
        {...props}
      />
    </div>
  );
}

function NavigationMenuLink({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Link>) {
  return (
    <NavigationMenuPrimitive.Link
      data-slot="navigation-menu-link"
      className={cn(
        "data-[active=true]:focus:bg-accent data-[active=true]:hover:bg-accent data-[active=true]:bg-accent/50 data-[active=true]:text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus-visible:ring-ring/50 [&_svg:not([class*='text-'])]:text-muted-foreground flex flex-col gap-1 rounded-sm p-2 text-sm transition-all outline-none focus-visible:ring-[3px] focus-visible:outline-1 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  );
}

function NavigationMenuIndicator({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Indicator>) {
  return (
    <NavigationMenuPrimitive.Indicator
      data-slot="navigation-menu-indicator"
      className={cn(
        "data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden",
        className,
      )}
      {...props}
    >
      <div className="bg-border relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm shadow-md" />
    </NavigationMenuPrimitive.Indicator>
  );
}

export {
  NavigationMenu,
  NavigationMenuList,
  NavigationMenuItem,
  NavigationMenuContent,
  NavigationMenuTrigger,
  NavigationMenuLink,
  NavigationMenuIndicator,
  NavigationMenuViewport,
  navigationMenuTriggerStyle,
};

import * as React from "react";
import {
  ChevronLeftIcon,
  ChevronRightIcon,
  MoreHorizontalIcon,
} from "lucide-react";

import { cn } from "./utils";
import { Button, buttonVariants } from "./button";

function Pagination({ className, ...props }: React.ComponentProps<"nav">) {
  return (
    <nav
      role="navigation"
      aria-label="pagination"
      data-slot="pagination"
      className={cn("mx-auto flex w-full justify-center", className)}
      {...props}
    />
  );
}

function PaginationContent({
  className,
  ...props
}: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="pagination-content"
      className={cn("flex flex-row items-center gap-1", className)}
      {...props}
    />
  );
}

function PaginationItem({ ...props }: React.ComponentProps<"li">) {
  return <li data-slot="pagination-item" {...props} />;
}

type PaginationLinkProps = {
  isActive?: boolean;
} & Pick<React.ComponentProps<typeof Button>, "size"> &
  React.ComponentProps<"a">;

function PaginationLink({
  className,
  isActive,
  size = "icon",
  ...props
}: PaginationLinkProps) {
  return (
    <a
      aria-current={isActive ? "page" : undefined}
      data-slot="pagination-link"
      data-active={isActive}
      className={cn(
        buttonVariants({
          variant: isActive ? "outline" : "ghost",
          size,
        }),
        className,
      )}
      {...props}
    />
  );
}

function PaginationPrevious({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) {
  return (
    <PaginationLink
      aria-label="Go to previous page"
      size="default"
      className={cn("gap-1 px-2.5 sm:pl-2.5", className)}
      {...props}
    >
      <ChevronLeftIcon />
      <span className="hidden sm:block">Previous</span>
    </PaginationLink>
  );
}

function PaginationNext({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) {
  return (
    <PaginationLink
      aria-label="Go to next page"
      size="default"
      className={cn("gap-1 px-2.5 sm:pr-2.5", className)}
      {...props}
    >
      <span className="hidden sm:block">Next</span>
      <ChevronRightIcon />
    </PaginationLink>
  );
}

function PaginationEllipsis({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      aria-hidden
      data-slot="pagination-ellipsis"
      className={cn("flex size-9 items-center justify-center", className)}
      {...props}
    >
      <MoreHorizontalIcon className="size-4" />
      <span className="sr-only">More pages</span>
    </span>
  );
}

export {
  Pagination,
  PaginationContent,
  PaginationLink,
  PaginationItem,
  PaginationPrevious,
  PaginationNext,
  PaginationEllipsis,
};

"use client";

import * as React from "react";
import * as PopoverPrimitive from "@radix-ui/react-popover";

import { cn } from "./utils";

function Popover({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Root>) {
  return <PopoverPrimitive.Root data-slot="popover" {...props} />;
}

function PopoverTrigger({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Trigger>) {
  return <PopoverPrimitive.Trigger data-slot="popover-trigger" {...props} />;
}

function PopoverContent({
  className,
  align = "center",
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Content>) {
  return (
    <PopoverPrimitive.Portal>
      <PopoverPrimitive.Content
        data-slot="popover-content"
        align={align}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",
          className,
        )}
        {...props}
      />
    </PopoverPrimitive.Portal>
  );
}

function PopoverAnchor({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Anchor>) {
  return <PopoverPrimitive.Anchor data-slot="popover-anchor" {...props} />;
}

export { Popover, PopoverTrigger, PopoverContent, PopoverAnchor };

"use client";

import * as React from "react";
import * as ProgressPrimitive from "@radix-ui/react-progress";

import { cn } from "./utils";

function Progress({
  className,
  value,
  ...props
}: React.ComponentProps<typeof ProgressPrimitive.Root>) {
  return (
    <ProgressPrimitive.Root
      data-slot="progress"
      className={cn(
        "bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",
        className,
      )}
      {...props}
    >
      <ProgressPrimitive.Indicator
        data-slot="progress-indicator"
        className="bg-primary h-full w-full flex-1 transition-all"
        style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
      />
    </ProgressPrimitive.Root>
  );
}

export { Progress };

"use client";

import * as React from "react";
import * as RadioGroupPrimitive from "@radix-ui/react-radio-group";
import { CircleIcon } from "lucide-react";

import { cn } from "./utils";

function RadioGroup({
  className,
  ...props
}: React.ComponentProps<typeof RadioGroupPrimitive.Root>) {
  return (
    <RadioGroupPrimitive.Root
      data-slot="radio-group"
      className={cn("grid gap-3", className)}
      {...props}
    />
  );
}

function RadioGroupItem({
  className,
  ...props
}: React.ComponentProps<typeof RadioGroupPrimitive.Item>) {
  return (
    <RadioGroupPrimitive.Item
      data-slot="radio-group-item"
      className={cn(
        "border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className,
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator
        data-slot="radio-group-indicator"
        className="relative flex items-center justify-center"
      >
        <CircleIcon className="fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  );
}

export { RadioGroup, RadioGroupItem };

"use client";

import * as React from "react";
import { GripVerticalIcon } from "lucide-react";
import * as ResizablePrimitive from "react-resizable-panels";

import { cn } from "./utils";

function ResizablePanelGroup({
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) {
  return (
    <ResizablePrimitive.PanelGroup
      data-slot="resizable-panel-group"
      className={cn(
        "flex h-full w-full data-[panel-group-direction=vertical]:flex-col",
        className,
      )}
      {...props}
    />
  );
}

function ResizablePanel({
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.Panel>) {
  return <ResizablePrimitive.Panel data-slot="resizable-panel" {...props} />;
}

function ResizableHandle({
  withHandle,
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {
  withHandle?: boolean;
}) {
  return (
    <ResizablePrimitive.PanelResizeHandle
      data-slot="resizable-handle"
      className={cn(
        "bg-border focus-visible:ring-ring relative flex w-px items-center justify-center after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:ring-1 focus-visible:ring-offset-1 focus-visible:outline-hidden data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",
        className,
      )}
      {...props}
    >
      {withHandle && (
        <div className="bg-border z-10 flex h-4 w-3 items-center justify-center rounded-xs border">
          <GripVerticalIcon className="size-2.5" />
        </div>
      )}
    </ResizablePrimitive.PanelResizeHandle>
  );
}

export { ResizablePanelGroup, ResizablePanel, ResizableHandle };

"use client";

import * as React from "react";
import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area";

import { cn } from "./utils";

function ScrollArea({
  className,
  children,
  ...props
}: React.ComponentProps<typeof ScrollAreaPrimitive.Root>) {
  return (
    <ScrollAreaPrimitive.Root
      data-slot="scroll-area"
      className={cn("relative", className)}
      {...props}
    >
      <ScrollAreaPrimitive.Viewport
        data-slot="scroll-area-viewport"
        className="focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1"
      >
        {children}
      </ScrollAreaPrimitive.Viewport>
      <ScrollBar />
      <ScrollAreaPrimitive.Corner />
    </ScrollAreaPrimitive.Root>
  );
}

function ScrollBar({
  className,
  orientation = "vertical",
  ...props
}: React.ComponentProps<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>) {
  return (
    <ScrollAreaPrimitive.ScrollAreaScrollbar
      data-slot="scroll-area-scrollbar"
      orientation={orientation}
      className={cn(
        "flex touch-none p-px transition-colors select-none",
        orientation === "vertical" &&
          "h-full w-2.5 border-l border-l-transparent",
        orientation === "horizontal" &&
          "h-2.5 flex-col border-t border-t-transparent",
        className,
      )}
      {...props}
    >
      <ScrollAreaPrimitive.ScrollAreaThumb
        data-slot="scroll-area-thumb"
        className="bg-border relative flex-1 rounded-full"
      />
    </ScrollAreaPrimitive.ScrollAreaScrollbar>
  );
}

export { ScrollArea, ScrollBar };

"use client";

import * as React from "react";
import * as SelectPrimitive from "@radix-ui/react-select";
import {
  CheckIcon,
  ChevronDownIcon,
  ChevronUpIcon,
} from "lucide-react";

import { cn } from "./utils";

function Select({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Root>) {
  return <SelectPrimitive.Root data-slot="select" {...props} />;
}

function SelectGroup({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Group>) {
  return <SelectPrimitive.Group data-slot="select-group" {...props} />;
}

function SelectValue({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Value>) {
  return <SelectPrimitive.Value data-slot="select-value" {...props} />;
}

function SelectTrigger({
  className,
  size = "default",
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Trigger> & {
  size?: "sm" | "default";
}) {
  return (
    <SelectPrimitive.Trigger
      data-slot="select-trigger"
      data-size={size}
      className={cn(
        "border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-full items-center justify-between gap-2 rounded-md border bg-input-background px-3 py-2 text-sm whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      {children}
      <SelectPrimitive.Icon asChild>
        <ChevronDownIcon className="size-4 opacity-50" />
      </SelectPrimitive.Icon>
    </SelectPrimitive.Trigger>
  );
}

function SelectContent({
  className,
  children,
  position = "popper",
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Content>) {
  return (
    <SelectPrimitive.Portal>
      <SelectPrimitive.Content
        data-slot="select-content"
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",
          position === "popper" &&
            "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
          className,
        )}
        position={position}
        {...props}
      >
        <SelectScrollUpButton />
        <SelectPrimitive.Viewport
          className={cn(
            "p-1",
            position === "popper" &&
              "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1",
          )}
        >
          {children}
        </SelectPrimitive.Viewport>
        <SelectScrollDownButton />
      </SelectPrimitive.Content>
    </SelectPrimitive.Portal>
  );
}

function SelectLabel({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Label>) {
  return (
    <SelectPrimitive.Label
      data-slot="select-label"
      className={cn("text-muted-foreground px-2 py-1.5 text-xs", className)}
      {...props}
    />
  );
}

function SelectItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Item>) {
  return (
    <SelectPrimitive.Item
      data-slot="select-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",
        className,
      )}
      {...props}
    >
      <span className="absolute right-2 flex size-3.5 items-center justify-center">
        <SelectPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </SelectPrimitive.ItemIndicator>
      </span>
      <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
    </SelectPrimitive.Item>
  );
}

function SelectSeparator({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Separator>) {
  return (
    <SelectPrimitive.Separator
      data-slot="select-separator"
      className={cn("bg-border pointer-events-none -mx-1 my-1 h-px", className)}
      {...props}
    />
  );
}

function SelectScrollUpButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollUpButton>) {
  return (
    <SelectPrimitive.ScrollUpButton
      data-slot="select-scroll-up-button"
      className={cn(
        "flex cursor-default items-center justify-center py-1",
        className,
      )}
      {...props}
    >
      <ChevronUpIcon className="size-4" />
    </SelectPrimitive.ScrollUpButton>
  );
}

function SelectScrollDownButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollDownButton>) {
  return (
    <SelectPrimitive.ScrollDownButton
      data-slot="select-scroll-down-button"
      className={cn(
        "flex cursor-default items-center justify-center py-1",
        className,
      )}
      {...props}
    >
      <ChevronDownIcon className="size-4" />
    </SelectPrimitive.ScrollDownButton>
  );
}

export {
  Select,
  SelectContent,
  SelectGroup,
  SelectItem,
  SelectLabel,
  SelectScrollDownButton,
  SelectScrollUpButton,
  SelectSeparator,
  SelectTrigger,
  SelectValue,
};

"use client";

import * as React from "react";
import * as SeparatorPrimitive from "@radix-ui/react-separator";

import { cn } from "./utils";

function Separator({
  className,
  orientation = "horizontal",
  decorative = true,
  ...props
}: React.ComponentProps<typeof SeparatorPrimitive.Root>) {
  return (
    <SeparatorPrimitive.Root
      data-slot="separator-root"
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",
        className,
      )}
      {...props}
    />
  );
}

export { Separator };

"use client";

import * as React from "react";
import * as SheetPrimitive from "@radix-ui/react-dialog";
import { XIcon } from "lucide-react";

import { cn } from "./utils";

function Sheet({ ...props }: React.ComponentProps<typeof SheetPrimitive.Root>) {
  return <SheetPrimitive.Root data-slot="sheet" {...props} />;
}

function SheetTrigger({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Trigger>) {
  return <SheetPrimitive.Trigger data-slot="sheet-trigger" {...props} />;
}

function SheetClose({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Close>) {
  return <SheetPrimitive.Close data-slot="sheet-close" {...props} />;
}

function SheetPortal({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Portal>) {
  return <SheetPrimitive.Portal data-slot="sheet-portal" {...props} />;
}

function SheetOverlay({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Overlay>) {
  return (
    <SheetPrimitive.Overlay
      data-slot="sheet-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className,
      )}
      {...props}
    />
  );
}

function SheetContent({
  className,
  children,
  side = "right",
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Content> & {
  side?: "top" | "right" | "bottom" | "left";
}) {
  return (
    <SheetPortal>
      <SheetOverlay />
      <SheetPrimitive.Content
        data-slot="sheet-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
          side === "right" &&
            "data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",
          side === "left" &&
            "data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",
          side === "top" &&
            "data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",
          side === "bottom" &&
            "data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",
          className,
        )}
        {...props}
      >
        {children}
        <SheetPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none">
          <XIcon className="size-4" />
          <span className="sr-only">Close</span>
        </SheetPrimitive.Close>
      </SheetPrimitive.Content>
    </SheetPortal>
  );
}

function SheetHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sheet-header"
      className={cn("flex flex-col gap-1.5 p-4", className)}
      {...props}
    />
  );
}

function SheetFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sheet-footer"
      className={cn("mt-auto flex flex-col gap-2 p-4", className)}
      {...props}
    />
  );
}

function SheetTitle({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Title>) {
  return (
    <SheetPrimitive.Title
      data-slot="sheet-title"
      className={cn("text-foreground font-semibold", className)}
      {...props}
    />
  );
}

function SheetDescription({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Description>) {
  return (
    <SheetPrimitive.Description
      data-slot="sheet-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Sheet,
  SheetTrigger,
  SheetClose,
  SheetContent,
  SheetHeader,
  SheetFooter,
  SheetTitle,
  SheetDescription,
};

"use client";

import * as React from "react";
import { Slot } from "@radix-ui/react-slot";
import { VariantProps, cva } from "class-variance-authority";
import { PanelLeftIcon } from "lucide-react";

import { useIsMobile } from "./use-mobile";
import { cn } from "./utils";
import { Button } from "./button";
import { Input } from "./input";
import { Separator } from "./separator";
import {
  Sheet,
  SheetContent,
  SheetDescription,
  SheetHeader,
  SheetTitle,
} from "./sheet";
import { Skeleton } from "./skeleton";
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "./tooltip";

const SIDEBAR_COOKIE_NAME = "sidebar_state";
const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7;
const SIDEBAR_WIDTH = "16rem";
const SIDEBAR_WIDTH_MOBILE = "18rem";
const SIDEBAR_WIDTH_ICON = "3rem";
const SIDEBAR_KEYBOARD_SHORTCUT = "b";

type SidebarContextProps = {
  state: "expanded" | "collapsed";
  open: boolean;
  setOpen: (open: boolean) => void;
  openMobile: boolean;
  setOpenMobile: (open: boolean) => void;
  isMobile: boolean;
  toggleSidebar: () => void;
};

const SidebarContext = React.createContext<SidebarContextProps | null>(null);

function useSidebar() {
  const context = React.useContext(SidebarContext);
  if (!context) {
    throw new Error("useSidebar must be used within a SidebarProvider.");
  }

  return context;
}

function SidebarProvider({
  defaultOpen = true,
  open: openProp,
  onOpenChange: setOpenProp,
  className,
  style,
  children,
  ...props
}: React.ComponentProps<"div"> & {
  defaultOpen?: boolean;
  open?: boolean;
  onOpenChange?: (open: boolean) => void;
}) {
  const isMobile = useIsMobile();
  const [openMobile, setOpenMobile] = React.useState(false);

  // This is the internal state of the sidebar.
  // We use openProp and setOpenProp for control from outside the component.
  const [_open, _setOpen] = React.useState(defaultOpen);
  const open = openProp ?? _open;
  const setOpen = React.useCallback(
    (value: boolean | ((value: boolean) => boolean)) => {
      const openState = typeof value === "function" ? value(open) : value;
      if (setOpenProp) {
        setOpenProp(openState);
      } else {
        _setOpen(openState);
      }

      // This sets the cookie to keep the sidebar state.
      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`;
    },
    [setOpenProp, open],
  );

  // Helper to toggle the sidebar.
  const toggleSidebar = React.useCallback(() => {
    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open);
  }, [isMobile, setOpen, setOpenMobile]);

  // Adds a keyboard shortcut to toggle the sidebar.
  React.useEffect(() => {
    const handleKeyDown = (event: KeyboardEvent) => {
      if (
        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&
        (event.metaKey || event.ctrlKey)
      ) {
        event.preventDefault();
        toggleSidebar();
      }
    };

    window.addEventListener("keydown", handleKeyDown);
    return () => window.removeEventListener("keydown", handleKeyDown);
  }, [toggleSidebar]);

  // We add a state so that we can do data-state="expanded" or "collapsed".
  // This makes it easier to style the sidebar with Tailwind classes.
  const state = open ? "expanded" : "collapsed";

  const contextValue = React.useMemo<SidebarContextProps>(
    () => ({
      state,
      open,
      setOpen,
      isMobile,
      openMobile,
      setOpenMobile,
      toggleSidebar,
    }),
    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar],
  );

  return (
    <SidebarContext.Provider value={contextValue}>
      <TooltipProvider delayDuration={0}>
        <div
          data-slot="sidebar-wrapper"
          style={
            {
              "--sidebar-width": SIDEBAR_WIDTH,
              "--sidebar-width-icon": SIDEBAR_WIDTH_ICON,
              ...style,
            } as React.CSSProperties
          }
          className={cn(
            "group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full",
            className,
          )}
          {...props}
        >
          {children}
        </div>
      </TooltipProvider>
    </SidebarContext.Provider>
  );
}

function Sidebar({
  side = "left",
  variant = "sidebar",
  collapsible = "offcanvas",
  className,
  children,
  ...props
}: React.ComponentProps<"div"> & {
  side?: "left" | "right";
  variant?: "sidebar" | "floating" | "inset";
  collapsible?: "offcanvas" | "icon" | "none";
}) {
  const { isMobile, state, openMobile, setOpenMobile } = useSidebar();

  if (collapsible === "none") {
    return (
      <div
        data-slot="sidebar"
        className={cn(
          "bg-sidebar text-sidebar-foreground flex h-full w-(--sidebar-width) flex-col",
          className,
        )}
        {...props}
      >
        {children}
      </div>
    );
  }

  if (isMobile) {
    return (
      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>
        <SheetContent
          data-sidebar="sidebar"
          data-slot="sidebar"
          data-mobile="true"
          className="bg-sidebar text-sidebar-foreground w-(--sidebar-width) p-0 [&>button]:hidden"
          style={
            {
              "--sidebar-width": SIDEBAR_WIDTH_MOBILE,
            } as React.CSSProperties
          }
          side={side}
        >
          <SheetHeader className="sr-only">
            <SheetTitle>Sidebar</SheetTitle>
            <SheetDescription>Displays the mobile sidebar.</SheetDescription>
          </SheetHeader>
          <div className="flex h-full w-full flex-col">{children}</div>
        </SheetContent>
      </Sheet>
    );
  }

  return (
    <div
      className="group peer text-sidebar-foreground hidden md:block"
      data-state={state}
      data-collapsible={state === "collapsed" ? collapsible : ""}
      data-variant={variant}
      data-side={side}
      data-slot="sidebar"
    >
      {/* This is what handles the sidebar gap on desktop */}
      <div
        data-slot="sidebar-gap"
        className={cn(
          "relative w-(--sidebar-width) bg-transparent transition-[width] duration-200 ease-linear",
          "group-data-[collapsible=offcanvas]:w-0",
          "group-data-[side=right]:rotate-180",
          variant === "floating" || variant === "inset"
            ? "group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4)))]"
            : "group-data-[collapsible=icon]:w-(--sidebar-width-icon)",
        )}
      />
      <div
        data-slot="sidebar-container"
        className={cn(
          "fixed inset-y-0 z-10 hidden h-svh w-(--sidebar-width) transition-[left,right,width] duration-200 ease-linear md:flex",
          side === "left"
            ? "left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]"
            : "right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",
          // Adjust the padding for floating and inset variants.
          variant === "floating" || variant === "inset"
            ? "p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4))+2px)]"
            : "group-data-[collapsible=icon]:w-(--sidebar-width-icon) group-data-[side=left]:border-r group-data-[side=right]:border-l",
          className,
        )}
        {...props}
      >
        <div
          data-sidebar="sidebar"
          data-slot="sidebar-inner"
          className="bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm"
        >
          {children}
        </div>
      </div>
    </div>
  );
}

function SidebarTrigger({
  className,
  onClick,
  ...props
}: React.ComponentProps<typeof Button>) {
  const { toggleSidebar } = useSidebar();

  return (
    <Button
      data-sidebar="trigger"
      data-slot="sidebar-trigger"
      variant="ghost"
      size="icon"
      className={cn("size-7", className)}
      onClick={(event) => {
        onClick?.(event);
        toggleSidebar();
      }}
      {...props}
    >
      <PanelLeftIcon />
      <span className="sr-only">Toggle Sidebar</span>
    </Button>
  );
}

function SidebarRail({ className, ...props }: React.ComponentProps<"button">) {
  const { toggleSidebar } = useSidebar();

  return (
    <button
      data-sidebar="rail"
      data-slot="sidebar-rail"
      aria-label="Toggle Sidebar"
      tabIndex={-1}
      onClick={toggleSidebar}
      title="Toggle Sidebar"
      className={cn(
        "hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex",
        "in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize",
        "[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize",
        "hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full",
        "[[data-side=left][data-collapsible=offcanvas]_&]:-right-2",
        "[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",
        className,
      )}
      {...props}
    />
  );
}

function SidebarInset({ className, ...props }: React.ComponentProps<"main">) {
  return (
    <main
      data-slot="sidebar-inset"
      className={cn(
        "bg-background relative flex w-full flex-1 flex-col",
        "md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2",
        className,
      )}
      {...props}
    />
  );
}

function SidebarInput({
  className,
  ...props
}: React.ComponentProps<typeof Input>) {
  return (
    <Input
      data-slot="sidebar-input"
      data-sidebar="input"
      className={cn("bg-background h-8 w-full shadow-none", className)}
      {...props}
    />
  );
}

function SidebarHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-header"
      data-sidebar="header"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  );
}

function SidebarFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-footer"
      data-sidebar="footer"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  );
}

function SidebarSeparator({
  className,
  ...props
}: React.ComponentProps<typeof Separator>) {
  return (
    <Separator
      data-slot="sidebar-separator"
      data-sidebar="separator"
      className={cn("bg-sidebar-border mx-2 w-auto", className)}
      {...props}
    />
  );
}

function SidebarContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-content"
      data-sidebar="content"
      className={cn(
        "flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-group"
      data-sidebar="group"
      className={cn("relative flex w-full min-w-0 flex-col p-2", className)}
      {...props}
    />
  );
}

function SidebarGroupLabel({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<"div"> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : "div";

  return (
    <Comp
      data-slot="sidebar-group-label"
      data-sidebar="group-label"
      className={cn(
        "text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        "group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",
        className,
      )}
      {...props}
    />
  );
}

function SidebarGroupAction({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<"button"> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : "button";

  return (
    <Comp
      data-slot="sidebar-group-action"
      data-sidebar="group-action"
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 md:after:hidden",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarGroupContent({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-group-content"
      data-sidebar="group-content"
      className={cn("w-full text-sm", className)}
      {...props}
    />
  );
}

function SidebarMenu({ className, ...props }: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="sidebar-menu"
      data-sidebar="menu"
      className={cn("flex w-full min-w-0 flex-col gap-1", className)}
      {...props}
    />
  );
}

function SidebarMenuItem({ className, ...props }: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="sidebar-menu-item"
      data-sidebar="menu-item"
      className={cn("group/menu-item relative", className)}
      {...props}
    />
  );
}

const sidebarMenuButtonVariants = cva(
  "peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:size-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",
        outline:
          "bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]",
      },
      size: {
        default: "h-8 text-sm",
        sm: "h-7 text-xs",
        lg: "h-12 text-sm group-data-[collapsible=icon]:p-0!",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
);

function SidebarMenuButton({
  asChild = false,
  isActive = false,
  variant = "default",
  size = "default",
  tooltip,
  className,
  ...props
}: React.ComponentProps<"button"> & {
  asChild?: boolean;
  isActive?: boolean;
  tooltip?: string | React.ComponentProps<typeof TooltipContent>;
} & VariantProps<typeof sidebarMenuButtonVariants>) {
  const Comp = asChild ? Slot : "button";
  const { isMobile, state } = useSidebar();

  const button = (
    <Comp
      data-slot="sidebar-menu-button"
      data-sidebar="menu-button"
      data-size={size}
      data-active={isActive}
      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}
      {...props}
    />
  );

  if (!tooltip) {
    return button;
  }

  if (typeof tooltip === "string") {
    tooltip = {
      children: tooltip,
    };
  }

  return (
    <Tooltip>
      <TooltipTrigger asChild>{button}</TooltipTrigger>
      <TooltipContent
        side="right"
        align="center"
        hidden={state !== "collapsed" || isMobile}
        {...tooltip}
      />
    </Tooltip>
  );
}

function SidebarMenuAction({
  className,
  asChild = false,
  showOnHover = false,
  ...props
}: React.ComponentProps<"button"> & {
  asChild?: boolean;
  showOnHover?: boolean;
}) {
  const Comp = asChild ? Slot : "button";

  return (
    <Comp
      data-slot="sidebar-menu-action"
      data-sidebar="menu-action"
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 md:after:hidden",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        showOnHover &&
          "peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0",
        className,
      )}
      {...props}
    />
  );
}

function SidebarMenuBadge({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-menu-badge"
      data-sidebar="menu-badge"
      className={cn(
        "text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none",
        "peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarMenuSkeleton({
  className,
  showIcon = false,
  ...props
}: React.ComponentProps<"div"> & {
  showIcon?: boolean;
}) {
  // Random width between 50 to 90%.
  const width = React.useMemo(() => {
    return `${Math.floor(Math.random() * 40) + 50}%`;
  }, []);

  return (
    <div
      data-slot="sidebar-menu-skeleton"
      data-sidebar="menu-skeleton"
      className={cn("flex h-8 items-center gap-2 rounded-md px-2", className)}
      {...props}
    >
      {showIcon && (
        <Skeleton
          className="size-4 rounded-md"
          data-sidebar="menu-skeleton-icon"
        />
      )}
      <Skeleton
        className="h-4 max-w-(--skeleton-width) flex-1"
        data-sidebar="menu-skeleton-text"
        style={
          {
            "--skeleton-width": width,
          } as React.CSSProperties
        }
      />
    </div>
  );
}

function SidebarMenuSub({ className, ...props }: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="sidebar-menu-sub"
      data-sidebar="menu-sub"
      className={cn(
        "border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarMenuSubItem({
  className,
  ...props
}: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="sidebar-menu-sub-item"
      data-sidebar="menu-sub-item"
      className={cn("group/menu-sub-item relative", className)}
      {...props}
    />
  );
}

function SidebarMenuSubButton({
  asChild = false,
  size = "md",
  isActive = false,
  className,
  ...props
}: React.ComponentProps<"a"> & {
  asChild?: boolean;
  size?: "sm" | "md";
  isActive?: boolean;
}) {
  const Comp = asChild ? Slot : "a";

  return (
    <Comp
      data-slot="sidebar-menu-sub-button"
      data-sidebar="menu-sub-button"
      data-size={size}
      data-active={isActive}
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline-hidden focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
        "data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",
        size === "sm" && "text-xs",
        size === "md" && "text-sm",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

export {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupAction,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarInput,
  SidebarInset,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuBadge,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSkeleton,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  SidebarProvider,
  SidebarRail,
  SidebarSeparator,
  SidebarTrigger,
  useSidebar,
};

import { cn } from "./utils";

function Skeleton({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="skeleton"
      className={cn("bg-accent animate-pulse rounded-md", className)}
      {...props}
    />
  );
}

export { Skeleton };

"use client";

import * as React from "react";
import * as SliderPrimitive from "@radix-ui/react-slider";

import { cn } from "./utils";

function Slider({
  className,
  defaultValue,
  value,
  min = 0,
  max = 100,
  ...props
}: React.ComponentProps<typeof SliderPrimitive.Root>) {
  const _values = React.useMemo(
    () =>
      Array.isArray(value)
        ? value
        : Array.isArray(defaultValue)
          ? defaultValue
          : [min, max],
    [value, defaultValue, min, max],
  );

  return (
    <SliderPrimitive.Root
      data-slot="slider"
      defaultValue={defaultValue}
      value={value}
      min={min}
      max={max}
      className={cn(
        "relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",
        className,
      )}
      {...props}
    >
      <SliderPrimitive.Track
        data-slot="slider-track"
        className={cn(
          "bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-4 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5",
        )}
      >
        <SliderPrimitive.Range
          data-slot="slider-range"
          className={cn(
            "bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full",
          )}
        />
      </SliderPrimitive.Track>
      {Array.from({ length: _values.length }, (_, index) => (
        <SliderPrimitive.Thumb
          data-slot="slider-thumb"
          key={index}
          className="border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"
        />
      ))}
    </SliderPrimitive.Root>
  );
}

export { Slider };

"use client";

import { useTheme } from "next-themes";
import { Toaster as Sonner, ToasterProps } from "sonner";

const Toaster = ({ ...props }: ToasterProps) => {
  const { theme = "system" } = useTheme();

  return (
    <Sonner
      theme={theme as ToasterProps["theme"]}
      className="toaster group"
      style={
        {
          "--normal-bg": "var(--popover)",
          "--normal-text": "var(--popover-foreground)",
          "--normal-border": "var(--border)",
        } as React.CSSProperties
      }
      {...props}
    />
  );
};

export { Toaster };

"use client";

import * as React from "react";
import * as SwitchPrimitive from "@radix-ui/react-switch";

import { cn } from "./utils";

function Switch({
  className,
  ...props
}: React.ComponentProps<typeof SwitchPrimitive.Root>) {
  return (
    <SwitchPrimitive.Root
      data-slot="switch"
      className={cn(
        "peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-switch-background focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className,
      )}
      {...props}
    >
      <SwitchPrimitive.Thumb
        data-slot="switch-thumb"
        className={cn(
          "bg-card dark:data-[state=unchecked]:bg-card-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0",
        )}
      />
    </SwitchPrimitive.Root>
  );
}

export { Switch };

"use client";

import * as React from "react";

import { cn } from "./utils";

function Table({ className, ...props }: React.ComponentProps<"table">) {
  return (
    <div
      data-slot="table-container"
      className="relative w-full overflow-x-auto"
    >
      <table
        data-slot="table"
        className={cn("w-full caption-bottom text-sm", className)}
        {...props}
      />
    </div>
  );
}

function TableHeader({ className, ...props }: React.ComponentProps<"thead">) {
  return (
    <thead
      data-slot="table-header"
      className={cn("[&_tr]:border-b", className)}
      {...props}
    />
  );
}

function TableBody({ className, ...props }: React.ComponentProps<"tbody">) {
  return (
    <tbody
      data-slot="table-body"
      className={cn("[&_tr:last-child]:border-0", className)}
      {...props}
    />
  );
}

function TableFooter({ className, ...props }: React.ComponentProps<"tfoot">) {
  return (
    <tfoot
      data-slot="table-footer"
      className={cn(
        "bg-muted/50 border-t font-medium [&>tr]:last:border-b-0",
        className,
      )}
      {...props}
    />
  );
}

function TableRow({ className, ...props }: React.ComponentProps<"tr">) {
  return (
    <tr
      data-slot="table-row"
      className={cn(
        "hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",
        className,
      )}
      {...props}
    />
  );
}

function TableHead({ className, ...props }: React.ComponentProps<"th">) {
  return (
    <th
      data-slot="table-head"
      className={cn(
        "text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className,
      )}
      {...props}
    />
  );
}

function TableCell({ className, ...props }: React.ComponentProps<"td">) {
  return (
    <td
      data-slot="table-cell"
      className={cn(
        "p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className,
      )}
      {...props}
    />
  );
}

function TableCaption({
  className,
  ...props
}: React.ComponentProps<"caption">) {
  return (
    <caption
      data-slot="table-caption"
      className={cn("text-muted-foreground mt-4 text-sm", className)}
      {...props}
    />
  );
}

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
};

"use client";

import * as React from "react";
import * as TabsPrimitive from "@radix-ui/react-tabs";

import { cn } from "./utils";

function Tabs({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Root>) {
  return (
    <TabsPrimitive.Root
      data-slot="tabs"
      className={cn("flex flex-col gap-2", className)}
      {...props}
    />
  );
}

function TabsList({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.List>) {
  return (
    <TabsPrimitive.List
      data-slot="tabs-list"
      className={cn(
        "bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-xl p-[3px] flex",
        className,
      )}
      {...props}
    />
  );
}

function TabsTrigger({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Trigger>) {
  return (
    <TabsPrimitive.Trigger
      data-slot="tabs-trigger"
      className={cn(
        "data-[state=active]:bg-card dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-xl border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  );
}

function TabsContent({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Content>) {
  return (
    <TabsPrimitive.Content
      data-slot="tabs-content"
      className={cn("flex-1 outline-none", className)}
      {...props}
    />
  );
}

export { Tabs, TabsList, TabsTrigger, TabsContent };

import * as React from "react";

import { cn } from "./utils";

function Textarea({ className, ...props }: React.ComponentProps<"textarea">) {
  return (
    <textarea
      data-slot="textarea"
      className={cn(
        "resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        className,
      )}
      {...props}
    />
  );
}

export { Textarea };

"use client";

import * as React from "react";
import * as ToggleGroupPrimitive from "@radix-ui/react-toggle-group";
import { type VariantProps } from "class-variance-authority";

import { cn } from "./utils";
import { toggleVariants } from "./toggle";

const ToggleGroupContext = React.createContext<
  VariantProps<typeof toggleVariants>
>({
  size: "default",
  variant: "default",
});

function ToggleGroup({
  className,
  variant,
  size,
  children,
  ...props
}: React.ComponentProps<typeof ToggleGroupPrimitive.Root> &
  VariantProps<typeof toggleVariants>) {
  return (
    <ToggleGroupPrimitive.Root
      data-slot="toggle-group"
      data-variant={variant}
      data-size={size}
      className={cn(
        "group/toggle-group flex w-fit items-center rounded-md data-[variant=outline]:shadow-xs",
        className,
      )}
      {...props}
    >
      <ToggleGroupContext.Provider value={{ variant, size }}>
        {children}
      </ToggleGroupContext.Provider>
    </ToggleGroupPrimitive.Root>
  );
}

function ToggleGroupItem({
  className,
  children,
  variant,
  size,
  ...props
}: React.ComponentProps<typeof ToggleGroupPrimitive.Item> &
  VariantProps<typeof toggleVariants>) {
  const context = React.useContext(ToggleGroupContext);

  return (
    <ToggleGroupPrimitive.Item
      data-slot="toggle-group-item"
      data-variant={context.variant || variant}
      data-size={context.size || size}
      className={cn(
        toggleVariants({
          variant: context.variant || variant,
          size: context.size || size,
        }),
        "min-w-0 flex-1 shrink-0 rounded-none shadow-none first:rounded-l-md last:rounded-r-md focus:z-10 focus-visible:z-10 data-[variant=outline]:border-l-0 data-[variant=outline]:first:border-l",
        className,
      )}
      {...props}
    >
      {children}
    </ToggleGroupPrimitive.Item>
  );
}

export { ToggleGroup, ToggleGroupItem };

"use client";

import * as React from "react";
import * as TogglePrimitive from "@radix-ui/react-toggle";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "./utils";

const toggleVariants = cva(
  "inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium hover:bg-muted hover:text-muted-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:shrink-0 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] outline-none transition-[color,box-shadow] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive whitespace-nowrap",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        outline:
          "border border-input bg-transparent hover:bg-accent hover:text-accent-foreground",
      },
      size: {
        default: "h-9 px-2 min-w-9",
        sm: "h-8 px-1.5 min-w-8",
        lg: "h-10 px-2.5 min-w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
);

function Toggle({
  className,
  variant,
  size,
  ...props
}: React.ComponentProps<typeof TogglePrimitive.Root> &
  VariantProps<typeof toggleVariants>) {
  return (
    <TogglePrimitive.Root
      data-slot="toggle"
      className={cn(toggleVariants({ variant, size, className }))}
      {...props}
    />
  );
}

export { Toggle, toggleVariants };

"use client";

import * as React from "react";
import * as TooltipPrimitive from "@radix-ui/react-tooltip";

import { cn } from "./utils";

function TooltipProvider({
  delayDuration = 0,
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Provider>) {
  return (
    <TooltipPrimitive.Provider
      data-slot="tooltip-provider"
      delayDuration={delayDuration}
      {...props}
    />
  );
}

function Tooltip({
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Root>) {
  return (
    <TooltipProvider>
      <TooltipPrimitive.Root data-slot="tooltip" {...props} />
    </TooltipProvider>
  );
}

function TooltipTrigger({
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Trigger>) {
  return <TooltipPrimitive.Trigger data-slot="tooltip-trigger" {...props} />;
}

function TooltipContent({
  className,
  sideOffset = 0,
  children,
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Content>) {
  return (
    <TooltipPrimitive.Portal>
      <TooltipPrimitive.Content
        data-slot="tooltip-content"
        sideOffset={sideOffset}
        className={cn(
          "bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",
          className,
        )}
        {...props}
      >
        {children}
        <TooltipPrimitive.Arrow className="bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]" />
      </TooltipPrimitive.Content>
    </TooltipPrimitive.Portal>
  );
}

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider };

import * as React from "react";

const MOBILE_BREAKPOINT = 768;

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(
    undefined,
  );

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`);
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT);
    };
    mql.addEventListener("change", onChange);
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT);
    return () => mql.removeEventListener("change", onChange);
  }, []);

  return !!isMobile;
}

import { clsx, type ClassValue } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}

import { User, Settings, Bell, HelpCircle, FileText, LogOut, ChevronRight, ShieldAlert, Sun, Moon, Type, Zap, Contrast } from "lucide-react";
import { Card, CardContent } from "./ui/card";
import { Button } from "./ui/button";
import { Avatar, AvatarFallback } from "./ui/avatar";
import { Switch } from "./ui/switch";
import { useTheme } from "./ThemeProvider";
import { useState } from "react";
import { Vehicle } from "../types/vehicle";
import { toast } from "sonner";

interface AccountScreenProps {
  onLogout: () => void;
  onNavigateToSettings: () => void;
  vehicles: Vehicle[];
}

export function AccountScreen({ onLogout, onNavigateToSettings, vehicles }: AccountScreenProps) {
  const { theme, toggleTheme, accessibility, updateAccessibility } = useTheme();

  const handleProfileSettings = () => {
    toast.info("Profile Settings", {
      description: "Edit your personal information, email, and account details.",
      duration: 3000,
    });
  };

  const handleNotifications = () => {
    toast.info("Notification Preferences", {
      description: "Manage email, push, and in-app notification settings.",
      duration: 3000,
    });
  };

  const handleHelpSupport = () => {
    toast.info("Help & Support", {
      description: "Access FAQs, contact support, or schedule a callback.",
      duration: 3000,
    });
  };

  const handlePrivacyPolicy = () => {
    toast.info("Privacy Policy", {
      description: "Review how we protect and use your data.",
      duration: 3000,
    });
  };

  const menuItems = [
    { icon: User, label: "Profile Settings", color: "text-[#0070E1]", bg: "bg-[#0070E1]/20", action: handleProfileSettings },
    { icon: ShieldAlert, label: "Hazard Scout Settings", color: "text-[#0070E1]", bg: "bg-[#0070E1]/20", action: onNavigateToSettings },
    { icon: Bell, label: "Notifications", color: "text-amber-400", bg: "bg-amber-500/20", action: handleNotifications },
    { icon: HelpCircle, label: "Help & Support", color: "text-green-400", bg: "bg-green-500/20", action: handleHelpSupport },
    { icon: FileText, label: "Privacy Policy", color: "text-slate-400", bg: "bg-slate-400/20 dark:bg-slate-700/50", action: handlePrivacyPolicy },
  ];

  return (
    <div className="min-h-screen bg-slate-50 dark:bg-slate-950 pb-24">
      {/* Header */}
      <div className="bg-gradient-to-b from-slate-100 to-slate-50 dark:from-slate-900 dark:to-slate-950 px-4 pt-6 pb-4">
        <h1 className="text-slate-900 dark:text-slate-100 text-xl mb-1">Account Settings</h1>
        <p className="text-slate-600 dark:text-slate-400 text-sm">Manage your profile and preferences</p>
      </div>

      {/* Profile Card */}
      <div className="px-4 -mt-2">
        <Card className="bg-gradient-to-br from-white to-slate-50 dark:from-slate-900/90 dark:to-slate-800/90 backdrop-blur-xl border-slate-200 dark:border-slate-700/50">
          <CardContent className="p-6">
            <div className="flex items-center gap-4">
              <Avatar className="w-16 h-16 border-2 border-[#0070E1]">
                <AvatarFallback className="bg-[#0070E1] text-white text-xl">
                  DR
                </AvatarFallback>
              </Avatar>
              <div className="flex-1">
                <h3 className="text-slate-900 dark:text-slate-100 text-lg mb-1">Driver Account</h3>
                <p className="text-slate-600 dark:text-slate-400 text-sm">driver@vwconnect.com</p>
                <p className="text-slate-500 dark:text-slate-500 text-xs mt-1">{vehicles.length} {vehicles.length === 1 ? 'Vehicle' : 'Vehicles'}  Member since Jan 2024</p>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Theme Settings */}
      <div className="px-4 mt-6">
        <h3 className="text-slate-700 dark:text-slate-300 text-sm mb-3">Appearance</h3>
        <Card className="bg-white dark:bg-slate-900/90 border-slate-200 dark:border-slate-700/50">
          <CardContent className="p-4">
            {/* Theme Toggle */}
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-700/50 flex items-center justify-center">
                  {theme === 'dark' ? (
                    <Moon className="w-5 h-5 text-[#0070E1]" />
                  ) : (
                    <Sun className="w-5 h-5 text-[#0070E1]" />
                  )}
                </div>
                <div>
                  <p className="text-slate-900 dark:text-slate-200 text-sm">
                    {theme === 'dark' ? 'Dark Mode' : 'Light Mode'}
                  </p>
                  <p className="text-slate-500 dark:text-slate-400 text-xs">
                    Switch between themes
                  </p>
                </div>
              </div>
              <Switch
                checked={theme === 'dark'}
                onCheckedChange={toggleTheme}
              />
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Accessibility Settings */}
      <div className="px-4 mt-6">
        <h3 className="text-slate-700 dark:text-slate-300 text-sm mb-3">Accessibility Options</h3>
        <Card className="bg-white dark:bg-slate-900/90 border-slate-200 dark:border-slate-700/50">
          <CardContent className="p-4 space-y-4">
              {/* Text Size */}
              <div>
                <div className="flex items-center gap-3 mb-3">
                  <div className="w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-700/50 flex items-center justify-center">
                    <Type className="w-5 h-5 text-purple-400" />
                  </div>
                  <div className="flex-1">
                    <p className="text-slate-900 dark:text-slate-200 text-sm">Text Size</p>
                    <p className="text-slate-500 dark:text-slate-400 text-xs">
                      {accessibility.textSize === 'normal' ? 'Normal' : accessibility.textSize === 'large' ? 'Large' : 'Extra Large'}
                    </p>
                  </div>
                </div>
                <div className="flex gap-2 ml-13">
                  <Button
                    variant={accessibility.textSize === 'normal' ? 'default' : 'outline'}
                    size="sm"
                    onClick={() => updateAccessibility({ textSize: 'normal' })}
                    className={accessibility.textSize === 'normal' ? 'bg-[#0070E1]' : ''}
                  >
                    A
                  </Button>
                  <Button
                    variant={accessibility.textSize === 'large' ? 'default' : 'outline'}
                    size="sm"
                    onClick={() => updateAccessibility({ textSize: 'large' })}
                    className={accessibility.textSize === 'large' ? 'bg-[#0070E1] text-lg' : 'text-lg'}
                  >
                    A
                  </Button>
                  <Button
                    variant={accessibility.textSize === 'xlarge' ? 'default' : 'outline'}
                    size="sm"
                    onClick={() => updateAccessibility({ textSize: 'xlarge' })}
                    className={accessibility.textSize === 'xlarge' ? 'bg-[#0070E1] text-xl' : 'text-xl'}
                  >
                    A
                  </Button>
                </div>
              </div>

              {/* Reduced Motion */}
              <div className="flex items-center justify-between pt-4 border-t border-slate-200 dark:border-slate-700/30">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-700/50 flex items-center justify-center">
                    <Zap className="w-5 h-5 text-amber-400" />
                  </div>
                  <div>
                    <p className="text-slate-900 dark:text-slate-200 text-sm">Reduce Motion</p>
                    <p className="text-slate-500 dark:text-slate-400 text-xs">Less animation effects</p>
                  </div>
                </div>
                <Switch
                  checked={accessibility.reducedMotion}
                  onCheckedChange={(checked) => updateAccessibility({ reducedMotion: checked })}
                />
              </div>

              {/* High Contrast */}
              <div className="flex items-center justify-between pt-4 border-t border-slate-200 dark:border-slate-700/30">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-700/50 flex items-center justify-center">
                    <Contrast className="w-5 h-5 text-green-400" />
                  </div>
                  <div>
                    <p className="text-slate-900 dark:text-slate-200 text-sm">High Contrast</p>
                    <p className="text-slate-500 dark:text-slate-400 text-xs">Stronger color differences</p>
                  </div>
                </div>
                <Switch
                  checked={accessibility.highContrast}
                  onCheckedChange={(checked) => updateAccessibility({ highContrast: checked })}
                />
              </div>
            </CardContent>
          </Card>
      </div>

      {/* Menu Items */}
      <div className="px-4 mt-6">
        <h3 className="text-slate-700 dark:text-slate-300 text-sm mb-3">Settings</h3>
        <div className="space-y-2">
          {menuItems.map((item, index) => {
            const Icon = item.icon;
            return (
              <Card
                key={index}
                onClick={item.action || undefined}
                className="bg-white dark:bg-slate-900/90 border-slate-200 dark:border-slate-700/50 backdrop-blur-xl hover:bg-slate-50 dark:hover:bg-slate-800/90 transition-colors cursor-pointer"
              >
                <CardContent className="p-4">
                  <div className="flex items-center gap-3">
                    <div className={`w-10 h-10 rounded-full ${item.bg} flex items-center justify-center`}>
                      <Icon className={`w-5 h-5 ${item.color}`} />
                    </div>
                    <span className="text-slate-900 dark:text-slate-200 text-sm flex-1">{item.label}</span>
                    <ChevronRight className="w-5 h-5 text-slate-400 dark:text-slate-500" />
                  </div>
                </CardContent>
              </Card>
            );
          })}
        </div>
      </div>

      {/* App Version */}
      <div className="px-4 mt-6">
        <Card className="bg-slate-100 dark:bg-slate-900/50 border-slate-200 dark:border-slate-700/30">
          <CardContent className="p-4 text-center">
            <p className="text-slate-600 dark:text-slate-500 text-xs">App Version</p>
            <p className="text-slate-700 dark:text-slate-400 text-sm mt-1">2.5.0</p>
          </CardContent>
        </Card>
      </div>

      {/* Logout Button */}
      <div className="px-4 mt-6 mb-6">
        <Button
          onClick={onLogout}
          variant="outline"
          className="w-full bg-red-500/10 border-red-500/30 text-red-400 hover:bg-red-500/20 hover:text-red-300 h-12"
        >
          <LogOut className="w-5 h-5 mr-2" />
          Sign Out
        </Button>
      </div>
    </div>
  );
}

import { Home, ShieldCheck, Wrench, User, Shield } from "lucide-react";

interface BottomNavigationProps {
  activeTab: "home" | "status" | "scout" | "service" | "account";
  onTabChange: (tab: "home" | "status" | "scout" | "service" | "account") => void;
}

export function BottomNavigation({ activeTab, onTabChange }: BottomNavigationProps) {
  const tabs = [
    { id: "home" as const, icon: Home, label: "Home", shortLabel: "Home" },
    { id: "status" as const, icon: ShieldCheck, label: "Vehicle Status", shortLabel: "Status" },
    { id: "scout" as const, icon: Shield, label: "Scout", shortLabel: "Scout" },
    { id: "service" as const, icon: Wrench, label: "Service", shortLabel: "Service" },
    { id: "account" as const, icon: User, label: "Account", shortLabel: "Account" },
  ];

  return (
    <div className="fixed bottom-0 left-0 right-0 bg-slate-900/95 backdrop-blur-lg border-t border-slate-700/50 z-50">
      <div className="flex items-center justify-around max-w-md mx-auto px-1 sm:px-2 py-2 sm:py-3 safe-area-inset-bottom">
        {tabs.map((tab) => {
          const Icon = tab.icon;
          const isActive = activeTab === tab.id;
          
          return (
            <button
              key={tab.id}
              onClick={() => onTabChange(tab.id)}
              className={`flex flex-col items-center gap-0.5 sm:gap-1 px-1 sm:px-2 py-1.5 sm:py-2 rounded-lg transition-all flex-1 min-w-0 ${
                isActive
                  ? "text-[#0070E1]"
                  : "text-slate-400 hover:text-slate-300"
              }`}
            >
              <Icon className={`w-5 h-5 sm:w-6 sm:h-6 flex-shrink-0 ${isActive ? "fill-[#0070E1]/20" : ""}`} />
              <span className="text-[10px] sm:text-xs truncate w-full text-center leading-tight">
                {tab.shortLabel}
              </span>
            </button>
          );
        })}
      </div>
    </div>
  );
}

import { Lock, Power, AlertCircle, Battery, Gauge, Unlock, Thermometer, Fuel, ChevronDown, Plus, ShieldAlert, BellRing, Clock, ThumbsUp, ThumbsDown } from "lucide-react";
import { Card, CardContent } from "./ui/card";
import { Badge } from "./ui/badge";
import { Button } from "./ui/button";
import { useState, useEffect } from "react";
import { ImageWithFallback } from "./figma/ImageWithFallback";
import { notificationService } from "./NotificationService";
import { hazardService, HazardData, getRelativeTime } from "./HazardService";
import { MapboxMap } from "./MapboxMap";
import { Vehicle } from "../types/vehicle";
import { toast } from "sonner";

interface DashboardScreenProps {
  onNavigateToScout: () => void;
  vehicles: Vehicle[];
  selectedVehicleId: string;
  onSelectVehicle: (id: string) => void;
}

// Live Map Widget Component (simplified for dashboard)
function LiveMapWidget({ hazards }: { hazards: HazardData[] }) {
  return (
    <MapboxMap 
      hazards={hazards.slice(0, 5)} 
      viewMode="widget"
      className="w-full h-full"
    />
  );
}

export function DashboardScreen({ onNavigateToScout, vehicles, selectedVehicleId, onSelectVehicle }: DashboardScreenProps) {
  const [showVehicleSelector, setShowVehicleSelector] = useState(false);
  const [cabinTemp, setCabinTemp] = useState(22);
  const [notificationsEnabled, setNotificationsEnabled] = useState(false);
  const [nearestHazard, setNearestHazard] = useState<HazardData | null>(null);
  const [isRemoteStartActive, setIsRemoteStartActive] = useState(false);

  const selectedVehicle = vehicles.find(v => v.id === selectedVehicleId) || vehicles[0];
  const [isLocked, setIsLocked] = useState(selectedVehicle.isLocked);

  // Check notification status and load nearest hazard
  useEffect(() => {
    const settings = notificationService.getSettings();
    const hasPermission = typeof Notification !== 'undefined' && Notification.permission === 'granted';
    setNotificationsEnabled(settings.enabled && hasPermission);

    // Get nearest high-severity hazard
    const activeHazards = hazardService.getActiveHazards();
    const highSeverityHazards = activeHazards.filter(h => h.severity === 'high' || h.severity === 'medium');
    if (highSeverityHazards.length > 0) {
      setNearestHazard(highSeverityHazards[0]);
    }

    // Refresh hazards every 10 seconds
    const interval = setInterval(() => {
      const activeHazards = hazardService.getActiveHazards();
      const highSeverityHazards = activeHazards.filter(h => h.severity === 'high' || h.severity === 'medium');
      if (highSeverityHazards.length > 0) {
        setNearestHazard(highSeverityHazards[0]);
      } else {
        setNearestHazard(null);
      }
    }, 10000);

    return () => clearInterval(interval);
  }, []);

  const handleAddVehicle = () => {
    toast.info("Add New Vehicle", {
      description: "This feature will allow you to connect additional VW vehicles to your account.",
      duration: 3000,
    });
  };

  const handleClimateControl = () => {
    const newTemp = cabinTemp === 22 ? 24 : cabinTemp === 24 ? 18 : 22;
    setCabinTemp(newTemp);
    toast.success(`Climate set to ${newTemp}C`, {
      description: "Pre-conditioning your vehicle cabin temperature.",
      duration: 3000,
    });
  };

  const handleRemoteStart = () => {
    setIsRemoteStartActive(!isRemoteStartActive);
    if (!isRemoteStartActive) {
      toast.success("Engine started remotely", {
        description: "Your vehicle is warming up. Climate control activated.",
        duration: 3000,
      });
    } else {
      toast.info("Engine stopped", {
        description: "Remote start deactivated.",
        duration: 3000,
      });
    }
  };

  const handleFindMyCar = () => {
    toast.success("Locating your vehicle", {
      description: "Your VW will flash its lights and honk the horn.",
      duration: 3000,
    });
  };

  return (
    <div className="min-h-screen bg-[#FDFAF9] dark:bg-slate-950 pb-20 sm:pb-24">
      {/* Header */}
      <div className="bg-gradient-to-b from-white to-[#FDFAF9] dark:from-slate-900 dark:to-slate-950 px-3 sm:px-4 pt-6 sm:pt-8 pb-4 sm:pb-6">
        {/* Hazard Scout Logo & Title */}
        <div className="flex items-center gap-2 sm:gap-3 mb-3 sm:mb-4">
          <div className="w-8 h-8 sm:w-10 sm:h-10 rounded-lg bg-gradient-to-br from-[#0070E1] to-[#0050A1] flex items-center justify-center shadow-lg shadow-[#0070E1]/20">
            <ShieldAlert className="w-5 h-5 sm:w-6 sm:h-6 text-white" strokeWidth={2.5} />
          </div>
          <div className="flex-1 min-w-0">
            <h1 className="text-[#1F2F57] dark:text-slate-100 text-base sm:text-lg truncate">Hazard Scout</h1>
            <p className="text-[#484B6A] dark:text-slate-400 text-[10px] sm:text-xs truncate">VW Connect Dashboard</p>
          </div>
          <div className="flex flex-col gap-1.5 flex-shrink-0">
            <Badge className="bg-green-500/20 text-green-400 border-green-500/30 text-[10px] sm:text-xs">
              Connected
            </Badge>
            {notificationsEnabled && (
              <Badge className="bg-orange-500/20 text-orange-400 border-orange-500/30 text-[10px] sm:text-xs flex items-center gap-1">
                <BellRing className="w-3 h-3" />
                Alerts On
              </Badge>
            )}
          </div>
        </div>
        <p className="text-[#484B6A] dark:text-slate-400 text-xs sm:text-sm mb-1">Welcome back</p>
        
        {/* Vehicle Selector */}
        <div className="mt-4 relative">
          <button
            onClick={() => setShowVehicleSelector(!showVehicleSelector)}
            className="w-full bg-white dark:bg-slate-800/50 border border-gray-200 dark:border-slate-700/50 rounded-lg p-3 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-slate-800 transition-all"
          >
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-lg bg-slate-100 dark:bg-slate-700/50 flex items-center justify-center">
                {selectedVehicle.type === 'electric' ? (
                  <Battery className="w-5 h-5 text-[#0070E1]" />
                ) : (
                  <Fuel className="w-5 h-5 text-[#0070E1]" />
                )}
              </div>
              <div className="text-left">
                <p className="text-[#1F2F57] dark:text-slate-200 text-sm">{selectedVehicle.name}</p>
                <p className="text-[#484B6A] dark:text-slate-400 text-xs">
                  VW {selectedVehicle.model}  {selectedVehicle.type.charAt(0).toUpperCase() + selectedVehicle.type.slice(1)}
                </p>
              </div>
            </div>
            <ChevronDown className={`w-5 h-5 text-slate-400 transition-transform ${showVehicleSelector ? 'rotate-180' : ''}`} />
          </button>

          {/* Dropdown Menu */}
          {showVehicleSelector && (
            <div className="absolute top-full left-0 right-0 mt-2 bg-white dark:bg-slate-800/95 backdrop-blur-xl border border-gray-200 dark:border-slate-700/50 rounded-lg overflow-hidden z-10 shadow-lg">
              {vehicles.map((vehicle) => (
                <button
                  key={vehicle.id}
                  onClick={() => {
                    onSelectVehicle(vehicle.id);
                    setIsLocked(vehicle.isLocked);
                    setShowVehicleSelector(false);
                  }}
                  className={`w-full p-3 flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-slate-700/50 transition-all ${
                    vehicle.id === selectedVehicleId ? 'bg-gray-100 dark:bg-slate-700/50' : ''
                  }`}
                >
                  <div className="w-10 h-10 rounded-lg bg-slate-100 dark:bg-slate-700/50 flex items-center justify-center">
                    {vehicle.type === 'electric' ? (
                      <Battery className="w-5 h-5 text-[#0070E1]" />
                    ) : (
                      <Fuel className="w-5 h-5 text-[#0070E1]" />
                    )}
                  </div>
                  <div className="text-left flex-1">
                    <p className="text-[#1F2F57] dark:text-slate-200 text-sm">{vehicle.name}</p>
                    <p className="text-[#484B6A] dark:text-slate-400 text-xs">
                      VW {vehicle.model}  {vehicle.type.charAt(0).toUpperCase() + vehicle.type.slice(1)}
                    </p>
                  </div>
                  {vehicle.id === selectedVehicleId && (
                    <div className="w-2 h-2 rounded-full bg-[#0070E1]"></div>
                  )}
                </button>
              ))}
              
              <button 
                onClick={handleAddVehicle}
                className="w-full p-3 flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-slate-700/50 transition-all border-t border-gray-200 dark:border-slate-700/50"
              >
                <div className="w-10 h-10 rounded-lg bg-[#0070E1]/20 flex items-center justify-center">
                  <Plus className="w-5 h-5 text-[#0070E1]" />
                </div>
                <div className="text-left">
                  <p className="text-[#0070E1] text-sm">Add New Vehicle</p>
                </div>
              </button>
            </div>
          )}
        </div>
      </div>

      {/* Vehicle Hero Section */}
      <div className="px-4 -mt-2">
        <Card className="bg-gradient-to-br from-white to-white dark:from-slate-900/90 dark:to-slate-800/90 backdrop-blur-xl border-gray-200 dark:border-slate-700/50 overflow-hidden">
          <CardContent className="p-6">
            {/* Vehicle Image */}
            <div className="relative mb-4">
              <div className="bg-gradient-to-br from-[#E4E5F1] to-[#E4E5F1] dark:from-slate-800 dark:to-slate-900 rounded-lg p-8 flex items-center justify-center">
                <ImageWithFallback
                  src={selectedVehicle.imageUrl}
                  alt={`Volkswagen ${selectedVehicle.model}`}
                  className="w-full h-40 object-contain"
                />
              </div>
              <div className="absolute top-3 right-3">
                <Badge className="bg-[#0070E1]/20 text-[#0070E1] border-[#0070E1]/30">
                  Active
                </Badge>
              </div>
            </div>

            {/* Vehicle Info */}
            <div className="text-center mb-4">
              <h2 className="text-[#1F2F57] dark:text-slate-100 text-xl mb-1">
                Volkswagen {selectedVehicle.model}
              </h2>
              <p className="text-[#484B6A] dark:text-slate-400 text-sm">{selectedVehicle.plateNumber}</p>
            </div>

            {/* Top Status Indicators */}
            <div className="grid grid-cols-2 gap-3 mb-4">
              <div className="bg-[#E4E5F1] dark:bg-slate-800/50 rounded-lg p-3 border border-transparent dark:border-slate-700/30">
                <div className="flex items-center gap-2 mb-1">
                  {selectedVehicle.type === 'electric' ? (
                    <>
                      <Battery className="w-4 h-4 text-green-400" />
                      <span className="text-[#484B6A] dark:text-slate-400 text-xs">Charge Level</span>
                    </>
                  ) : (
                    <>
                      <Fuel className="w-4 h-4 text-green-400" />
                      <span className="text-[#484B6A] dark:text-slate-400 text-xs">Fuel Level</span>
                    </>
                  )}
                </div>
                <p className="text-[#1F2F57] dark:text-slate-100 text-lg">{selectedVehicle.fuelLevel}%</p>
              </div>
              <div className="bg-[#E4E5F1] dark:bg-slate-800/50 rounded-lg p-3 border border-transparent dark:border-slate-700/30">
                <div className="flex items-center gap-2 mb-1">
                  <Gauge className="w-4 h-4 text-[#0070E1]" />
                  <span className="text-[#484B6A] dark:text-slate-400 text-xs">
                    {selectedVehicle.type === 'electric' ? 'Range' : 'Mileage'}
                  </span>
                </div>
                <p className="text-[#1F2F57] dark:text-slate-100 text-lg">
                  {selectedVehicle.type === 'electric' 
                    ? `${selectedVehicle.range} km` 
                    : `${selectedVehicle.mileage.toLocaleString()} km`}
                </p>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Hazard Alert Banner - Interactive */}
      {nearestHazard && (
        <div className="px-3 sm:px-4 mt-3 sm:mt-4">
          <button 
            onClick={onNavigateToScout}
            className="w-full text-left transition-all hover:scale-[1.01] active:scale-[0.99]"
          >
            <Card className={`backdrop-blur-xl hover:border-opacity-70 transition-colors cursor-pointer ${
              nearestHazard.severity === 'high' 
                ? 'bg-red-50 dark:bg-red-500/10 border-red-200 dark:border-red-500/30 hover:border-red-500/50'
                : 'bg-amber-50 dark:bg-amber-500/10 border-amber-200 dark:border-amber-500/30 hover:border-amber-500/50'
            }`}>
              <CardContent className="p-3 sm:p-4">
                <div className="flex items-start gap-2 sm:gap-3">
                  <div className={`w-8 h-8 sm:w-10 sm:h-10 rounded-full flex items-center justify-center flex-shrink-0 ${
                    nearestHazard.severity === 'high'
                      ? 'bg-red-100 dark:bg-red-500/20'
                      : 'bg-amber-100 dark:bg-amber-500/20'
                  }`}>
                    <AlertCircle className={`w-5 h-5 sm:w-6 sm:h-6 ${
                      nearestHazard.severity === 'high'
                        ? 'text-red-600 dark:text-red-400'
                        : 'text-amber-600 dark:text-amber-400'
                    }`} />
                  </div>
                  <div className="flex-1 min-w-0">
                    <div className="flex items-center gap-2 mb-0.5 sm:mb-1 flex-wrap">
                      <p className={`text-xs sm:text-sm ${
                        nearestHazard.severity === 'high'
                          ? 'text-red-600 dark:text-red-400'
                          : 'text-amber-600 dark:text-amber-400'
                      }`}>
                        {nearestHazard.severity === 'high' ? '' : ''} {nearestHazard.type} Ahead!{nearestHazard.severity === 'high' ? ' SLOW DOWN' : ''}
                      </p>
                      {nearestHazard.status === 'resolving' && (
                        <Badge className="bg-amber-500/20 text-amber-400 border-amber-500/30 text-[10px]">
                          <Clock className="w-2.5 h-2.5 mr-0.5" />
                          Resolving
                        </Badge>
                      )}
                    </div>
                    <p className="text-[#484B6A] dark:text-slate-300 text-[10px] sm:text-xs mb-1">
                      {nearestHazard.distance || 'Nearby'}  {nearestHazard.locationName}
                    </p>
                    <div className="flex items-center gap-3 text-[10px]">
                      <div className="flex items-center gap-1">
                        <ThumbsUp className="w-2.5 h-2.5 text-green-400" />
                        <span className="text-slate-400">{nearestHazard.confirmationCount}</span>
                      </div>
                      <span className="text-slate-600"></span>
                      <span className="text-slate-500">{getRelativeTime(nearestHazard.firstDetectedAt)}</span>
                      <span className="text-slate-600"></span>
                      <span className="text-[#001E50] dark:text-[#0070E1]">View on Map </span>
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>
          </button>
        </div>
      )}

      {/* Primary Remote Actions */}
      <div className="px-3 sm:px-4 mt-4 sm:mt-6">
        <h3 className="text-[#484B6A] dark:text-slate-300 text-xs sm:text-sm mb-2 sm:mb-3">Quick Controls</h3>
        <div className="grid grid-cols-2 gap-4">
          {/* Lock/Unlock */}
          <button
            onClick={() => setIsLocked(!isLocked)}
            className="bg-white dark:bg-slate-900/90 backdrop-blur-xl border border-gray-200 dark:border-slate-700/50 rounded-xl p-6 hover:bg-gray-50 dark:hover:bg-slate-800/90 transition-all active:scale-95"
          >
            <div className="flex flex-col items-center gap-3">
              <div className={`w-14 h-14 rounded-full flex items-center justify-center ${
                isLocked ? "bg-green-100 dark:bg-green-500/20" : "bg-amber-100 dark:bg-amber-500/20"
              }`}>
                {isLocked ? (
                  <Lock className="w-7 h-7 text-green-600 dark:text-green-400" />
                ) : (
                  <Unlock className="w-7 h-7 text-amber-600 dark:text-amber-400" />
                )}
              </div>
              <div className="text-center">
                <p className="text-[#1F2F57] dark:text-slate-200 text-sm mb-0.5">Doors</p>
                <p className={`text-xs ${isLocked ? "text-green-600 dark:text-green-400" : "text-amber-600 dark:text-amber-400"}`}>
                  {isLocked ? "Locked" : "Unlocked"}
                </p>
              </div>
            </div>
          </button>

          {/* Remote Start/Climate */}
          <button 
            onClick={handleClimateControl}
            className="bg-white dark:bg-slate-900/90 backdrop-blur-xl border border-gray-200 dark:border-slate-700/50 rounded-xl p-6 hover:bg-gray-50 dark:hover:bg-slate-800/90 transition-all active:scale-95"
          >
            <div className="flex flex-col items-center gap-3">
              <div className="w-14 h-14 rounded-full bg-blue-100 dark:bg-[#0070E1]/20 flex items-center justify-center">
                <Thermometer className="w-7 h-7 text-[#001E50] dark:text-[#0070E1]" />
              </div>
              <div className="text-center">
                <p className="text-[#1F2F57] dark:text-slate-200 text-sm mb-0.5">Climate</p>
                <p className="text-[#001E50] dark:text-[#0070E1] text-xs">{cabinTemp}C</p>
              </div>
            </div>
          </button>
        </div>
      </div>

      {/* Contribution Status Indicator */}
      <div className="px-3 sm:px-4 mt-4 sm:mt-6">
        <Card className="bg-green-50 dark:bg-slate-800/80 border-green-200 dark:border-slate-700">
          <CardContent className="p-3 sm:p-4">
            <div className="flex items-center gap-2 sm:gap-3">
              <div className="w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-green-100 dark:bg-green-500/20 flex items-center justify-center flex-shrink-0">
                <ShieldAlert className="w-4 h-4 sm:w-5 sm:h-5 text-green-600 dark:text-green-400" />
              </div>
              <div className="flex-1 min-w-0">
                <p className="text-[#1F2F57] dark:text-slate-200 text-xs sm:text-sm mb-0.5">Scout Monitoring</p>
                <p className="text-green-600 dark:text-green-400 text-[10px] sm:text-xs truncate">Active  Privacy Protected</p>
              </div>
              <div className="flex items-center gap-1 flex-shrink-0">
                <div className="w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full bg-green-600 dark:bg-green-400 animate-pulse"></div>
                <span className="text-green-600 dark:text-green-400 text-[10px] sm:text-xs">ON</span>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Quick Alerts Widget */}
      <div className="px-3 sm:px-4 mt-4 sm:mt-6">
        <h3 className="text-[#484B6A] dark:text-slate-300 text-xs sm:text-sm mb-2 sm:mb-3">Recent Alerts</h3>
        <Card className="bg-amber-50 dark:bg-amber-500/10 border-amber-200 dark:border-amber-500/30 backdrop-blur-xl">
          <CardContent className="p-4">
            <div className="flex items-start gap-3">
              <div className="w-10 h-10 rounded-full bg-amber-100 dark:bg-amber-500/20 flex items-center justify-center flex-shrink-0">
                <AlertCircle className="w-5 h-5 text-amber-600 dark:text-amber-400" />
              </div>
              <div className="flex-1">
                <p className="text-[#1F2F57] dark:text-slate-200 text-sm mb-1">Service Due Soon</p>
                <p className="text-[#484B6A] dark:text-slate-400 text-xs">Recommended service in 5,000 km</p>
                <p className="text-amber-600 dark:text-amber-400 text-xs mt-2">2 days ago</p>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Live Map Widget */}
      <div className="px-3 sm:px-4 mt-4 sm:mt-6">
        <h3 className="text-[#484B6A] dark:text-slate-300 text-xs sm:text-sm mb-2 sm:mb-3">Live Hazard Map</h3>
        <button 
          onClick={onNavigateToScout}
          className="w-full transition-all hover:scale-[1.01] active:scale-[0.99]"
        >
          <Card className="bg-white dark:bg-slate-900/90 border-gray-200 dark:border-slate-700/50 backdrop-blur-xl overflow-hidden cursor-pointer hover:border-[#001E50] dark:hover:border-[#0070E1]/50 transition-all">
            <div className="h-32 sm:h-40 relative">
              <LiveMapWidget hazards={hazardService.getActiveHazards()} />
            </div>
            <CardContent className="p-3 sm:p-4">
              <div className="flex items-center justify-between gap-2">
                <div className="min-w-0">
                  <p className="text-[#1F2F57] dark:text-slate-200 text-xs sm:text-sm mb-0.5 sm:mb-1 truncate">
                    {hazardService.getActiveHazards().length} Hazards Nearby
                  </p>
                  <p className="text-[#484B6A] dark:text-slate-400 text-[10px] sm:text-xs truncate">Tap to view Safety Scout map</p>
                </div>
                <Badge className="bg-red-50 dark:bg-red-500/20 text-red-600 dark:text-red-400 border-red-200 dark:border-red-500/30 text-[10px] sm:text-xs flex-shrink-0">
                  Alert
                </Badge>
              </div>
            </CardContent>
          </Card>
        </button>
      </div>

      {/* Additional Quick Actions */}
      <div className="px-3 sm:px-4 mt-4 sm:mt-6">
        <div className="grid grid-cols-2 gap-3">
          <Button
            onClick={handleRemoteStart}
            variant="outline"
            className={`bg-white dark:bg-slate-900/50 border-gray-200 dark:border-slate-700/50 hover:bg-gray-50 dark:hover:bg-slate-800/50 hover:text-[#001E50] dark:hover:text-slate-200 ${
              isRemoteStartActive 
                ? 'text-green-600 dark:text-green-400 border-green-500/30' 
                : 'text-[#1F2F57] dark:text-slate-300'
            }`}
          >
            <Power className="w-4 h-4 mr-2" />
            {isRemoteStartActive ? 'Stop Engine' : 'Remote Start'}
          </Button>
          <Button
            onClick={handleFindMyCar}
            variant="outline"
            className="bg-white dark:bg-slate-900/50 border-gray-200 dark:border-slate-700/50 text-[#1F2F57] dark:text-slate-300 hover:bg-gray-50 dark:hover:bg-slate-800/50 hover:text-[#001E50] dark:hover:text-slate-200"
          >
            Find My Car
          </Button>
        </div>
      </div>
    </div>
  );
}

import { useEffect, useRef, useState } from "react";
import { MapApiKeyRequired } from "./MapApiKeyRequired";

interface Hazard {
  id: string;
  lat: number;
  lng: number;
  severity: "high" | "medium";
  type: string;
}

interface GoogleMapComponentProps {
  onHazardClick: () => void;
}

// Dark mode map styling
const darkMapStyles = [
  { elementType: "geometry", stylers: [{ color: "#1a1a2e" }] },
  { elementType: "labels.text.stroke", stylers: [{ color: "#1a1a2e" }] },
  { elementType: "labels.text.fill", stylers: [{ color: "#8b93a7" }] },
  {
    featureType: "administrative.locality",
    elementType: "labels.text.fill",
    stylers: [{ color: "#a1a9b8" }],
  },
  {
    featureType: "poi",
    elementType: "labels.text.fill",
    stylers: [{ color: "#6f7785" }],
  },
  {
    featureType: "poi.park",
    elementType: "geometry",
    stylers: [{ color: "#1e3a2e" }],
  },
  {
    featureType: "poi.park",
    elementType: "labels.text.fill",
    stylers: [{ color: "#5a7d6b" }],
  },
  {
    featureType: "road",
    elementType: "geometry",
    stylers: [{ color: "#2a2d3e" }],
  },
  {
    featureType: "road",
    elementType: "geometry.stroke",
    stylers: [{ color: "#1f2233" }],
  },
  {
    featureType: "road.highway",
    elementType: "geometry",
    stylers: [{ color: "#2e3447" }],
  },
  {
    featureType: "road.highway",
    elementType: "geometry.stroke",
    stylers: [{ color: "#1f2233" }],
  },
  {
    featureType: "road.highway",
    elementType: "labels.text.fill",
    stylers: [{ color: "#b8bdc7" }],
  },
  {
    featureType: "transit",
    elementType: "geometry",
    stylers: [{ color: "#1f2233" }],
  },
  {
    featureType: "transit.station",
    elementType: "labels.text.fill",
    stylers: [{ color: "#6f7785" }],
  },
  {
    featureType: "water",
    elementType: "geometry",
    stylers: [{ color: "#0f1621" }],
  },
  {
    featureType: "water",
    elementType: "labels.text.fill",
    stylers: [{ color: "#4a5568" }],
  },
  {
    featureType: "water",
    elementType: "labels.text.stroke",
    stylers: [{ color: "#0f1621" }],
  },
];

export function GoogleMapComponent({ onHazardClick }: GoogleMapComponentProps) {
  const mapRef = useRef<HTMLDivElement>(null);
  const [map, setMap] = useState<google.maps.Map | null>(null);
  const [isLoaded, setIsLoaded] = useState(false);
  const [hasError, setHasError] = useState(false);
  const [needsApiKey, setNeedsApiKey] = useState(false);

  // Sample hazards - in a real app, these would come from your backend
  const hazards: Hazard[] = [
    { id: "1", lat: 37.7749, lng: -122.4194, severity: "high", type: "Pothole" },
    { id: "2", lat: 37.7779, lng: -122.4194, severity: "medium", type: "Debris" },
    { id: "3", lat: 37.7809, lng: -122.4194, severity: "high", type: "Pothole" },
  ];

  const centerPosition = { lat: 37.7759, lng: -122.4194 }; // San Francisco

  useEffect(() => {
    // Load Google Maps script
    const loadGoogleMaps = () => {
      if (window.google && window.google.maps) {
        setIsLoaded(true);
        return;
      }

      const API_KEY = "YOUR_API_KEY_HERE";
      
      // Check if API key needs to be configured
      if (API_KEY === "YOUR_API_KEY_HERE") {
        setNeedsApiKey(true);
        return;
      }

      const script = document.createElement("script");
      //  IMPORTANT: Replace YOUR_API_KEY_HERE with your actual Google Maps API key
      // Get your API key from: https://developers.google.com/maps/documentation/javascript/get-api-key
      // Enable the following APIs: Maps JavaScript API, Geometry API
      script.src = `https://maps.googleapis.com/maps/api/js?key=${API_KEY}&libraries=marker,geometry&loading=async`;
      script.async = true;
      script.defer = true;
      script.onload = () => {
        // Add a small delay to ensure libraries are loaded
        setTimeout(() => setIsLoaded(true), 100);
      };
      script.onerror = () => {
        console.error("Failed to load Google Maps. Please check your API key.");
        setHasError(true);
      };
      document.head.appendChild(script);
    };

    loadGoogleMaps();

    // Listen for Google Maps errors
    const errorHandler = (e: ErrorEvent) => {
      if (e.message && e.message.includes("Google Maps")) {
        setHasError(true);
      }
    };
    window.addEventListener("error", errorHandler);

    return () => {
      window.removeEventListener("error", errorHandler);
    };
  }, []);

  useEffect(() => {
    if (!isLoaded || !mapRef.current || map) return;

    // Initialize map
    const newMap = new google.maps.Map(mapRef.current, {
      center: centerPosition,
      zoom: 14,
      styles: darkMapStyles,
      disableDefaultUI: true,
      zoomControl: false,
      mapTypeControl: false,
      streetViewControl: false,
      fullscreenControl: false,
    });

    setMap(newMap);

    // Create custom overlay for vehicle (no deprecated Marker API)
    const vehicleOverlay = document.createElement("div");
    vehicleOverlay.className = "vehicle-marker";
    vehicleOverlay.innerHTML = `
      <div style="position: relative; width: 48px; height: 48px;">
        <div style="
          position: absolute;
          width: 48px;
          height: 48px;
          background: #0070E1;
          border-radius: 50%;
          animation: ping 2s cubic-bezier(0, 0, 0.2, 1) infinite;
          opacity: 0.3;
        "></div>
        <div style="
          position: relative;
          width: 32px;
          height: 32px;
          background: #0070E1;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          box-shadow: 0 10px 15px -3px rgba(0, 112, 225, 0.5);
          margin: 8px;
        ">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="white" stroke="white" stroke-width="2">
            <polygon points="3 11 22 2 13 21 11 13 3 11"></polygon>
          </svg>
        </div>
      </div>
    `;

    const vehicleOverlayInstance = new google.maps.OverlayView();
    vehicleOverlayInstance.onAdd = function () {
      const panes = this.getPanes();
      panes?.overlayMouseTarget.appendChild(vehicleOverlay);
    };
    vehicleOverlayInstance.draw = function () {
      const projection = this.getProjection();
      const position = projection.fromLatLngToDivPixel(centerPosition);
      if (position) {
        vehicleOverlay.style.left = position.x - 24 + "px";
        vehicleOverlay.style.top = position.y - 24 + "px";
        vehicleOverlay.style.position = "absolute";
      }
    };
    vehicleOverlayInstance.setMap(newMap);

    // Add hazard markers
    hazards.forEach((hazard) => {
      const markerDiv = document.createElement("div");
      markerDiv.style.cursor = "pointer";
      
      const color = hazard.severity === "high" ? "#EF4444" : "#F59E0B";
      const pulseAnimation = hazard.severity === "high" ? "pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite" : "none";
      
      markerDiv.innerHTML = `
        <div style="position: relative; width: 40px; height: 40px;">
          ${hazard.severity === "high" ? `
            <div style="
              position: absolute;
              width: 40px;
              height: 40px;
              background: ${color};
              border-radius: 50%;
              animation: ${pulseAnimation};
              opacity: 0.4;
            "></div>
          ` : ''}
          <div style="
            position: relative;
            width: 24px;
            height: 24px;
            background: ${color};
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
            border: 2px solid white;
            margin: 8px;
          ">
            ${hazard.severity === "high" ? `
              <svg width="14" height="14" viewBox="0 0 24 24" fill="white" stroke="white" stroke-width="2">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                <line x1="12" y1="9" x2="12" y2="13"></line>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
              </svg>
            ` : `
              <div style="width: 6px; height: 6px; background: white; border-radius: 50%;"></div>
            `}
          </div>
        </div>
      `;

      markerDiv.addEventListener("click", () => {
        if (hazard.id === "1") {
          onHazardClick();
        }
      });

      const overlay = new google.maps.OverlayView();
      overlay.onAdd = function () {
        const panes = this.getPanes();
        panes?.overlayMouseTarget.appendChild(markerDiv);
      };
      overlay.draw = function () {
        const projection = this.getProjection();
        const position = projection.fromLatLngToDivPixel({ lat: hazard.lat, lng: hazard.lng });
        if (position) {
          markerDiv.style.left = position.x - 20 + "px";
          markerDiv.style.top = position.y - 20 + "px";
          markerDiv.style.position = "absolute";
        }
      };
      overlay.setMap(newMap);
    });

    // Draw route polyline
    const routePath = [
      centerPosition,
      { lat: 37.7779, lng: -122.4194 },
      { lat: 37.7809, lng: -122.4194 },
    ];

    new google.maps.Polyline({
      path: routePath,
      geodesic: true,
      strokeColor: "#0070E1",
      strokeOpacity: 0.6,
      strokeWeight: 4,
      map: newMap,
    });
  }, [isLoaded, map, onHazardClick]);

  // Show API key setup guide if needed
  if (needsApiKey) {
    return <MapApiKeyRequired />;
  }

  // Show error message if map failed to load
  if (hasError) {
    return (
      <div className="absolute inset-0 bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center">
        <div className="text-center space-y-2 p-4">
          <div className="text-red-400">Failed to load Google Maps</div>
          <div className="text-slate-400 text-sm">Please check your API key and try again</div>
        </div>
      </div>
    );
  }

  return (
    <div className="relative w-full h-full">
      <div ref={mapRef} className="w-full h-full" />
      {!isLoaded && (
        <div className="absolute inset-0 bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center">
          <div className="text-slate-400">Loading map...</div>
        </div>
      )}
      <style>{`
        @keyframes ping {
          75%, 100% {
            transform: scale(2);
            opacity: 0;
          }
        }
        @keyframes pulse {
          0%, 100% {
            opacity: 1;
          }
          50% {
            opacity: 0.5;
          }
        }
      `}</style>
    </div>
  );
}

import { useState } from "react";
import { Button } from "./ui/button";
import { Textarea } from "./ui/textarea";
import { Label } from "./ui/label";
import { AlertTriangle, CheckCircle, XCircle, Camera, ArrowLeft } from "lucide-react";
import { Card, CardContent, CardHeader } from "./ui/card";

interface HazardConfirmationScreenProps {
  onBack: () => void;
}

export function HazardConfirmationScreen({ onBack }: HazardConfirmationScreenProps) {
  const [notes, setNotes] = useState("");
  const [submitted, setSubmitted] = useState(false);

  const handleFeedback = (type: "confirm" | "resolved" | "false") => {
    // In a real app, this would send data to the backend
    setSubmitted(true);
    setTimeout(() => {
      onBack();
    }, 2000);
  };

  if (submitted) {
    return (
      <div className="h-screen w-full bg-slate-950 flex items-center justify-center p-4">
        <div className="text-center space-y-4">
          <div className="w-20 h-20 mx-auto rounded-full bg-green-500/20 flex items-center justify-center">
            <CheckCircle className="w-12 h-12 text-green-500" />
          </div>
          <h2 className="text-slate-100">Feedback Submitted</h2>
          <p className="text-slate-400">Thank you for contributing to our AI model training</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen w-full bg-slate-950 flex flex-col">
      {/* Header */}
      <div className="bg-slate-900/95 backdrop-blur-sm border-b border-slate-700/50 px-4 py-4 flex items-center gap-3">
        <button
          onClick={onBack}
          className="w-10 h-10 rounded-full bg-slate-800/50 hover:bg-slate-700/50 flex items-center justify-center transition-colors"
        >
          <ArrowLeft className="w-5 h-5 text-slate-300" />
        </button>
        <div>
          <h1 className="text-slate-100">Hazard Confirmation</h1>
          <p className="text-slate-400 text-sm">Help improve our AI detection</p>
        </div>
      </div>

      <div className="flex-1 overflow-y-auto p-4 space-y-6">
        {/* Hazard Summary Card */}
        <Card className="bg-slate-900/80 backdrop-blur-xl border-slate-700/50">
          <CardHeader className="pb-3">
            <h3 className="text-slate-100 flex items-center gap-2">
              <AlertTriangle className="w-5 h-5 text-red-500" />
              Detected Hazard Summary
            </h3>
          </CardHeader>
          <CardContent className="space-y-3">
            <div className="grid grid-cols-2 gap-4">
              <div className="space-y-1">
                <p className="text-slate-500 text-sm">Hazard Type</p>
                <p className="text-slate-200">Pothole</p>
              </div>
              <div className="space-y-1">
                <p className="text-slate-500 text-sm">Severity Level</p>
                <div className="flex items-center gap-2">
                  <div className="w-3 h-3 rounded-full bg-red-500" />
                  <p className="text-red-400">High</p>
                </div>
              </div>
              <div className="space-y-1">
                <p className="text-slate-500 text-sm">Distance</p>
                <p className="text-slate-200">150 meters</p>
              </div>
              <div className="space-y-1">
                <p className="text-slate-500 text-sm">Detection Time</p>
                <p className="text-slate-200">1.8s ago</p>
              </div>
            </div>
            
            <div className="pt-3 border-t border-slate-700/50">
              <p className="text-slate-500 text-sm mb-2">Location</p>
              <p className="text-slate-300 text-sm">Main Street, 0.3 km ahead on current route</p>
            </div>

            <div className="bg-slate-800/50 rounded-lg p-3 border border-slate-700/30">
              <p className="text-slate-400 text-xs mb-1">AI Model: YOLO-Nano v2.1</p>
              <p className="text-slate-400 text-xs">Confidence Score: 94.2%</p>
            </div>
          </CardContent>
        </Card>

        {/* Feedback Options */}
        <div className="space-y-3">
          <h3 className="text-slate-200">Provide Feedback</h3>
          
          {/* Confirm Hazard */}
          <Button
            onClick={() => handleFeedback("confirm")}
            className="w-full bg-green-600 hover:bg-green-700 text-white h-auto py-4 flex items-center justify-start gap-4 shadow-lg shadow-green-600/20"
          >
            <div className="w-12 h-12 rounded-full bg-white/20 flex items-center justify-center flex-shrink-0">
              <CheckCircle className="w-6 h-6" />
            </div>
            <div className="text-left">
              <div>Confirm Hazard is Present</div>
              <div className="text-green-100 text-sm opacity-90">Hazard confirmed at this location</div>
            </div>
          </Button>

          {/* Hazard Resolved */}
          <Button
            onClick={() => handleFeedback("resolved")}
            className="w-full bg-amber-600 hover:bg-amber-700 text-white h-auto py-4 flex items-center justify-start gap-4 shadow-lg shadow-amber-600/20"
          >
            <div className="w-12 h-12 rounded-full bg-white/20 flex items-center justify-center flex-shrink-0">
              <CheckCircle className="w-6 h-6" />
            </div>
            <div className="text-left">
              <div>Hazard Resolved / Safe</div>
              <div className="text-amber-100 text-sm opacity-90">Hazard no longer present or repaired</div>
            </div>
          </Button>

          {/* False Alert */}
          <Button
            onClick={() => handleFeedback("false")}
            variant="outline"
            className="w-full bg-slate-800/50 hover:bg-slate-700/50 text-slate-300 border-slate-700 h-auto py-4 flex items-center justify-start gap-4"
          >
            <div className="w-12 h-12 rounded-full bg-slate-700/50 flex items-center justify-center flex-shrink-0">
              <XCircle className="w-6 h-6" />
            </div>
            <div className="text-left">
              <div>False Alert (Dismiss)</div>
              <div className="text-slate-400 text-sm">No hazard detected at this location</div>
            </div>
          </Button>
        </div>

        {/* Optional Notes */}
        <Card className="bg-slate-900/80 backdrop-blur-xl border-slate-700/50">
          <CardHeader className="pb-3">
            <Label htmlFor="notes" className="text-slate-200">
              Additional Notes or Photo Upload (Optional)
            </Label>
          </CardHeader>
          <CardContent className="space-y-3">
            <Textarea
              id="notes"
              placeholder="Provide additional context about the hazard (e.g., size, exact location, road conditions)..."
              value={notes}
              onChange={(e) => setNotes(e.target.value)}
              className="bg-slate-800/50 border-slate-700 text-slate-100 placeholder:text-slate-500 min-h-24 resize-none"
            />
            <Button
              variant="outline"
              className="w-full bg-slate-800/50 hover:bg-slate-700/50 text-slate-300 border-slate-700"
            >
              <Camera className="w-4 h-4 mr-2" />
              Upload Photo Evidence
            </Button>
            <p className="text-slate-500 text-xs">
              Your feedback helps retrain our YOLO-Nano detection model for improved accuracy
            </p>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}

import { ArrowLeft, ShieldAlert, Volume2, Bell, Eye, Shield, Radio, BellRing, Moon, Check, X, Clock, Users } from "lucide-react";
import { Card, CardContent } from "./ui/card";
import { Switch } from "./ui/switch";
import { Slider } from "./ui/slider";
import { useState, useEffect } from "react";
import { Button } from "./ui/button";
import { Badge } from "./ui/badge";
import { notificationService, NotificationSettings } from "./NotificationService";
import { hazardService, HazardServiceSettings } from "./HazardService";
import { testHazardNotification } from "./useHazardNotifications";
import { 
  Select, 
  SelectContent, 
  SelectItem, 
  SelectTrigger, 
  SelectValue 
} from "./ui/select";
import { toast } from "sonner";

interface HazardScoutSettingsScreenProps {
  onBack: () => void;
}

export function HazardScoutSettingsScreen({ onBack }: HazardScoutSettingsScreenProps) {
  const [dataContribution, setDataContribution] = useState(true);
  const [audioAlerts, setAudioAlerts] = useState(true);
  const [audioVolume, setAudioVolume] = useState([75]);
  const [v2xAlerts, setV2xAlerts] = useState(true);
  const [piiBlurConfirmation, setPiiBlurConfirmation] = useState(true);
  const [sensitivity, setSensitivity] = useState([2]); // 1=Low, 2=Medium, 3=High
  
  // Push Notification States
  const [notificationSettings, setNotificationSettings] = useState<NotificationSettings>(
    notificationService.getSettings()
  );
  const [notificationPermission, setNotificationPermission] = useState<NotificationPermission>(
    typeof Notification !== 'undefined' ? Notification.permission : 'denied'
  );
  const [requestingPermission, setRequestingPermission] = useState(false);

  // Hazard Resolution States
  const [hazardSettings, setHazardSettings] = useState<HazardServiceSettings>(
    hazardService.getSettings()
  );

  // Load notification and hazard settings on mount
  useEffect(() => {
    setNotificationSettings(notificationService.getSettings());
    setHazardSettings(hazardService.getSettings());
  }, []);

  const getSensitivityLabel = (value: number) => {
    if (value === 1) return "Low";
    if (value === 2) return "Medium";
    return "High";
  };

  const handleRequestNotificationPermission = async () => {
    setRequestingPermission(true);
    const permission = await notificationService.requestPermission();
    setNotificationPermission(permission);
    setRequestingPermission(false);

    if (permission === 'granted') {
      // Enable notifications by default when permission is granted
      handleNotificationSettingChange({ enabled: true });
    }
  };

  const handleNotificationSettingChange = (updates: Partial<NotificationSettings>) => {
    const newSettings = { ...notificationSettings, ...updates };
    setNotificationSettings(newSettings);
    notificationService.updateSettings(updates);
  };

  const handleHazardSettingChange = (updates: Partial<HazardServiceSettings>) => {
    const newSettings = { ...hazardSettings, ...updates };
    setHazardSettings(newSettings);
    hazardService.updateSettings(updates);
  };

  const getProximityLabel = (meters: number) => {
    if (meters < 1000) return `${meters}m`;
    return `${meters / 1000}km`;
  };

  const handleTestNotification = async () => {
    if (notificationPermission !== 'granted') {
      toast.error('Please enable notifications first');
      return;
    }
    
    await testHazardNotification();
    toast.success('Test notification sent!');
  };

  return (
    <div className="min-h-screen bg-slate-950 pb-24">
      {/* Header */}
      <div className="bg-gradient-to-b from-slate-900 to-slate-950 px-4 pt-6 pb-4 sticky top-0 z-10">
        <button 
          onClick={onBack}
          className="flex items-center gap-2 text-slate-400 hover:text-slate-200 mb-4 transition-colors"
        >
          <ArrowLeft className="w-5 h-5" />
          <span className="text-sm">Back</span>
        </button>
        <div className="flex items-center gap-3">
          <div className="w-10 h-10 rounded-lg bg-gradient-to-br from-[#0070E1] to-[#0050A1] flex items-center justify-center shadow-lg shadow-[#0070E1]/20">
            <ShieldAlert className="w-6 h-6 text-white" strokeWidth={2.5} />
          </div>
          <div>
            <h1 className="text-slate-100 text-xl mb-1">Hazard Scout Settings</h1>
            <p className="text-slate-400 text-sm">Configure detection & alerts</p>
          </div>
        </div>
      </div>

      {/* Data Contribution */}
      <div className="px-4 mt-6">
        <h3 className="text-slate-300 text-sm mb-3">Data Sharing</h3>
        <Card className="bg-gradient-to-br from-[#0070E1]/10 to-blue-500/10 border-[#0070E1]/30">
          <CardContent className="p-4">
            <div className="flex items-center justify-between mb-3">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-full bg-[#0070E1]/20 flex items-center justify-center">
                  <Shield className="w-5 h-5 text-[#0070E1]" />
                </div>
                <div>
                  <p className="text-slate-200 text-sm">Data Contribution</p>
                  <p className="text-slate-400 text-xs">
                    {dataContribution ? "Sharing hazard data" : "Contribution paused"}
                  </p>
                </div>
              </div>
              <Switch
                checked={dataContribution}
                onCheckedChange={setDataContribution}
              />
            </div>
            {dataContribution && (
              <div className="bg-slate-800/50 rounded-lg p-3 border border-slate-700/30">
                <p className="text-slate-300 text-xs leading-relaxed">
                  Your vehicle helps other drivers by sharing detected road hazards. 
                  All data is anonymized and privacy-protected.
                </p>
              </div>
            )}
          </CardContent>
        </Card>
      </div>

      {/* Hazard Alert Sensitivity */}
      <div className="px-4 mt-6">
        <h3 className="text-slate-300 text-sm mb-3">Detection Sensitivity</h3>
        <Card className="bg-slate-900/90 border-slate-700/50">
          <CardContent className="p-4">
            <div className="flex items-center justify-between mb-4">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-full bg-amber-500/20 flex items-center justify-center">
                  <Bell className="w-5 h-5 text-amber-400" />
                </div>
                <div>
                  <p className="text-slate-200 text-sm">Alert Sensitivity</p>
                  <p className="text-slate-400 text-xs">Impact threshold for hazards</p>
                </div>
              </div>
              <Badge className="bg-amber-500/20 text-amber-400 border-amber-500/30">
                {getSensitivityLabel(sensitivity[0])}
              </Badge>
            </div>
            <div className="space-y-3">
              <Slider
                value={sensitivity}
                onValueChange={setSensitivity}
                min={1}
                max={3}
                step={1}
                className="w-full"
              />
              <div className="flex justify-between text-xs text-slate-500">
                <span>Low</span>
                <span>Medium</span>
                <span>High</span>
              </div>
              <div className="bg-slate-800/50 rounded-lg p-3 border border-slate-700/30">
                <p className="text-slate-400 text-xs">
                  {sensitivity[0] === 1 && "Only critical hazards will trigger alerts"}
                  {sensitivity[0] === 2 && "Balanced - most hazards will trigger alerts"}
                  {sensitivity[0] === 3 && "All detected hazards will trigger alerts"}
                </p>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Audio Alert Preferences */}
      <div className="px-4 mt-6">
        <h3 className="text-slate-300 text-sm mb-3">Audio Alerts</h3>
        <Card className="bg-slate-900/90 border-slate-700/50">
          <CardContent className="p-4 space-y-4">
            {/* Audio Toggle */}
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center">
                  <Volume2 className="w-5 h-5 text-green-400" />
                </div>
                <div>
                  <p className="text-slate-200 text-sm">Audio Alerts</p>
                  <p className="text-slate-400 text-xs">
                    {audioAlerts ? "Sound enabled" : "Silent mode"}
                  </p>
                </div>
              </div>
              <Switch
                checked={audioAlerts}
                onCheckedChange={setAudioAlerts}
              />
            </div>

            {/* Volume Control */}
            {audioAlerts && (
              <div className="pt-4 border-t border-slate-700/30">
                <div className="flex items-center justify-between mb-3">
                  <p className="text-slate-300 text-sm">Alert Volume</p>
                  <span className="text-slate-400 text-sm">{audioVolume[0]}%</span>
                </div>
                <Slider
                  value={audioVolume}
                  onValueChange={setAudioVolume}
                  min={0}
                  max={100}
                  step={5}
                  className="w-full"
                />
              </div>
            )}
          </CardContent>
        </Card>
      </div>

      {/* V2X Alert Preferences */}
      <div className="px-4 mt-6">
        <h3 className="text-slate-300 text-sm mb-3">Car2X Network</h3>
        <Card className="bg-slate-900/90 border-slate-700/50">
          <CardContent className="p-4">
            <div className="flex items-center justify-between mb-3">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-full bg-purple-500/20 flex items-center justify-center">
                  <Radio className="w-5 h-5 text-purple-400" />
                </div>
                <div>
                  <p className="text-slate-200 text-sm">VW Car2X Alerts</p>
                  <p className="text-slate-400 text-xs">
                    {v2xAlerts ? "Receiving V2X warnings" : "V2X alerts disabled"}
                  </p>
                </div>
              </div>
              <Switch
                checked={v2xAlerts}
                onCheckedChange={setV2xAlerts}
              />
            </div>
            <div className="bg-purple-500/10 rounded-lg p-3 border border-purple-500/20">
              <p className="text-purple-300 text-xs leading-relaxed">
                Car2X technology shares real-time safety warnings from VW's connected vehicle network.
              </p>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Push Notifications */}
      <div className="px-4 mt-6">
        <h3 className="text-slate-300 text-sm mb-3">Push Notifications</h3>
        <Card className="bg-gradient-to-br from-orange-500/10 to-red-500/10 border-orange-500/30">
          <CardContent className="p-4 space-y-4">
            {/* Permission Status */}
            {notificationPermission !== 'granted' && (
              <div className="bg-slate-800/50 rounded-lg p-3 border border-slate-700/30">
                <div className="flex items-start gap-3 mb-3">
                  <BellRing className="w-5 h-5 text-orange-400 mt-0.5 flex-shrink-0" />
                  <div className="flex-1">
                    <p className="text-slate-200 text-sm mb-1">Enable Critical Alerts</p>
                    <p className="text-slate-400 text-xs leading-relaxed">
                      Get notified about high-priority hazards near you, even when the app isn't open.
                    </p>
                  </div>
                </div>
                <Button
                  onClick={handleRequestNotificationPermission}
                  disabled={requestingPermission || notificationPermission === 'denied'}
                  className="w-full bg-orange-500 hover:bg-orange-600 text-white h-10"
                >
                  {requestingPermission ? 'Requesting...' : 
                   notificationPermission === 'denied' ? 'Blocked in Browser Settings' : 
                   'Enable Notifications'}
                </Button>
                {notificationPermission === 'denied' && (
                  <p className="text-xs text-red-400 mt-2">
                    Please enable notifications in your browser settings to receive critical hazard alerts.
                  </p>
                )}
              </div>
            )}

            {/* Notification Toggle - Only show if permission granted */}
            {notificationPermission === 'granted' && (
              <>
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <div className="w-10 h-10 rounded-full bg-orange-500/20 flex items-center justify-center">
                      <BellRing className="w-5 h-5 text-orange-400" />
                    </div>
                    <div>
                      <p className="text-slate-200 text-sm">Critical Hazard Alerts</p>
                      <p className="text-slate-400 text-xs">
                        {notificationSettings.enabled ? "Push notifications enabled" : "Notifications disabled"}
                      </p>
                    </div>
                  </div>
                  <Switch
                    checked={notificationSettings.enabled}
                    onCheckedChange={(checked) => handleNotificationSettingChange({ enabled: checked })}
                  />
                </div>

                {/* Notification Settings - Only show when enabled */}
                {notificationSettings.enabled && (
                  <>
                    {/* Proximity Threshold */}
                    <div className="pt-4 border-t border-slate-700/30">
                      <div className="flex items-center justify-between mb-3">
                        <div>
                          <p className="text-slate-300 text-sm">Alert Distance</p>
                          <p className="text-slate-400 text-xs">How far ahead to notify</p>
                        </div>
                        <Badge className="bg-orange-500/20 text-orange-400 border-orange-500/30">
                          {getProximityLabel(notificationSettings.proximityThreshold)}
                        </Badge>
                      </div>
                      <Select
                        value={notificationSettings.proximityThreshold.toString()}
                        onValueChange={(value) => handleNotificationSettingChange({ proximityThreshold: parseInt(value) })}
                      >
                        <SelectTrigger className="bg-slate-800/50 border-slate-700/50 text-slate-200">
                          <SelectValue />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="500">500m - Very Close</SelectItem>
                          <SelectItem value="1000">1km - Recommended</SelectItem>
                          <SelectItem value="2000">2km - Early Warning</SelectItem>
                          <SelectItem value="3000">3km - Maximum</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    {/* Critical Only Toggle */}
                    <div className="pt-4 border-t border-slate-700/30">
                      <div className="flex items-center justify-between">
                        <div>
                          <p className="text-slate-200 text-sm">Critical Hazards Only</p>
                          <p className="text-slate-400 text-xs">
                            {notificationSettings.criticalOnly 
                              ? "High & medium severity (Tier 1/2)" 
                              : "All hazard types"}
                          </p>
                        </div>
                        <Switch
                          checked={notificationSettings.criticalOnly}
                          onCheckedChange={(checked) => handleNotificationSettingChange({ criticalOnly: checked })}
                        />
                      </div>
                    </div>

                    {/* Do Not Disturb */}
                    <div className="pt-4 border-t border-slate-700/30">
                      <div className="flex items-center justify-between mb-3">
                        <div className="flex items-center gap-3">
                          <div className="w-10 h-10 rounded-full bg-purple-500/20 flex items-center justify-center">
                            <Moon className="w-5 h-5 text-purple-400" />
                          </div>
                          <div>
                            <p className="text-slate-200 text-sm">Do Not Disturb</p>
                            <p className="text-slate-400 text-xs">
                              {notificationSettings.doNotDisturb.enabled 
                                ? `${notificationSettings.doNotDisturb.startTime} - ${notificationSettings.doNotDisturb.endTime}`
                                : "Notifications at all times"}
                            </p>
                          </div>
                        </div>
                        <Switch
                          checked={notificationSettings.doNotDisturb.enabled}
                          onCheckedChange={(checked) => 
                            handleNotificationSettingChange({ 
                              doNotDisturb: { ...notificationSettings.doNotDisturb, enabled: checked }
                            })
                          }
                        />
                      </div>
                      
                      {notificationSettings.doNotDisturb.enabled && (
                        <div className="grid grid-cols-2 gap-3 mt-3">
                          <div>
                            <label className="text-xs text-slate-400 mb-1 block">Start Time</label>
                            <input
                              type="time"
                              value={notificationSettings.doNotDisturb.startTime}
                              onChange={(e) => 
                                handleNotificationSettingChange({
                                  doNotDisturb: { 
                                    ...notificationSettings.doNotDisturb, 
                                    startTime: e.target.value 
                                  }
                                })
                              }
                              className="w-full bg-slate-800/50 border border-slate-700/50 rounded-md px-3 py-2 text-slate-200 text-sm"
                            />
                          </div>
                          <div>
                            <label className="text-xs text-slate-400 mb-1 block">End Time</label>
                            <input
                              type="time"
                              value={notificationSettings.doNotDisturb.endTime}
                              onChange={(e) => 
                                handleNotificationSettingChange({
                                  doNotDisturb: { 
                                    ...notificationSettings.doNotDisturb, 
                                    endTime: e.target.value 
                                  }
                                })
                              }
                              className="w-full bg-slate-800/50 border border-slate-700/50 rounded-md px-3 py-2 text-slate-200 text-sm"
                            />
                          </div>
                        </div>
                      )}
                    </div>
                  </>
                )}
              </>
            )}

            {/* Info Banner */}
            <div className="bg-orange-500/10 rounded-lg p-3 border border-orange-500/20">
              <div className="flex items-start gap-2">
                <Shield className="w-4 h-4 text-orange-400 mt-0.5 flex-shrink-0" />
                <p className="text-orange-300 text-xs leading-relaxed">
                  Push notifications help keep you safe by alerting you to critical road hazards ahead, 
                  even when Hazard Scout isn't actively open.
                </p>
              </div>
            </div>

            {/* Test Notification Button */}
            {notificationPermission === 'granted' && notificationSettings.enabled && (
              <div className="pt-2">
                <Button
                  onClick={handleTestNotification}
                  variant="outline"
                  className="w-full border-orange-500/30 text-orange-400 hover:bg-orange-500/10 h-10"
                >
                  <BellRing className="w-4 h-4 mr-2" />
                  Send Test Notification
                </Button>
              </div>
            )}
          </CardContent>
        </Card>
      </div>

      {/* Hazard Resolution Settings */}
      <div className="px-4 mt-6">
        <h3 className="text-slate-300 text-sm mb-3">Hazard Resolution</h3>
        <Card className="bg-gradient-to-br from-purple-500/10 to-blue-500/10 border-purple-500/30">
          <CardContent className="p-4 space-y-4">
            {/* Auto-Resolution Toggle */}
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-full bg-purple-500/20 flex items-center justify-center">
                  <Clock className="w-5 h-5 text-purple-400" />
                </div>
                <div>
                  <p className="text-slate-200 text-sm">Auto-Resolution</p>
                  <p className="text-slate-400 text-xs">
                    {hazardSettings.autoResolutionEnabled ? "Time-based cleanup enabled" : "Manual resolution only"}
                  </p>
                </div>
              </div>
              <Switch
                checked={hazardSettings.autoResolutionEnabled}
                onCheckedChange={(checked) => handleHazardSettingChange({ autoResolutionEnabled: checked })}
              />
            </div>

            {/* Auto-Resolve Hours */}
            {hazardSettings.autoResolutionEnabled && (
              <>
                <div className="pt-4 border-t border-slate-700/30">
                  <div className="flex items-center justify-between mb-3">
                    <div>
                      <p className="text-slate-300 text-sm">Auto-Resolve After</p>
                      <p className="text-slate-400 text-xs">Without new confirmations</p>
                    </div>
                    <Badge className="bg-purple-500/20 text-purple-400 border-purple-500/30">
                      {hazardSettings.defaultAutoResolveHours}h
                    </Badge>
                  </div>
                  <Select
                    value={hazardSettings.defaultAutoResolveHours.toString()}
                    onValueChange={(value) => handleHazardSettingChange({ defaultAutoResolveHours: parseInt(value) })}
                  >
                    <SelectTrigger className="bg-slate-800/50 border-slate-700/50 text-slate-200">
                      <SelectValue />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="6">6 hours - Very Fast</SelectItem>
                      <SelectItem value="12">12 hours - Fast</SelectItem>
                      <SelectItem value="24">24 hours - Recommended</SelectItem>
                      <SelectItem value="48">48 hours - Conservative</SelectItem>
                      <SelectItem value="72">72 hours - Very Conservative</SelectItem>
                    </SelectContent>
                  </Select>
                </div>

                {/* Confirmations Needed */}
                <div className="pt-4 border-t border-slate-700/30">
                  <div className="flex items-center justify-between mb-3">
                    <div>
                      <p className="text-slate-300 text-sm">Reports to Resolve</p>
                      <p className="text-slate-400 text-xs">"Hazard Gone" confirmations</p>
                    </div>
                    <Badge className="bg-purple-500/20 text-purple-400 border-purple-500/30">
                      {hazardSettings.confirmationsNeededToResolve}
                    </Badge>
                  </div>
                  <Select
                    value={hazardSettings.confirmationsNeededToResolve.toString()}
                    onValueChange={(value) => handleHazardSettingChange({ confirmationsNeededToResolve: parseInt(value) })}
                  >
                    <SelectTrigger className="bg-slate-800/50 border-slate-700/50 text-slate-200">
                      <SelectValue />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="1">1 report - Quick</SelectItem>
                      <SelectItem value="2">2 reports - Fast</SelectItem>
                      <SelectItem value="3">3 reports - Recommended</SelectItem>
                      <SelectItem value="5">5 reports - Strict</SelectItem>
                      <SelectItem value="10">10 reports - Very Strict</SelectItem>
                    </SelectContent>
                  </Select>
                </div>

                {/* Show Resolved Toggle */}
                <div className="pt-4 border-t border-slate-700/30">
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-slate-200 text-sm">Show Resolved Hazards</p>
                      <p className="text-slate-400 text-xs">
                        Display recently cleared hazards
                      </p>
                    </div>
                    <Switch
                      checked={hazardSettings.showResolvedHazards}
                      onCheckedChange={(checked) => handleHazardSettingChange({ showResolvedHazards: checked })}
                    />
                  </div>
                </div>
              </>
            )}

            {/* Info Banner */}
            <div className="bg-purple-500/10 rounded-lg p-3 border border-purple-500/20">
              <div className="flex items-start gap-2">
                <Users className="w-4 h-4 text-purple-400 mt-0.5 flex-shrink-0" />
                <p className="text-purple-300 text-xs leading-relaxed">
                  Community verification keeps the hazard map accurate. Hazards are resolved when multiple 
                  users report them as gone or after a set time without new detections.
                </p>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Privacy Settings */}
      <div className="px-4 mt-6">
        <h3 className="text-slate-300 text-sm mb-3">Privacy</h3>
        <Card className="bg-slate-900/90 border-slate-700/50">
          <CardContent className="p-4">
            <div className="flex items-center justify-between mb-3">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center">
                  <Eye className="w-5 h-5 text-green-400" />
                </div>
                <div>
                  <p className="text-slate-200 text-sm">Show Privacy Status</p>
                  <p className="text-slate-400 text-xs">
                    Display blur confirmation icon
                  </p>
                </div>
              </div>
              <Switch
                checked={piiBlurConfirmation}
                onCheckedChange={setPiiBlurConfirmation}
              />
            </div>
            <div className="bg-green-500/10 rounded-lg p-3 border border-green-500/20">
              <div className="flex items-start gap-2">
                <Shield className="w-4 h-4 text-green-400 mt-0.5 flex-shrink-0" />
                <p className="text-green-300 text-xs leading-relaxed">
                  All captured data automatically blurs faces and license plates before sharing. 
                  Your privacy is always protected.
                </p>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Save Button */}
      <div className="px-4 mt-6 mb-6">
        <Button
          onClick={onBack}
          className="w-full bg-[#0070E1] hover:bg-[#0060C1] text-white h-12"
        >
          Save Settings
        </Button>
      </div>
    </div>
  );
}

// Hazard Management Service with Resolution Workflow
// Handles user confirmations and time-based auto-resolution

export interface HazardLocation {
  latitude: number;
  longitude: number;
}

export type HazardStatus = 'active' | 'resolving' | 'resolved';
export type HazardSeverity = 'high' | 'medium' | 'low';
export type HazardSource = 'network' | 'v2x' | 'your-car' | 'user-report';

export interface UserConfirmation {
  userId: string; // In production, use actual user ID
  timestamp: number;
  type: 'still-there' | 'gone';
  deviceId?: string;
}

export interface HazardData {
  id: string;
  type: string;
  severity: HazardSeverity;
  location: HazardLocation;
  locationName: string; // Human-readable location
  distance?: string; // Distance from user (calculated)
  
  // Lifecycle tracking
  status: HazardStatus;
  firstDetectedAt: number; // Unix timestamp
  lastConfirmedAt: number; // Last time someone confirmed it's still there
  lastUpdatedAt: number; // Any update to the hazard
  
  // User validation
  confirmations: UserConfirmation[];
  confirmationCount: number; // Count of "still there"
  reportedGoneCount: number; // Count of "gone"
  
  // Source tracking
  source: HazardSource;
  detectionCount: number; // How many times detected by sensors
  
  // Auto-resolution config
  autoResolveAfterHours: number; // Default 24 hours
  requireConfirmationsForResolution: number; // Default 3 "gone" reports
}

export interface HazardServiceSettings {
  autoResolutionEnabled: boolean;
  defaultAutoResolveHours: number; // 24 hours default
  confirmationsNeededToResolve: number; // 3 "gone" reports needed
  reconfirmationExtensionHours: number; // 12 hours extension per "still there" confirmation
  showResolvedHazards: boolean;
  resolvedHazardRetentionDays: number; // Keep resolved hazards for 7 days
}

export class HazardManagementService {
  private static instance: HazardManagementService;
  private hazards: Map<string, HazardData> = new Map();
  private settings: HazardServiceSettings;
  private deviceId: string;
  private checkInterval: NodeJS.Timeout | null = null;

  private constructor() {
    this.settings = this.loadSettings();
    this.deviceId = this.getOrCreateDeviceId();
    this.loadHazards();
    this.startAutoResolutionCheck();
  }

  static getInstance(): HazardManagementService {
    if (!HazardManagementService.instance) {
      HazardManagementService.instance = new HazardManagementService();
    }
    return HazardManagementService.instance;
  }

  // Get or create a device ID for tracking user confirmations
  private getOrCreateDeviceId(): string {
    let deviceId = localStorage.getItem('hazard-scout-device-id');
    if (!deviceId) {
      deviceId = `device-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
      localStorage.setItem('hazard-scout-device-id', deviceId);
    }
    return deviceId;
  }

  // Start periodic check for auto-resolution
  private startAutoResolutionCheck(): void {
    // Check every 5 minutes
    this.checkInterval = setInterval(() => {
      this.checkAutoResolution();
    }, 5 * 60 * 1000);

    // Also check immediately
    this.checkAutoResolution();
  }

  // Check all hazards for auto-resolution conditions
  private checkAutoResolution(): void {
    if (!this.settings.autoResolutionEnabled) {
      return;
    }

    const now = Date.now();
    let hasChanges = false;

    this.hazards.forEach((hazard, id) => {
      if (hazard.status === 'resolved') {
        // Check if we should delete old resolved hazards
        const retentionMs = this.settings.resolvedHazardRetentionDays * 24 * 60 * 60 * 1000;
        if (now - hazard.lastUpdatedAt > retentionMs) {
          this.hazards.delete(id);
          hasChanges = true;
        }
        return;
      }

      if (hazard.status === 'active' || hazard.status === 'resolving') {
        const timeSinceLastConfirmation = now - hazard.lastConfirmedAt;
        const autoResolveMs = hazard.autoResolveAfterHours * 60 * 60 * 1000;

        // Check if enough time has passed without confirmation
        if (timeSinceLastConfirmation > autoResolveMs) {
          // Check if enough users reported it gone
          if (hazard.reportedGoneCount >= this.settings.confirmationsNeededToResolve) {
            this.resolveHazard(id, 'time-and-confirmation');
            hasChanges = true;
          } else {
            // Mark as resolving (awaiting confirmation)
            if (hazard.status !== 'resolving') {
              hazard.status = 'resolving';
              hazard.lastUpdatedAt = now;
              hasChanges = true;
            }
          }
        }
      }
    });

    if (hasChanges) {
      this.saveHazards();
    }
  }

  // User confirms hazard is still there
  confirmHazardStillThere(hazardId: string): boolean {
    const hazard = this.hazards.get(hazardId);
    if (!hazard || hazard.status === 'resolved') {
      return false;
    }

    // Check if this device already confirmed recently (prevent spam)
    const recentConfirmation = hazard.confirmations.find(
      c => c.deviceId === this.deviceId && 
           c.type === 'still-there' && 
           Date.now() - c.timestamp < 60 * 60 * 1000 // Within last hour
    );

    if (recentConfirmation) {
      console.log('Already confirmed within the last hour');
      return false;
    }

    const now = Date.now();
    const confirmation: UserConfirmation = {
      userId: this.deviceId,
      timestamp: now,
      type: 'still-there',
      deviceId: this.deviceId
    };

    hazard.confirmations.push(confirmation);
    hazard.confirmationCount += 1;
    hazard.lastConfirmedAt = now;
    hazard.lastUpdatedAt = now;

    // Extend the auto-resolve deadline
    const extension = this.settings.reconfirmationExtensionHours * 60 * 60 * 1000;
    // Reset status to active if it was resolving
    if (hazard.status === 'resolving') {
      hazard.status = 'active';
    }

    this.saveHazards();
    return true;
  }

  // User reports hazard is gone
  reportHazardGone(hazardId: string): boolean {
    const hazard = this.hazards.get(hazardId);
    if (!hazard || hazard.status === 'resolved') {
      return false;
    }

    // Check if this device already reported gone recently
    const recentReport = hazard.confirmations.find(
      c => c.deviceId === this.deviceId && 
           c.type === 'gone' && 
           Date.now() - c.timestamp < 60 * 60 * 1000 // Within last hour
    );

    if (recentReport) {
      console.log('Already reported gone within the last hour');
      return false;
    }

    const now = Date.now();
    const confirmation: UserConfirmation = {
      userId: this.deviceId,
      timestamp: now,
      type: 'gone',
      deviceId: this.deviceId
    };

    hazard.confirmations.push(confirmation);
    hazard.reportedGoneCount += 1;
    hazard.lastUpdatedAt = now;

    // Mark as resolving
    hazard.status = 'resolving';

    // Check if we have enough "gone" reports to resolve
    if (hazard.reportedGoneCount >= this.settings.confirmationsNeededToResolve) {
      this.resolveHazard(hazardId, 'user-confirmation');
    }

    this.saveHazards();
    return true;
  }

  // Resolve a hazard
  private resolveHazard(hazardId: string, reason: 'time-and-confirmation' | 'user-confirmation' | 'manual'): void {
    const hazard = this.hazards.get(hazardId);
    if (!hazard) return;

    hazard.status = 'resolved';
    hazard.lastUpdatedAt = Date.now();

    console.log(`Hazard ${hazardId} resolved due to: ${reason}`);
  }

  // Manually resolve a hazard (admin function)
  manuallyResolveHazard(hazardId: string): boolean {
    const hazard = this.hazards.get(hazardId);
    if (!hazard) return false;

    this.resolveHazard(hazardId, 'manual');
    this.saveHazards();
    return true;
  }

  // Add a new hazard
  addHazard(hazardData: Omit<HazardData, 'id' | 'status' | 'firstDetectedAt' | 'lastConfirmedAt' | 'lastUpdatedAt' | 'confirmations' | 'confirmationCount' | 'reportedGoneCount' | 'detectionCount'>): HazardData {
    const now = Date.now();
    const id = `hazard-${now}-${Math.random().toString(36).substr(2, 9)}`;

    const newHazard: HazardData = {
      ...hazardData,
      id,
      status: 'active',
      firstDetectedAt: now,
      lastConfirmedAt: now,
      lastUpdatedAt: now,
      confirmations: [],
      confirmationCount: 0,
      reportedGoneCount: 0,
      detectionCount: 1
    };

    this.hazards.set(id, newHazard);
    this.saveHazards();
    return newHazard;
  }

  // Increment detection count (when sensor re-detects same hazard)
  incrementDetectionCount(hazardId: string): void {
    const hazard = this.hazards.get(hazardId);
    if (!hazard || hazard.status === 'resolved') return;

    hazard.detectionCount += 1;
    hazard.lastConfirmedAt = Date.now(); // Sensor detection counts as confirmation
    hazard.lastUpdatedAt = Date.now();

    // Reset to active if it was resolving
    if (hazard.status === 'resolving') {
      hazard.status = 'active';
    }

    this.saveHazards();
  }

  // Get all hazards
  getAllHazards(): HazardData[] {
    return Array.from(this.hazards.values());
  }

  // Get active hazards only
  getActiveHazards(): HazardData[] {
    return Array.from(this.hazards.values()).filter(h => h.status === 'active' || h.status === 'resolving');
  }

  // Get hazard by ID
  getHazard(hazardId: string): HazardData | undefined {
    return this.hazards.get(hazardId);
  }

  // Get time until auto-resolution for a hazard
  getTimeUntilAutoResolve(hazardId: string): number | null {
    const hazard = this.hazards.get(hazardId);
    if (!hazard || hazard.status === 'resolved') return null;

    const autoResolveMs = hazard.autoResolveAfterHours * 60 * 60 * 1000;
    const timeSinceLastConfirmation = Date.now() - hazard.lastConfirmedAt;
    const timeRemaining = autoResolveMs - timeSinceLastConfirmation;

    return timeRemaining > 0 ? timeRemaining : 0;
  }

  // Check if user has already confirmed this hazard
  hasUserConfirmed(hazardId: string, type: 'still-there' | 'gone'): boolean {
    const hazard = this.hazards.get(hazardId);
    if (!hazard) return false;

    return hazard.confirmations.some(
      c => c.deviceId === this.deviceId && 
           c.type === type && 
           Date.now() - c.timestamp < 60 * 60 * 1000 // Within last hour
    );
  }

  // Get hazard resolution progress
  getResolutionProgress(hazardId: string): {
    confirmationsNeeded: number;
    currentGoneReports: number;
    currentStillThereReports: number;
    percentageToResolution: number;
    timeRemainingMs: number | null;
  } | null {
    const hazard = this.hazards.get(hazardId);
    if (!hazard) return null;

    const timeRemaining = this.getTimeUntilAutoResolve(hazardId);
    const percentageToResolution = Math.min(
      100,
      (hazard.reportedGoneCount / this.settings.confirmationsNeededToResolve) * 100
    );

    return {
      confirmationsNeeded: this.settings.confirmationsNeededToResolve,
      currentGoneReports: hazard.reportedGoneCount,
      currentStillThereReports: hazard.confirmationCount,
      percentageToResolution,
      timeRemainingMs: timeRemaining
    };
  }

  // Update settings
  updateSettings(newSettings: Partial<HazardServiceSettings>): void {
    this.settings = { ...this.settings, ...newSettings };
    this.saveSettings();
  }

  // Get current settings
  getSettings(): HazardServiceSettings {
    return { ...this.settings };
  }

  // Load hazards from localStorage
  private loadHazards(): void {
    try {
      const saved = localStorage.getItem('hazard-scout-hazards');
      if (saved) {
        const hazardArray: HazardData[] = JSON.parse(saved);
        this.hazards = new Map(hazardArray.map(h => [h.id, h]));
      }
    } catch (e) {
      console.error('Failed to load hazards:', e);
    }
  }

  // Save hazards to localStorage
  private saveHazards(): void {
    try {
      const hazardArray = Array.from(this.hazards.values());
      localStorage.setItem('hazard-scout-hazards', JSON.stringify(hazardArray));
    } catch (e) {
      console.error('Failed to save hazards:', e);
    }
  }

  // Load settings from localStorage
  private loadSettings(): HazardServiceSettings {
    try {
      const saved = localStorage.getItem('hazard-scout-service-settings');
      if (saved) {
        return JSON.parse(saved);
      }
    } catch (e) {
      console.error('Failed to load hazard service settings:', e);
    }

    // Default settings
    return {
      autoResolutionEnabled: true,
      defaultAutoResolveHours: 24,
      confirmationsNeededToResolve: 3,
      reconfirmationExtensionHours: 12,
      showResolvedHazards: false,
      resolvedHazardRetentionDays: 7
    };
  }

  // Save settings to localStorage
  private saveSettings(): void {
    try {
      localStorage.setItem('hazard-scout-service-settings', JSON.stringify(this.settings));
    } catch (e) {
      console.error('Failed to save hazard service settings:', e);
    }
  }

  // Cleanup
  destroy(): void {
    if (this.checkInterval) {
      clearInterval(this.checkInterval);
    }
  }
}

// Export singleton instance
export const hazardService = HazardManagementService.getInstance();

// Helper function to format time remaining
export function formatTimeRemaining(ms: number): string {
  const hours = Math.floor(ms / (1000 * 60 * 60));
  const minutes = Math.floor((ms % (1000 * 60 * 60)) / (1000 * 60));

  if (hours > 24) {
    const days = Math.floor(hours / 24);
    return `${days}d ${hours % 24}h`;
  }
  if (hours > 0) {
    return `${hours}h ${minutes}m`;
  }
  return `${minutes}m`;
}

// Helper to get relative time
export function getRelativeTime(timestamp: number): string {
  const now = Date.now();
  const diff = now - timestamp;

  const minutes = Math.floor(diff / (1000 * 60));
  const hours = Math.floor(diff / (1000 * 60 * 60));
  const days = Math.floor(diff / (1000 * 60 * 60 * 24));

  if (minutes < 1) return 'Just now';
  if (minutes < 60) return `${minutes} min ago`;
  if (hours < 24) return `${hours} hour${hours > 1 ? 's' : ''} ago`;
  return `${days} day${days > 1 ? 's' : ''} ago`;
}

import { useState, useEffect } from "react";
import { AlertTriangle, Wifi, Zap } from "lucide-react";
import { Badge } from "./ui/badge";
import { GoogleMapComponent } from "./GoogleMapComponent";

interface LiveMapScreenProps {
  onReportHazard: () => void;
}

export function LiveMapScreen({ onReportHazard }: LiveMapScreenProps) {
  const [latency, setLatency] = useState(1.8);

  useEffect(() => {
    // Simulate real-time latency updates
    const interval = setInterval(() => {
      setLatency(Math.random() * 0.5 + 1.5); // Random between 1.5-2.0
    }, 2000);
    return () => clearInterval(interval);
  }, []);

  return (
    <div className="h-screen w-full bg-slate-950 flex flex-col overflow-hidden">
      {/* Top Status Bar */}
      <div className="bg-slate-900/95 backdrop-blur-sm border-b border-slate-700/50 px-4 py-3 flex items-center justify-between z-20">
        <div className="flex items-center gap-2">
          <div className="w-2 h-2 rounded-full bg-[#0070E1] animate-pulse" />
          <span className="text-slate-300 text-sm">Driving Mode Active</span>
        </div>
        <div className="flex items-center gap-3">
          <div className="flex items-center gap-1.5 text-slate-300">
            <Zap className="w-4 h-4 text-[#0070E1]" />
            <span className="text-sm">{latency.toFixed(1)}s</span>
          </div>
          <Badge className="bg-green-500/20 text-green-400 border-green-500/30 text-xs">
            <Wifi className="w-3 h-3 mr-1" />
            Connected
          </Badge>
        </div>
      </div>

      {/* Map Container */}
      <div className="flex-1 relative">
        <GoogleMapComponent onHazardClick={onReportHazard} />

        {/* Legend */}
        <div className="absolute top-4 left-4 bg-slate-900/90 backdrop-blur-sm border border-slate-700/50 rounded-lg p-3 space-y-2 z-10">
          <div className="flex items-center gap-2">
            <div className="w-3 h-3 bg-red-500 rounded-full" />
            <span className="text-slate-300 text-xs">High Severity</span>
          </div>
          <div className="flex items-center gap-2">
            <div className="w-3 h-3 bg-amber-500 rounded-full" />
            <span className="text-slate-300 text-xs">Medium Severity</span>
          </div>
          <div className="flex items-center gap-2">
            <div className="w-3 h-3 bg-[#0070E1] rounded-full" />
            <span className="text-slate-300 text-xs">Your Vehicle</span>
          </div>
        </div>
      </div>

      {/* Critical Alert Banner */}
      <div className="bg-red-500 px-6 py-4 flex items-center justify-between z-20 shadow-2xl shadow-red-500/30 animate-pulse">
        <div className="flex items-center gap-3">
          <div className="w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center">
            <AlertTriangle className="w-6 h-6 text-white fill-white" />
          </div>
          <div>
            <h3 className="text-white">HIGH SEVERITY POTHOLE AHEAD!</h3>
            <p className="text-red-100 text-sm">Distance: 150m</p>
          </div>
        </div>
        <div className="text-right">
          <div className="text-white text-sm">ETA</div>
          <div className="text-white">~12s</div>
        </div>
      </div>

      {/* Bottom Info Bar */}
      <div className="bg-slate-900/95 backdrop-blur-sm border-t border-slate-700/50 px-4 py-2 flex items-center justify-between text-xs text-slate-400">
        <span>End-to-End Latency: {"<"}2s</span>
        <span>Real-time monitoring active</span>
      </div>
    </div>
  );
}

// Live Navigation Map Screen with Real-Time Hazard Alerts
import { useEffect, useRef, useState, useCallback } from 'react';
import mapboxgl from 'mapbox-gl';
import 'mapbox-gl/dist/mapbox-gl.css';
import { HazardData } from './HazardService';
import { getMarkerIcon, VehicleMarker } from './MapMarkerIcons';
import { createRoot } from 'react-dom/client';
import { X, AlertTriangle, Clock, Navigation as NavigationIcon } from 'lucide-react';
import { Button } from './ui/button';
import { Badge } from './ui/badge';
import { toast } from 'sonner';

// Mapbox access token
const MAPBOX_TOKEN = 'pk.eyJ1IjoiaGFyaXNzaCIsImEiOiJjbWhseDllNTkwaGIxMmlxa3FmM3VwbHl2In0.XUjNuUn7OSsR_35T2i6Frg';

interface LiveNavigationMapScreenProps {
  startLocation: [number, number]; // [longitude, latitude]
  destinationLocation: [number, number]; // [longitude, latitude]
  destinationName: string;
  hazards: HazardData[];
  onEndNavigation: () => void;
}

// Calculate distance between two coordinates in meters
function calculateDistance(lat1: number, lon1: number, lat2: number, lon2: number): number {
  const R = 6371e3; // Earth's radius in meters
  const 1 = lat1 * Math.PI / 180;
  const 2 = lat2 * Math.PI / 180;
  const  = (lat2 - lat1) * Math.PI / 180;
  const  = (lon2 - lon1) * Math.PI / 180;

  const a = Math.sin( / 2) * Math.sin( / 2) +
    Math.cos(1) * Math.cos(2) *
    Math.sin( / 2) * Math.sin( / 2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

  return R * c; // Distance in meters
}

// Check if a point is near a route (within buffer distance)
function isPointNearRoute(
  point: [number, number],
  routeCoordinates: [number, number][],
  bufferMeters: number = 100
): boolean {
  for (const routePoint of routeCoordinates) {
    const distance = calculateDistance(
      point[1], point[0],
      routePoint[1], routePoint[0]
    );
    if (distance <= bufferMeters) {
      return true;
    }
  }
  return false;
}

// Format distance for display
function formatDistance(meters: number): string {
  if (meters < 1000) {
    return `${Math.round(meters)}m`;
  }
  return `${(meters / 1000).toFixed(1)}km`;
}

export function LiveNavigationMapScreen({
  startLocation,
  destinationLocation,
  destinationName,
  hazards,
  onEndNavigation
}: LiveNavigationMapScreenProps) {
  const mapContainer = useRef<HTMLDivElement>(null);
  const map = useRef<mapboxgl.Map | null>(null);
  const markersRef = useRef<mapboxgl.Marker[]>([]);
  const [userLocation, setUserLocation] = useState<[number, number]>(startLocation);
  const [navigationRoute, setNavigationRoute] = useState<any>(null);
  const [routeHazards, setRouteHazards] = useState<HazardData[]>([]);
  const [proximityHazard, setProximityHazard] = useState<HazardData | null>(null);
  const [routeInfo, setRouteInfo] = useState<{ distance: string; duration: string } | null>(null);
  const [currentStreet, setCurrentStreet] = useState<string>('');
  const routeSourceId = useRef<string>('navigation-route');
  const warningHazards = useRef<Set<string>>(new Set());

  // Check if we have a valid Mapbox token
  const hasValidToken = MAPBOX_TOKEN && 
    MAPBOX_TOKEN !== 'YOUR_MAPBOX_TOKEN_HERE' && 
    !MAPBOX_TOKEN.includes('example') &&
    (MAPBOX_TOKEN.startsWith('pk.') || MAPBOX_TOKEN.startsWith('sk.'));

  // Track user's real-time position
  useEffect(() => {
    if ('geolocation' in navigator) {
      const watchId = navigator.geolocation.watchPosition(
        (position) => {
          const newPos: [number, number] = [
            position.coords.longitude, 
            position.coords.latitude
          ];
          setUserLocation(newPos);
        },
        (error) => {
          console.log('Geolocation error:', error);
        },
        {
          enableHighAccuracy: true,
          maximumAge: 1000,
          timeout: 5000
        }
      );

      return () => navigator.geolocation.clearWatch(watchId);
    }
  }, []);

  // Reverse geocode to get current street name
  useEffect(() => {
    const getStreetName = async () => {
      if (!hasValidToken || !userLocation) return;

      try {
        const response = await fetch(
          `https://api.mapbox.com/geocoding/v5/mapbox.places/${userLocation[0]},${userLocation[1]}.json?access_token=${MAPBOX_TOKEN}&types=address`
        );
        const data = await response.json();
        
        if (data.features && data.features.length > 0) {
          const address = data.features[0];
          const street = address.text || '';
          const place = address.context?.find((c: any) => c.id.startsWith('place'))?.text || '';
          setCurrentStreet(street ? `${street}${place ? ', ' + place : ''}` : 'Navigating...');
        }
      } catch (error) {
        console.error('Error getting street name:', error);
      }
    };

    getStreetName();
    const interval = setInterval(getStreetName, 10000); // Update every 10 seconds
    return () => clearInterval(interval);
  }, [userLocation, hasValidToken]);

  // Fetch navigation route
  const fetchRoute = useCallback(async () => {
    if (!hasValidToken) return;

    try {
      const query = await fetch(
        `https://api.mapbox.com/directions/v5/mapbox/driving/${userLocation[0]},${userLocation[1]};${destinationLocation[0]},${destinationLocation[1]}?geometries=geojson&steps=true&access_token=${MAPBOX_TOKEN}`,
        { method: 'GET' }
      );
      const json = await query.json();
      
      if (json.routes && json.routes.length > 0) {
        const route = json.routes[0];
        setNavigationRoute(route);
        
        // Calculate route info
        const distance = formatDistance(route.distance);
        const duration = Math.round(route.duration / 60);
        setRouteInfo({ 
          distance, 
          duration: duration < 1 ? '<1 min' : `${duration} min` 
        });
        
        // Find hazards along the route (within 100m buffer)
        const routeCoordinates = route.geometry.coordinates;
        const hazardsOnRoute = hazards.filter(hazard => 
          isPointNearRoute(
            [hazard.location.longitude, hazard.location.latitude],
            routeCoordinates,
            100
          )
        );
        
        setRouteHazards(hazardsOnRoute);
      }
    } catch (error) {
      console.error('Error fetching route:', error);
      toast.error('Unable to calculate route');
    }
  }, [userLocation, destinationLocation, hasValidToken, hazards]);

  // Initialize route
  useEffect(() => {
    fetchRoute();
  }, [fetchRoute]);

  // Check proximity to hazards and show warnings
  useEffect(() => {
    const checkProximity = () => {
      let closestHazard: HazardData | null = null;
      let closestDistance = Infinity;

      // Only check hazards on the route
      routeHazards.forEach(hazard => {
        const distance = calculateDistance(
          userLocation[1], // latitude
          userLocation[0], // longitude
          hazard.location.latitude,
          hazard.location.longitude
        );

        // Check if within 1km and this is the closest
        if (distance < 1000 && distance < closestDistance) {
          closestDistance = distance;
          closestHazard = hazard;
        }

        // Warn if within 500 meters and haven't warned yet
        if (distance < 500 && !warningHazards.current.has(hazard.id)) {
          warningHazards.current.add(hazard.id);
          
          // Determine toast type based on severity
          const toastFn = hazard.severity === 'high' ? toast.error : toast.warning;
          const severityIcon = hazard.severity === 'high' ? '' : '';
          
          // Show warning toast with more detail
          toastFn(`${severityIcon} ${hazard.type} Ahead!`, {
            description: `${Math.round(distance)}m ahead on ${hazard.locationName}`,
            duration: 8000,
            action: {
              label: 'View',
              onClick: () => {
                // Center map on hazard
                if (map.current) {
                  map.current.flyTo({
                    center: [hazard.location.longitude, hazard.location.latitude],
                    zoom: 17,
                    duration: 1000
                  });
                }
              }
            }
          });
        } else if (distance > 1500 && warningHazards.current.has(hazard.id)) {
          // Remove from warned set if moved far away
          warningHazards.current.delete(hazard.id);
        }
      });

      setProximityHazard(closestHazard);
    };

    checkProximity();
    const interval = setInterval(checkProximity, 5000); // Check every 5 seconds

    return () => clearInterval(interval);
  }, [userLocation, routeHazards]);

  // Initialize Mapbox
  useEffect(() => {
    if (!hasValidToken || !mapContainer.current) return;

    mapboxgl.accessToken = MAPBOX_TOKEN;
    
    try {
      map.current = new mapboxgl.Map({
        container: mapContainer.current,
        style: 'mapbox://styles/mapbox/dark-v11', // High-contrast dark theme
        center: userLocation,
        zoom: 15,
        pitch: 60, // 3D perspective
        bearing: 0,
        attributionControl: false,
      });

      // Add navigation controls
      map.current.addControl(new mapboxgl.NavigationControl(), 'bottom-right');

    } catch (error) {
      console.error('Error initializing Mapbox:', error);
    }

    return () => {
      if (map.current) {
        map.current.remove();
      }
    };
  }, [hasValidToken, userLocation]);

  // Update map center to follow user location
  useEffect(() => {
    if (map.current && userLocation) {
      map.current.flyTo({
        center: userLocation,
        zoom: 16,
        duration: 1000,
        essential: true
      });
    }
  }, [userLocation]);

  // Update navigation route on map
  useEffect(() => {
    if (!map.current || !navigationRoute) return;

    const updateRoute = () => {
      if (!map.current) return;

      // Remove existing route if any
      if (map.current.getLayer('route')) {
        map.current.removeLayer('route');
      }
      if (map.current.getSource(routeSourceId.current)) {
        map.current.removeSource(routeSourceId.current);
      }

      // Add route source
      map.current.addSource(routeSourceId.current, {
        type: 'geojson',
        data: {
          type: 'Feature',
          properties: {},
          geometry: navigationRoute.geometry
        }
      });

      // Add route layer with VW blue color
      map.current.addLayer({
        id: 'route',
        type: 'line',
        source: routeSourceId.current,
        layout: {
          'line-join': 'round',
          'line-cap': 'round'
        },
        paint: {
          'line-color': '#0070E1',
          'line-width': 6,
          'line-opacity': 0.85
        }
      });
    };

    if (map.current.isStyleLoaded()) {
      updateRoute();
    } else {
      map.current.on('load', updateRoute);
    }
  }, [navigationRoute]);

  // Update markers when hazards or location change
  useEffect(() => {
    if (!map.current) return;

    // Remove old markers
    markersRef.current.forEach(marker => marker.remove());
    markersRef.current = [];

    // Add user location marker (vehicle)
    const vehicleEl = document.createElement('div');
    const vehicleRoot = createRoot(vehicleEl);
    vehicleRoot.render(<VehicleMarker className="w-10 h-10" />);
    
    try {
      const vehicleMarker = new mapboxgl.Marker({ 
        element: vehicleEl, 
        anchor: 'center',
        rotationAlignment: 'map'
      })
        .setLngLat(userLocation)
        .addTo(map.current);
      markersRef.current.push(vehicleMarker);
    } catch (error) {
      console.error('Error adding vehicle marker:', error);
    }

    // Add destination marker
    const destEl = document.createElement('div');
    destEl.className = 'w-10 h-10 bg-[#0070E1] rounded-full border-4 border-white shadow-lg flex items-center justify-center';
    destEl.innerHTML = '<div class="w-3 h-3 bg-white rounded-full"></div>';
    
    try {
      const destMarker = new mapboxgl.Marker({ 
        element: destEl, 
        anchor: 'center'
      })
        .setLngLat(destinationLocation)
        .addTo(map.current);
      markersRef.current.push(destMarker);
    } catch (error) {
      console.error('Error adding destination marker:', error);
    }

    // Add hazard markers - show ALL hazards in the area, highlight those on route
    hazards.forEach((hazard) => {
      const el = document.createElement('div');
      el.className = 'hazard-marker cursor-pointer transition-transform hover:scale-110';
      
      const root = createRoot(el);
      const MarkerComponent = getMarkerIcon(hazard.severity, hazard.source, hazard.status);
      
      // Check if hazard is on route
      const isOnRoute = routeHazards.some(h => h.id === hazard.id);
      
      // Check if hazard is nearby
      const distance = calculateDistance(
        userLocation[1],
        userLocation[0],
        hazard.location.latitude,
        hazard.location.longitude
      );
      
      const isNearby = distance < 500;
      
      root.render(
        <div className={isNearby || isOnRoute ? 'animate-pulse' : ''}>
          {isOnRoute && (
            <div className="absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full border-2 border-white z-10">
              <div className="absolute inset-0 bg-red-500 rounded-full animate-ping"></div>
            </div>
          )}
          <MarkerComponent className="w-10 h-10" />
        </div>
      );

      try {
        const marker = new mapboxgl.Marker({ element: el, anchor: 'center' })
          .setLngLat([hazard.location.longitude, hazard.location.latitude])
          .addTo(map.current!);
        
        markersRef.current.push(marker);
      } catch (error) {
        console.error('Error adding hazard marker:', error);
      }
    });

  }, [hazards, userLocation, destinationLocation, routeHazards]);

  // Get severity color for UI
  const getSeverityColor = (severity: string) => {
    switch(severity) {
      case 'high': return 'bg-red-500';
      case 'medium': return 'bg-amber-500';
      case 'low': return 'bg-yellow-500';
      default: return 'bg-slate-500';
    }
  };

  const getSeverityTextColor = (severity: string) => {
    switch(severity) {
      case 'high': return 'text-red-400';
      case 'medium': return 'text-amber-400';
      case 'low': return 'text-yellow-400';
      default: return 'text-slate-400';
    }
  };

  return (
    <div className="fixed inset-0 z-50 bg-slate-950">
      {/* Full-screen Map */}
      <div ref={mapContainer} className="absolute inset-0 w-full h-full" />

      {/* Top Navigation Bar */}
      <div className="absolute top-0 left-0 right-0 z-10 safe-area-top">
        <div className="bg-gradient-to-b from-slate-900/95 via-slate-900/90 to-transparent backdrop-blur-sm">
          <div className="flex items-center justify-between px-4 py-4">
            {/* End Navigation Button */}
            <Button
              onClick={onEndNavigation}
              variant="outline"
              size="sm"
              className="bg-slate-900/90 border-slate-700 text-white hover:bg-slate-800 flex-shrink-0"
            >
              <X className="w-4 h-4 mr-1" />
              End
            </Button>

            {/* Current Street / Next Turn */}
            <div className="flex-1 mx-2 text-center min-w-0">
              <p className="text-white text-sm truncate">{currentStreet || 'Navigating...'}</p>
              <p className="text-slate-400 text-xs truncate">to {destinationName}</p>
            </div>

            {/* Hazard Count Badge */}
            {routeHazards.length > 0 && (
              <Badge className="bg-red-500/90 text-white border-red-600 flex items-center gap-1 flex-shrink-0">
                <AlertTriangle className="w-3 h-3" />
                {routeHazards.length}
              </Badge>
            )}
          </div>
        </div>
      </div>

      {/* Hazard Alert Overlay - Appears when within proximity */}
      {proximityHazard && (
        <div className="absolute bottom-[140px] left-0 right-0 z-20 px-4">
          <div className={`${getSeverityColor(proximityHazard.severity)} rounded-2xl shadow-2xl overflow-hidden animate-in slide-in-from-bottom-4`}>
            <div className="bg-black/40 backdrop-blur-sm px-4 py-4">
              <div className="flex items-start gap-3">
                <div className="flex-shrink-0">
                  <AlertTriangle className="w-8 h-8 text-white" />
                </div>
                <div className="flex-1 min-w-0">
                  <div className="flex items-center gap-2 mb-1 flex-wrap">
                    <p className="text-white text-base font-semibold">ALERT: {proximityHazard.type.toUpperCase()}</p>
                    <Badge className="bg-white/20 text-white text-xs">
                      {calculateDistance(
                        userLocation[1],
                        userLocation[0],
                        proximityHazard.location.latitude,
                        proximityHazard.location.longitude
                      ) < 1000 
                        ? `${Math.round(calculateDistance(
                            userLocation[1],
                            userLocation[0],
                            proximityHazard.location.latitude,
                            proximityHazard.location.longitude
                          ))}m ahead`
                        : `${(calculateDistance(
                            userLocation[1],
                            userLocation[0],
                            proximityHazard.location.latitude,
                            proximityHazard.location.longitude
                          ) / 1000).toFixed(1)}km ahead`
                      }
                    </Badge>
                  </div>
                  <p className="text-white/90 text-sm truncate">{proximityHazard.locationName}</p>
                  <div className="flex items-center gap-2 mt-2 flex-wrap">
                    <Badge className={`${getSeverityColor(proximityHazard.severity)}/80 text-white text-xs`}>
                      {proximityHazard.severity} severity
                    </Badge>
                    {proximityHazard.source === 'v2x' && (
                      <span className="text-white/80 text-xs"> V2X Alert</span>
                    )}
                    {proximityHazard.source === 'your-car' && (
                      <span className="text-white/80 text-xs"> Your Car</span>
                    )}
                    {proximityHazard.source === 'network' && (
                      <span className="text-white/80 text-xs"> Network</span>
                    )}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Bottom Navigation Info Bar */}
      <div className="absolute bottom-0 left-0 right-0 z-30 pb-[72px]">
        <div className="bg-gradient-to-t from-slate-900/95 via-slate-900/90 to-transparent backdrop-blur-sm">
          <div className="px-4 py-3">
            <div className="bg-slate-900/95 rounded-xl border border-slate-700/50 px-4 py-3 shadow-xl">
              <div className="flex items-center justify-around gap-3">
                {/* ETA */}
                {routeInfo && (
                  <>
                    <div className="flex items-center gap-2 flex-1 min-w-0">
                      <Clock className="w-5 h-5 text-[#0070E1] flex-shrink-0" />
                      <div className="min-w-0">
                        <p className="text-white text-sm truncate">{routeInfo.duration}</p>
                        <p className="text-slate-400 text-xs">ETA</p>
                      </div>
                    </div>

                    {/* Divider */}
                    <div className="h-10 w-px bg-slate-700 flex-shrink-0"></div>

                    {/* Distance */}
                    <div className="flex items-center gap-2 flex-1 min-w-0">
                      <NavigationIcon className="w-5 h-5 text-[#0070E1] flex-shrink-0" />
                      <div className="min-w-0">
                        <p className="text-white text-sm truncate">{routeInfo.distance}</p>
                        <p className="text-slate-400 text-xs">Distance</p>
                      </div>
                    </div>

                    {/* Divider */}
                    <div className="h-10 w-px bg-slate-700 flex-shrink-0"></div>
                  </>
                )}

                {/* Hazards on Route */}
                <div className="flex items-center gap-2 flex-1 min-w-0">
                  <AlertTriangle className="w-5 h-5 text-red-400 flex-shrink-0" />
                  <div className="min-w-0">
                    <p className="text-white text-sm truncate">{routeHazards.length}</p>
                    <p className="text-slate-400 text-xs">Hazards</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Map Legend - Top Right */}
      <div className="absolute top-24 right-4 z-10">
        <div className="bg-slate-900/95 backdrop-blur-sm border border-slate-700/50 rounded-lg px-3 py-2 space-y-1.5 shadow-lg">
          <div className="flex items-center gap-2">
            <div className="w-3 h-3 bg-red-500 rounded-sm" />
            <span className="text-white text-xs">Critical</span>
          </div>
          <div className="flex items-center gap-2">
            <div className="w-3 h-3 bg-amber-500 rounded-sm" />
            <span className="text-white text-xs">High</span>
          </div>
          <div className="flex items-center gap-2">
            <div className="w-3 h-3 bg-yellow-500 rounded-sm" />
            <span className="text-white text-xs">Medium</span>
          </div>
        </div>
      </div>
    </div>
  );
}

import { useState } from "react";
import { Card, CardContent, CardHeader } from "./ui/card";
import { Input } from "./ui/input";
import { Label } from "./ui/label";
import { Button } from "./ui/button";
import { Lock, User, Car, ShieldAlert } from "lucide-react";

interface LoginScreenProps {
  onAuthenticate: () => void;
}

export function LoginScreen({ onAuthenticate }: LoginScreenProps) {
  const [driverId, setDriverId] = useState("");
  const [password, setPassword] = useState("");
  const [vehicleReg, setVehicleReg] = useState("");

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (driverId && password && vehicleReg) {
      onAuthenticate();
    }
  };

  return (
    <div className="min-h-screen w-full flex items-center justify-center p-4 relative overflow-hidden">
      {/* Premium background with gradient */}
      <div className="absolute inset-0 bg-gradient-to-br from-slate-50 via-slate-100 to-slate-50 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950" />
      <div className="absolute inset-0 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-blue-200/20 via-transparent to-transparent dark:from-blue-950/20 dark:via-transparent dark:to-transparent" />
      
      {/* Grid pattern overlay */}
      <div className="absolute inset-0 bg-[linear-gradient(rgba(0,0,0,0.02)_1px,transparent_1px),linear-gradient(90deg,rgba(0,0,0,0.02)_1px,transparent_1px)] dark:bg-[linear-gradient(rgba(255,255,255,0.02)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.02)_1px,transparent_1px)] bg-[size:50px_50px]" />

      <div className="relative z-10 w-full max-w-md">
        {/* Hazard Scout Logo & Branding */}
        <div className="flex flex-col items-center mb-8">
          <div className="relative mb-4">
            <div className="w-20 h-20 rounded-2xl bg-gradient-to-br from-[#0070E1] to-[#0050A1] backdrop-blur-sm border border-[#0070E1]/30 flex items-center justify-center shadow-lg shadow-[#0070E1]/20">
              <ShieldAlert className="w-11 h-11 text-white" strokeWidth={2} />
            </div>
            {/* Pulse animation ring */}
            <div className="absolute inset-0 w-20 h-20 rounded-2xl bg-[#0070E1]/20 animate-ping" style={{ animationDuration: '2s' }}></div>
          </div>
          <div className="text-center">
            <h1 className="text-3xl text-slate-900 dark:text-white mb-1 tracking-tight">Hazard Scout</h1>
            <p className="text-slate-600 dark:text-slate-400 text-sm">Road Safety Intelligence System</p>
          </div>
        </div>

        <Card className="bg-white/90 dark:bg-slate-900/80 backdrop-blur-xl border-slate-300 dark:border-slate-700/50 shadow-2xl">
          <CardHeader className="space-y-1 pb-4">
            <h2 className="text-center text-slate-900 dark:text-slate-100">Secure Driver Authentication</h2>
            <p className="text-center text-slate-600 dark:text-slate-400 text-sm">Connect your vehicle to continue</p>
          </CardHeader>
          <CardContent>
            <form onSubmit={handleSubmit} className="space-y-5">
              {/* Driver ID */}
              <div className="space-y-2">
                <Label htmlFor="driverId" className="text-slate-900 dark:text-slate-200 flex items-center gap-2">
                  <User className="w-4 h-4" />
                  Driver ID
                </Label>
                <Input
                  id="driverId"
                  type="text"
                  placeholder="Enter your driver ID"
                  value={driverId}
                  onChange={(e) => setDriverId(e.target.value)}
                  className="bg-slate-100 dark:bg-slate-800/50 border-slate-300 dark:border-slate-700 text-slate-900 dark:text-slate-100 placeholder:text-slate-400 dark:placeholder:text-slate-500 focus:border-[#0070E1] focus:ring-[#0070E1]/30"
                  required
                />
              </div>

              {/* Password */}
              <div className="space-y-2">
                <Label htmlFor="password" className="text-slate-900 dark:text-slate-200 flex items-center gap-2">
                  <Lock className="w-4 h-4" />
                  Password
                </Label>
                <Input
                  id="password"
                  type="password"
                  placeholder="Enter your password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  className="bg-slate-100 dark:bg-slate-800/50 border-slate-300 dark:border-slate-700 text-slate-900 dark:text-slate-100 placeholder:text-slate-400 dark:placeholder:text-slate-500 focus:border-[#0070E1] focus:ring-[#0070E1]/30"
                  required
                />
              </div>

              {/* Vehicle Registration */}
              <div className="space-y-2">
                <Label htmlFor="vehicleReg" className="text-slate-900 dark:text-slate-200 flex items-center gap-2">
                  <Car className="w-4 h-4" />
                  Vehicle Registration Number
                </Label>
                <Input
                  id="vehicleReg"
                  type="text"
                  placeholder="e.g., ABC-1234"
                  value={vehicleReg}
                  onChange={(e) => setVehicleReg(e.target.value)}
                  className="bg-slate-100 dark:bg-slate-800/50 border-slate-300 dark:border-slate-700 text-slate-900 dark:text-slate-100 placeholder:text-slate-400 dark:placeholder:text-slate-500 focus:border-[#0070E1] focus:ring-[#0070E1]/30"
                  required
                />
              </div>

              {/* Submit Button */}
              <Button
                type="submit"
                className="w-full bg-[#0070E1] hover:bg-[#0060C1] text-white shadow-lg shadow-[#0070E1]/20 transition-all duration-200 mt-6"
              >
                Authenticate & Drive
              </Button>
            </form>

            <p className="text-center text-slate-600 dark:text-slate-500 mt-6 text-sm">
              Vehicle linkage required for system access
            </p>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}

import { Card, CardContent, CardHeader } from "./ui/card";
import { AlertCircle, ExternalLink, Copy, Check } from "lucide-react";
import { Alert, AlertDescription } from "./ui/alert";
import { Button } from "./ui/button";
import { useState } from "react";

export function MapApiKeyRequired() {
  const [copied, setCopied] = useState(false);

  const handleCopy = () => {
    navigator.clipboard.writeText("https://developers.google.com/maps/documentation/javascript/get-api-key");
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  return (
    <div className="absolute inset-0 bg-slate-950 flex items-center justify-center p-4 z-50">
      <div className="max-w-2xl w-full space-y-4">
        <Alert className="bg-amber-500/10 border-amber-500/30 text-amber-400">
          <AlertCircle className="h-4 w-4" />
          <AlertDescription>
            Google Maps API key is required to display the map
          </AlertDescription>
        </Alert>

        <Card className="bg-slate-900/95 backdrop-blur-xl border-slate-700/50 shadow-2xl">
          <CardHeader>
            <h2 className="text-slate-100">Setup Google Maps API</h2>
            <p className="text-slate-400 text-sm">Follow these steps to enable the map view</p>
          </CardHeader>
          <CardContent className="space-y-6">
            <div className="space-y-4">
              {/* Step 1 */}
              <div className="space-y-2">
                <div className="flex items-center gap-2">
                  <div className="w-6 h-6 rounded-full bg-[#0070E1] flex items-center justify-center text-white text-sm">
                    1
                  </div>
                  <h3 className="text-slate-200">Get an API Key</h3>
                </div>
                <p className="text-slate-400 text-sm ml-8">
                  Visit Google Cloud Console to create a new API key
                </p>
                <div className="ml-8 flex gap-2">
                  <a
                    href="https://developers.google.com/maps/documentation/javascript/get-api-key"
                    target="_blank"
                    rel="noopener noreferrer"
                    className="inline-flex"
                  >
                    <Button className="bg-[#0070E1] hover:bg-[#0060C1] text-white">
                      <ExternalLink className="w-4 h-4 mr-2" />
                      Get API Key
                    </Button>
                  </a>
                  <Button
                    variant="outline"
                    onClick={handleCopy}
                    className="bg-slate-800/50 hover:bg-slate-700/50 text-slate-300 border-slate-700"
                  >
                    {copied ? (
                      <>
                        <Check className="w-4 h-4 mr-2" />
                        Copied!
                      </>
                    ) : (
                      <>
                        <Copy className="w-4 h-4 mr-2" />
                        Copy Link
                      </>
                    )}
                  </Button>
                </div>
              </div>

              {/* Step 2 */}
              <div className="space-y-2">
                <div className="flex items-center gap-2">
                  <div className="w-6 h-6 rounded-full bg-[#0070E1] flex items-center justify-center text-white text-sm">
                    2
                  </div>
                  <h3 className="text-slate-200">Enable Required APIs</h3>
                </div>
                <div className="ml-8 space-y-1">
                  <div className="flex items-center gap-2 text-slate-300 text-sm">
                    <div className="w-1.5 h-1.5 rounded-full bg-[#0070E1]" />
                    Maps JavaScript API
                  </div>
                  <div className="flex items-center gap-2 text-slate-300 text-sm">
                    <div className="w-1.5 h-1.5 rounded-full bg-[#0070E1]" />
                    Marker Library (included)
                  </div>
                  <div className="flex items-center gap-2 text-slate-400 text-sm">
                    <div className="w-1.5 h-1.5 rounded-full bg-slate-600" />
                    Geometry API (optional)
                  </div>
                </div>
              </div>

              {/* Step 3 */}
              <div className="space-y-2">
                <div className="flex items-center gap-2">
                  <div className="w-6 h-6 rounded-full bg-[#0070E1] flex items-center justify-center text-white text-sm">
                    3
                  </div>
                  <h3 className="text-slate-200">Update the Code</h3>
                </div>
                <p className="text-slate-400 text-sm ml-8">
                  Open <code className="bg-slate-800 px-1.5 py-0.5 rounded text-amber-400">/components/GoogleMapComponent.tsx</code>
                </p>
                <div className="ml-8 bg-slate-950/80 p-4 rounded-lg border border-slate-700/50 font-mono text-xs overflow-x-auto">
                  <p className="text-slate-500 mb-2">// Line ~119:</p>
                  <p className="text-slate-300">
                    script.src = `https://maps.googleapis.com/maps/api/js?key=
                    <span className="text-green-400">YOUR_ACTUAL_API_KEY</span>
                    &libraries=marker,geometry&loading=async`;
                  </p>
                </div>
                <p className="text-slate-500 text-xs ml-8 mt-2">
                  Replace <code className="bg-slate-800 px-1 py-0.5 rounded text-amber-400">YOUR_API_KEY_HERE</code> with your actual key
                </p>
              </div>
            </div>

            {/* Pricing Info */}
            <div className="pt-4 border-t border-slate-700/50">
              <Alert className="bg-blue-500/10 border-blue-500/30">
                <AlertCircle className="h-4 w-4 text-blue-400" />
                <AlertDescription className="text-slate-300 text-xs">
                  <strong className="text-blue-400">Free Tier Available:</strong> Google Maps Platform includes $200 monthly credit, 
                  covering ~28,000 map loads/month for most applications.
                </AlertDescription>
              </Alert>
            </div>

            {/* Help */}
            <div className="pt-2">
              <p className="text-slate-500 text-xs">
                Need help? Check the{" "}
                <a
                  href="/GOOGLE_MAPS_SETUP.md"
                  className="text-[#0070E1] hover:underline"
                >
                  detailed setup guide
                </a>
              </p>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}

// Mapbox GL Integration for Hazard Scout with Navigation & Real-time Warnings
import { useEffect, useRef, useState, useCallback } from 'react';
import mapboxgl from 'mapbox-gl';
import 'mapbox-gl/dist/mapbox-gl.css';
import { HazardData } from './HazardService';
import { getMarkerIcon, VehicleMarker } from './MapMarkerIcons';
import { createRoot } from 'react-dom/client';
import { Navigation, X, AlertTriangle, MapPin, Locate, Search, Route as RouteIcon } from 'lucide-react';
import { Button } from './ui/button';
import { Badge } from './ui/badge';
import { toast } from 'sonner';
import { Card, CardContent } from './ui/card';
import { Input } from './ui/input';

// Mapbox access token - REPLACE WITH YOUR ACTUAL TOKEN
// Get your token at: https://account.mapbox.com/access-tokens/
const MAPBOX_TOKEN = 'pk.eyJ1IjoiaGFyaXNzaCIsImEiOiJjbWhseDllNTkwaGIxMmlxa3FmM3VwbHl2In0.XUjNuUn7OSsR_35T2i6Frg';

interface MapboxMapProps {
  hazards: HazardData[];
  onHazardClick?: (hazard: HazardData) => void;
  viewMode?: 'widget' | 'fullscreen';
  className?: string;
  enableNavigation?: boolean;
  enableProximityWarnings?: boolean;
  onStartLiveNavigation?: (start: [number, number], dest: [number, number], destName: string) => void;
}

interface LocationSuggestion {
  id: string;
  place_name: string;
  center: [number, number];
}

// Calculate distance between two coordinates in meters
function calculateDistance(lat1: number, lon1: number, lat2: number, lon2: number): number {
  const R = 6371e3; // Earth's radius in meters
  const 1 = lat1 * Math.PI / 180;
  const 2 = lat2 * Math.PI / 180;
  const  = (lat2 - lat1) * Math.PI / 180;
  const  = (lon2 - lon1) * Math.PI / 180;

  const a = Math.sin( / 2) * Math.sin( / 2) +
    Math.cos(1) * Math.cos(2) *
    Math.sin( / 2) * Math.sin( / 2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

  return R * c; // Distance in meters
}

// Check if a point is near a route (within buffer distance)
function isPointNearRoute(
  point: [number, number],
  routeCoordinates: [number, number][],
  bufferMeters: number = 100
): boolean {
  for (const routePoint of routeCoordinates) {
    const distance = calculateDistance(
      point[1], point[0],
      routePoint[1], routePoint[0]
    );
    if (distance <= bufferMeters) {
      return true;
    }
  }
  return false;
}

export function MapboxMap({ 
  hazards, 
  onHazardClick, 
  viewMode = 'fullscreen',
  className = '',
  enableNavigation = true,
  enableProximityWarnings = true,
  onStartLiveNavigation
}: MapboxMapProps) {
  const mapContainer = useRef<HTMLDivElement>(null);
  const map = useRef<mapboxgl.Map | null>(null);
  const [useFallback, setUseFallback] = useState(false);
  const markersRef = useRef<mapboxgl.Marker[]>([])
  const [userLocation, setUserLocation] = useState<[number, number] | null>(null);
  const [navigationRoute, setNavigationRoute] = useState<any>(null);
  const [navigationDestination, setNavigationDestination] = useState<HazardData | null>(null);
  const [warningHazards, setWarningHazards] = useState<Set<string>>(new Set());
  const routeSourceId = useRef<string>('route');
  
  // Location search states
  const [startLocation, setStartLocation] = useState<string>('');
  const [destinationLocation, setDestinationLocation] = useState<string>('');
  const [startCoords, setStartCoords] = useState<[number, number] | null>(null);
  const [destCoords, setDestCoords] = useState<[number, number] | null>(null);
  const [startSuggestions, setStartSuggestions] = useState<LocationSuggestion[]>([]);
  const [destSuggestions, setDestSuggestions] = useState<LocationSuggestion[]>([]);
  const [showStartSuggestions, setShowStartSuggestions] = useState(false);
  const [showDestSuggestions, setShowDestSuggestions] = useState(false);
  const [isSearchingRoute, setIsSearchingRoute] = useState(false);
  const [routeHazards, setRouteHazards] = useState<HazardData[]>([]);
  
  // Default center (Delhi coordinates)
  const defaultCenter: [number, number] = [77.2090, 28.6139];
  
  // Check if we have a valid Mapbox token
  const hasValidToken = MAPBOX_TOKEN && 
    MAPBOX_TOKEN !== 'YOUR_MAPBOX_TOKEN_HERE' && 
    !MAPBOX_TOKEN.includes('example') &&
    (MAPBOX_TOKEN.startsWith('pk.') || MAPBOX_TOKEN.startsWith('sk.'));
  
  // Get user's current location
  useEffect(() => {
    if ('geolocation' in navigator) {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          const userPos: [number, number] = [
            position.coords.longitude, 
            position.coords.latitude
          ];
          setUserLocation(userPos);
          setStartCoords(userPos);
          setStartLocation('Current Location');
        },
        (error) => {
          console.log('Geolocation not available, using default location');
        }
      );

      // Watch position for real-time updates
      const watchId = navigator.geolocation.watchPosition(
        (position) => {
          const userPos: [number, number] = [
            position.coords.longitude, 
            position.coords.latitude
          ];
          setUserLocation(userPos);
          // Update start coords if still using current location
          if (startLocation === 'Current Location') {
            setStartCoords(userPos);
          }
        }
      );

      return () => navigator.geolocation.clearWatch(watchId);
    }
  }, [startLocation]);

  // Geocoding: Search for location using Mapbox Geocoding API
  const searchLocation = useCallback(async (query: string, isStart: boolean) => {
    if (!query || query.length < 3 || !hasValidToken) return;

    try {
      const response = await fetch(
        `https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(query)}.json?access_token=${MAPBOX_TOKEN}&limit=5`
      );
      const data = await response.json();
      
      if (data.features) {
        const suggestions: LocationSuggestion[] = data.features.map((feature: any) => ({
          id: feature.id,
          place_name: feature.place_name,
          center: feature.center
        }));
        
        if (isStart) {
          setStartSuggestions(suggestions);
          setShowStartSuggestions(true);
        } else {
          setDestSuggestions(suggestions);
          setShowDestSuggestions(true);
        }
      }
    } catch (error) {
      console.error('Geocoding error:', error);
    }
  }, [hasValidToken]);

  // Debounced search for start location
  useEffect(() => {
    if (startLocation && startLocation !== 'Current Location') {
      const timer = setTimeout(() => {
        searchLocation(startLocation, true);
      }, 500);
      return () => clearTimeout(timer);
    }
  }, [startLocation, searchLocation]);

  // Debounced search for destination
  useEffect(() => {
    if (destinationLocation) {
      const timer = setTimeout(() => {
        searchLocation(destinationLocation, false);
      }, 500);
      return () => clearTimeout(timer);
    }
  }, [destinationLocation, searchLocation]);

  // Use current location as start
  const useCurrentLocation = useCallback(() => {
    if (userLocation) {
      setStartCoords(userLocation);
      setStartLocation('Current Location');
      setShowStartSuggestions(false);
      toast.success('Using current location');
    } else {
      toast.error('Location not available. Please enable location services.');
    }
  }, [userLocation]);

  // Select suggestion
  const selectSuggestion = useCallback((suggestion: LocationSuggestion, isStart: boolean) => {
    if (isStart) {
      setStartLocation(suggestion.place_name);
      setStartCoords(suggestion.center);
      setShowStartSuggestions(false);
    } else {
      setDestinationLocation(suggestion.place_name);
      setDestCoords(suggestion.center);
      setShowDestSuggestions(false);
    }
  }, []);

  // Fetch route between start and destination
  const fetchRouteWithHazards = useCallback(async () => {
    if (!startCoords || !destCoords || !hasValidToken) {
      if (!startCoords) toast.error('Please select a start location');
      if (!destCoords) toast.error('Please select a destination');
      return;
    }

    setIsSearchingRoute(true);
    
    try {
      const query = await fetch(
        `https://api.mapbox.com/directions/v5/mapbox/driving/${startCoords[0]},${startCoords[1]};${destCoords[0]},${destCoords[1]}?geometries=geojson&access_token=${MAPBOX_TOKEN}`,
        { method: 'GET' }
      );
      const json = await query.json();
      
      if (json.routes && json.routes.length > 0) {
        const route = json.routes[0];
        
        // If onStartLiveNavigation is provided, start live navigation instead of showing route preview
        if (onStartLiveNavigation) {
          onStartLiveNavigation(startCoords, destCoords, destinationLocation);
          setIsSearchingRoute(false);
          return;
        }
        
        setNavigationRoute(route);
        
        // Find hazards along the route
        const routeCoordinates = route.geometry.coordinates;
        const hazardsOnRoute = hazards.filter(hazard => 
          isPointNearRoute(
            [hazard.location.longitude, hazard.location.latitude],
            routeCoordinates,
            100 // 100m buffer
          )
        );
        
        setRouteHazards(hazardsOnRoute);
        
        // Show route info
        const distance = (route.distance / 1000).toFixed(1);
        const duration = Math.round(route.duration / 60);
        const hazardCount = hazardsOnRoute.length;
        
        toast.success(`Route found: ${distance} km, ${duration} min`, {
          description: hazardCount > 0 
            ? ` ${hazardCount} hazard${hazardCount > 1 ? 's' : ''} detected on route`
            : ' No hazards detected on route',
          duration: 5000,
        });

        // Fit map to show the entire route
        if (map.current) {
          const coordinates = routeCoordinates;
          const bounds = coordinates.reduce((bounds: any, coord: any) => {
            return bounds.extend(coord);
          }, new mapboxgl.LngLatBounds(coordinates[0], coordinates[0]));
          
          map.current.fitBounds(bounds, {
            padding: { top: 100, bottom: 100, left: 50, right: 50 }
          });
        }
      }
    } catch (error) {
      console.error('Error fetching route:', error);
      toast.error('Unable to calculate route');
    } finally {
      setIsSearchingRoute(false);
    }
  }, [startCoords, destCoords, hasValidToken, hazards, onStartLiveNavigation, destinationLocation]);

  // Check proximity to hazards and show warnings
  useEffect(() => {
    if (!enableProximityWarnings || !userLocation) return;

    const checkProximity = () => {
      hazards.forEach(hazard => {
        const distance = calculateDistance(
          userLocation[1], // latitude
          userLocation[0], // longitude
          hazard.location.latitude,
          hazard.location.longitude
        );

        // Warn if within 500 meters and haven't warned yet
        if (distance < 500 && !warningHazards.has(hazard.id)) {
          setWarningHazards(prev => new Set(prev).add(hazard.id));
          
          // Show warning toast
          toast.warning(`Hazard Ahead: ${hazard.type}`, {
            description: `${Math.round(distance)}m ahead - ${hazard.locationName}`,
            duration: 5000,
            action: {
              label: 'View',
              onClick: () => onHazardClick?.(hazard),
            },
          });
        } else if (distance > 1000 && warningHazards.has(hazard.id)) {
          // Remove from warned set if moved far away
          setWarningHazards(prev => {
            const newSet = new Set(prev);
            newSet.delete(hazard.id);
            return newSet;
          });
        }
      });
    };

    checkProximity();
    const interval = setInterval(checkProximity, 10000); // Check every 10 seconds

    return () => clearInterval(interval);
  }, [userLocation, hazards, enableProximityWarnings, warningHazards, onHazardClick]);

  // Handle navigation to hazard
  const navigateToHazard = useCallback((hazard: HazardData) => {
    const destination: [number, number] = [hazard.location.longitude, hazard.location.latitude];
    setNavigationDestination(hazard);
    setDestCoords(destination);
    setDestinationLocation(hazard.locationName);
    
    if (startCoords) {
      fetchRouteWithHazards();
    }
  }, [startCoords, fetchRouteWithHazards]);

  // Clear navigation
  const clearNavigation = useCallback(() => {
    setNavigationRoute(null);
    setNavigationDestination(null);
    setRouteHazards([]);
    setStartLocation('');
    setDestinationLocation('');
    setStartCoords(null);
    setDestCoords(null);
    
    // Remove route layer from map
    if (map.current && map.current.getLayer('route')) {
      map.current.removeLayer('route');
    }
    if (map.current && map.current.getSource(routeSourceId.current)) {
      map.current.removeSource(routeSourceId.current);
    }
    
    toast.info('Navigation cleared');
  }, []);

  // Initialize Mapbox
  useEffect(() => {
    // If no valid token, use fallback immediately
    if (!hasValidToken) {
      setUseFallback(true);
      console.warn(' Valid Mapbox token required. Please add your token to enable real-time maps.');
      return;
    }

    if (!mapContainer.current) return;

    // Initialize map with valid token
    mapboxgl.accessToken = MAPBOX_TOKEN;
    
    try {
      const center = userLocation || defaultCenter;
      
      map.current = new mapboxgl.Map({
        container: mapContainer.current,
        style: 'mapbox://styles/mapbox/dark-v11',
        center: center,
        zoom: viewMode === 'widget' ? 12 : 13,
        pitch: viewMode === 'fullscreen' ? 45 : 0,
        bearing: 0,
        attributionControl: false,
      });

      // Add navigation controls for fullscreen mode
      if (viewMode === 'fullscreen') {
        map.current.addControl(new mapboxgl.NavigationControl(), 'top-right');
        
        // Add geolocate control only if geolocation is actually working
        if ('geolocation' in navigator) {
          // Test if geolocation actually works before adding control
          navigator.geolocation.getCurrentPosition(
            () => {
              // Geolocation works, add the control with warning suppression
              const originalWarn = console.warn;
              const originalError = console.error;
              
              // Suppress Mapbox geolocation warnings
              console.warn = (...args: any[]) => {
                const message = args[0]?.toString() || '';
                if (!message.includes('Geolocation') && !message.includes('geolocation')) {
                  originalWarn.apply(console, args);
                }
              };
              console.error = (...args: any[]) => {
                const message = args[0]?.toString() || '';
                if (!message.includes('Geolocation') && !message.includes('geolocation')) {
                  originalError.apply(console, args);
                }
              };
              
              try {
                if (map.current) {
                  const geolocateControl = new mapboxgl.GeolocateControl({
                    positionOptions: {
                      enableHighAccuracy: true
                    },
                    trackUserLocation: true,
                    showUserHeading: true
                  });
                  map.current.addControl(geolocateControl, 'top-right');
                }
              } catch (error) {
                // Silently handle any errors
              }
              
              // Keep suppression active for 1 second to catch async warnings
              setTimeout(() => {
                console.warn = originalWarn;
                console.error = originalError;
              }, 1000);
            },
            () => {
              // Geolocation not available or denied, skip the control silently
            },
            { timeout: 5000 }
          );
        }
      }

      // Disable map interactions for widget mode
      if (viewMode === 'widget') {
        map.current.scrollZoom.disable();
        map.current.boxZoom.disable();
        map.current.dragRotate.disable();
        map.current.dragPan.disable();
        map.current.keyboard.disable();
        map.current.doubleClickZoom.disable();
        map.current.touchZoomRotate.disable();
      }

      // Handle errors - fall back to static map
      map.current.on('error', () => {
        setUseFallback(true);
      });

    } catch (error) {
      console.error('Error initializing Mapbox:', error);
      setUseFallback(true);
    }

    return () => {
      if (map.current) {
        map.current.remove();
      }
    };
  }, [viewMode, hasValidToken]);

  // Update map center when user location changes
  useEffect(() => {
    if (map.current && userLocation && !useFallback && !navigationRoute) {
      map.current.flyTo({
        center: userLocation,
        zoom: 14,
        duration: 1500
      });
    }
  }, [userLocation, useFallback, navigationRoute]);

  // Update navigation route on map
  useEffect(() => {
    if (!map.current || !navigationRoute || useFallback) return;

    map.current.on('load', () => {
      if (!map.current) return;

      // Remove existing route if any
      if (map.current.getLayer('route')) {
        map.current.removeLayer('route');
      }
      if (map.current.getSource(routeSourceId.current)) {
        map.current.removeSource(routeSourceId.current);
      }

      // Add route source
      map.current.addSource(routeSourceId.current, {
        type: 'geojson',
        data: {
          type: 'Feature',
          properties: {},
          geometry: navigationRoute.geometry
        }
      });

      // Add route layer
      map.current.addLayer({
        id: 'route',
        type: 'line',
        source: routeSourceId.current,
        layout: {
          'line-join': 'round',
          'line-cap': 'round'
        },
        paint: {
          'line-color': '#0070E1',
          'line-width': 5,
          'line-opacity': 0.8
        }
      });
    });

    // If map already loaded, add route immediately
    if (map.current.isStyleLoaded()) {
      // Remove existing route if any
      if (map.current.getLayer('route')) {
        map.current.removeLayer('route');
      }
      if (map.current.getSource(routeSourceId.current)) {
        map.current.removeSource(routeSourceId.current);
      }

      // Add route source
      map.current.addSource(routeSourceId.current, {
        type: 'geojson',
        data: {
          type: 'Feature',
          properties: {},
          geometry: navigationRoute.geometry
        }
      });

      // Add route layer
      map.current.addLayer({
        id: 'route',
        type: 'line',
        source: routeSourceId.current,
        layout: {
          'line-join': 'round',
          'line-cap': 'round'
        },
        paint: {
          'line-color': '#0070E1',
          'line-width': 5,
          'line-opacity': 0.8
        }
      });
    }
  }, [navigationRoute, useFallback]);

  // Update markers when hazards change
  useEffect(() => {
    if (!map.current || useFallback) return;

    // Remove old markers
    markersRef.current.forEach(marker => marker.remove());
    markersRef.current = [];

    const center = userLocation || defaultCenter;

    // Add user location marker
    if (userLocation) {
      const vehicleEl = document.createElement('div');
      const vehicleRoot = createRoot(vehicleEl);
      vehicleRoot.render(<VehicleMarker className="w-8 h-8" />);
      
      try {
        const vehicleMarker = new mapboxgl.Marker({ 
          element: vehicleEl, 
          anchor: 'center',
          rotationAlignment: 'map'
        })
          .setLngLat(userLocation)
          .addTo(map.current);
        markersRef.current.push(vehicleMarker);
      } catch (error) {
        console.error('Error adding vehicle marker:', error);
      }
    }

    // Add destination marker if exists
    if (destCoords && !navigationDestination) {
      const destEl = document.createElement('div');
      destEl.className = 'w-8 h-8 bg-[#0070E1] rounded-full border-4 border-white shadow-lg';
      
      try {
        const destMarker = new mapboxgl.Marker({ 
          element: destEl, 
          anchor: 'center'
        })
          .setLngLat(destCoords)
          .addTo(map.current);
        markersRef.current.push(destMarker);
      } catch (error) {
        console.error('Error adding destination marker:', error);
      }
    }

    // Add hazard markers
    hazards.forEach((hazard, index) => {
      const el = document.createElement('div');
      el.className = 'hazard-marker cursor-pointer hover:scale-110 transition-transform';
      
      const root = createRoot(el);
      const MarkerComponent = getMarkerComponent(hazard);
      
      // Check if hazard is on route
      const isOnRoute = routeHazards.some(h => h.id === hazard.id);
      
      // Pulse animation for nearby hazards or hazards on route
      const distance = userLocation ? calculateDistance(
        userLocation[1],
        userLocation[0],
        hazard.location.latitude,
        hazard.location.longitude
      ) : Infinity;
      
      const isNearby = distance < 500;
      
      root.render(
        <div className={isNearby || isOnRoute ? 'animate-pulse' : ''}>
          {isOnRoute && (
            <div className="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border border-white"></div>
          )}
          <MarkerComponent className={viewMode === 'widget' ? 'w-4 h-4' : 'w-8 h-8'} />
        </div>
      );

      // Add click handler
      el.addEventListener('click', () => {
        if (onHazardClick) {
          onHazardClick(hazard);
        }
      });

      try {
        const marker = new mapboxgl.Marker({ element: el, anchor: 'center' })
          .setLngLat([hazard.location.longitude, hazard.location.latitude])
          .addTo(map.current!);
        
        markersRef.current.push(marker);
      } catch (error) {
        console.error('Error adding hazard marker:', error);
      }
    });

  }, [hazards, useFallback, onHazardClick, viewMode, userLocation, destCoords, navigationDestination, routeHazards]);

  // Fallback static map view (shown when Mapbox isn't available)
  const FallbackMap = () => (
    <div className="w-full h-full bg-gradient-to-br from-slate-800 to-slate-900 relative overflow-hidden">
      {/* Grid pattern */}
      <div className="absolute inset-0 opacity-20 bg-[linear-gradient(rgba(0,112,225,0.1)_1px,transparent_1px),linear-gradient(90deg,rgba(0,112,225,0.1)_1px,transparent_1px)] bg-[size:30px_30px]" />
      
      {/* Simulated road network */}
      <svg className="absolute inset-0 w-full h-full opacity-30">
        <line x1="0" y1="40%" x2="100%" y2="40%" stroke="#475569" strokeWidth="2" />
        <line x1="0" y1="60%" x2="100%" y2="60%" stroke="#475569" strokeWidth="2" />
        <line x1="30%" y1="0" x2="30%" y2="100%" stroke="#475569" strokeWidth="2" />
        <line x1="70%" y1="0" x2="70%" y2="100%" stroke="#475569" strokeWidth="2" />
      </svg>

      {/* Vehicle marker at center */}
      <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none">
        <VehicleMarker className={viewMode === 'widget' ? 'w-6 h-6' : 'w-10 h-10'} />
      </div>

      {/* Hazard markers */}
      {hazards.slice(0, viewMode === 'widget' ? 3 : 10).map((hazard, index) => {
        const MarkerComponent = getMarkerComponent(hazard);
        // Position hazards in a circle around the vehicle
        const angle = (index / Math.min(hazards.length, 10)) * Math.PI * 2;
        const radius = viewMode === 'widget' ? 35 : 30;
        const x = 50 + radius * Math.cos(angle);
        const y = 50 + radius * Math.sin(angle);
        
        return (
          <div
            key={hazard.id}
            onClick={(e) => {
              if (viewMode === 'fullscreen' && onHazardClick) {
                e.stopPropagation();
                onHazardClick(hazard);
              }
            }}
            className={`absolute transition-transform ${
              viewMode === 'fullscreen' ? 'hover:scale-110 cursor-pointer' : 'pointer-events-none'
            }`}
            style={{
              left: `${x}%`,
              top: `${y}%`,
              transform: 'translate(-50%, -50%)'
            }}
          >
            <MarkerComponent className={viewMode === 'widget' ? 'w-5 h-5' : 'w-8 h-8'} />
          </div>
        );
      })}

      {/* Distance circles */}
      <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-32 h-32 sm:w-48 sm:h-48 border border-[#0070E1]/20 rounded-full pointer-events-none"></div>
      <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-48 h-48 sm:w-72 sm:h-72 border border-[#0070E1]/10 rounded-full pointer-events-none"></div>
    </div>
  );

  return (
    <div className={`relative ${className}`}>
      {useFallback ? (
        <FallbackMap />
      ) : (
        <>
          {/* Location Search Panel - Only show in fullscreen mode */}
          {viewMode === 'fullscreen' && (
            <div className="absolute top-4 left-4 right-4 z-40">
              <Card className="bg-white/95 dark:bg-slate-900/95 backdrop-blur-lg border-[#0070E1]/30">
                <CardContent className="p-4">
                  <div className="space-y-3">
                    {/* Start Location */}
                    <div className="relative">
                      <div className="flex items-center gap-2">
                        <MapPin className="w-5 h-5 text-[#0070E1] flex-shrink-0" />
                        <Input
                          placeholder="Start location"
                          value={startLocation}
                          onChange={(e) => setStartLocation(e.target.value)}
                          onFocus={() => setShowStartSuggestions(true)}
                          className="flex-1 bg-white dark:bg-slate-800 border-slate-300 dark:border-slate-700"
                        />
                        <Button
                          onClick={useCurrentLocation}
                          variant="outline"
                          size="sm"
                          className="flex-shrink-0"
                        >
                          <Locate className="w-4 h-4" />
                        </Button>
                      </div>
                      
                      {/* Start Suggestions */}
                      {showStartSuggestions && startSuggestions.length > 0 && (
                        <div className="absolute top-full left-0 right-0 mt-1 bg-white dark:bg-slate-800 rounded-lg shadow-lg border border-slate-200 dark:border-slate-700 max-h-48 overflow-y-auto z-50">
                          {startSuggestions.map((suggestion) => (
                            <button
                              key={suggestion.id}
                              onClick={() => selectSuggestion(suggestion, true)}
                              className="w-full px-4 py-2 text-left hover:bg-slate-100 dark:hover:bg-slate-700 text-sm text-[#1F2F57] dark:text-slate-200"
                            >
                              {suggestion.place_name}
                            </button>
                          ))}
                        </div>
                      )}
                    </div>

                    {/* Destination Location */}
                    <div className="relative">
                      <div className="flex items-center gap-2">
                        <MapPin className="w-5 h-5 text-red-500 flex-shrink-0" />
                        <Input
                          placeholder="Destination"
                          value={destinationLocation}
                          onChange={(e) => setDestinationLocation(e.target.value)}
                          onFocus={() => setShowDestSuggestions(true)}
                          className="flex-1 bg-white dark:bg-slate-800 border-slate-300 dark:border-slate-700"
                        />
                        <Button
                          onClick={fetchRouteWithHazards}
                          disabled={!startCoords || !destCoords || isSearchingRoute}
                          className="flex-shrink-0 bg-[#0070E1] hover:bg-[#0070E1]/90"
                        >
                          <RouteIcon className="w-4 h-4 mr-2" />
                          {isSearchingRoute ? 'Finding...' : 'Go'}
                        </Button>
                      </div>
                      
                      {/* Destination Suggestions */}
                      {showDestSuggestions && destSuggestions.length > 0 && (
                        <div className="absolute top-full left-0 right-0 mt-1 bg-white dark:bg-slate-800 rounded-lg shadow-lg border border-slate-200 dark:border-slate-700 max-h-48 overflow-y-auto z-50">
                          {destSuggestions.map((suggestion) => (
                            <button
                              key={suggestion.id}
                              onClick={() => selectSuggestion(suggestion, false)}
                              className="w-full px-4 py-2 text-left hover:bg-slate-100 dark:hover:bg-slate-700 text-sm text-[#1F2F57] dark:text-slate-200"
                            >
                              {suggestion.place_name}
                            </button>
                          ))}
                        </div>
                      )}
                    </div>
                  </div>
                </CardContent>
              </Card>
            </div>
          )}

          <div ref={mapContainer} className="w-full h-full" />
          
          {/* Route Info Banner */}
          {navigationRoute && (
            <div className={`absolute ${viewMode === 'fullscreen' ? 'top-44' : 'top-4'} left-4 right-4 z-30`}>
              <Card className="bg-white/95 dark:bg-slate-900/95 backdrop-blur-lg border-[#0070E1]/50">
                <CardContent className="p-3">
                  <div className="flex items-center justify-between gap-3">
                    <div className="flex items-center gap-3 flex-1 min-w-0">
                      <div className="w-10 h-10 rounded-full bg-[#0070E1]/20 flex items-center justify-center flex-shrink-0">
                        <Navigation className="w-5 h-5 text-[#0070E1]" />
                      </div>
                      <div className="flex-1 min-w-0">
                        <p className="text-[#1F2F57] dark:text-slate-200 text-sm mb-0.5 truncate">
                          {navigationRoute.distance ? `${(navigationRoute.distance / 1000).toFixed(1)} km` : ''} 
                          {navigationRoute.duration ? `  ${Math.round(navigationRoute.duration / 60)} min` : ''}
                        </p>
                        <p className="text-[#9394a5] dark:text-slate-400 text-xs truncate">
                          {routeHazards.length > 0 ? (
                            <span className="text-amber-500">
                               {routeHazards.length} hazard{routeHazards.length > 1 ? 's' : ''} on route
                            </span>
                          ) : (
                            <span className="text-green-500"> No hazards detected</span>
                          )}
                        </p>
                      </div>
                    </div>
                    <Button
                      onClick={clearNavigation}
                      variant="ghost"
                      size="sm"
                      className="flex-shrink-0 h-8 w-8 p-0"
                    >
                      <X className="w-4 h-4" />
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </div>
          )}

          {/* Token Setup Warning */}
          {!hasValidToken && (
            <div className="absolute bottom-4 left-4 right-4 z-30">
              <Card className="bg-amber-500/10 border-amber-500/30">
                <CardContent className="p-3">
                  <div className="flex items-start gap-2">
                    <AlertTriangle className="w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5" />
                    <div className="flex-1">
                      <p className="text-amber-400 text-xs mb-1">Mapbox Token Required</p>
                      <p className="text-[#9394a5] dark:text-slate-400 text-[10px] leading-relaxed">
                        Add your Mapbox token to enable real-time maps, navigation, and proximity warnings. See MAPBOX_SETUP_GUIDE.md for instructions.
                      </p>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </div>
          )}
        </>
      )}
    </div>
  );
}

function getMarkerComponent(hazard: HazardData) {
  return getMarkerIcon(hazard.severity, hazard.source, hazard.status);
}
// Map Legend Component - Explains marker shapes and colors
import { Card, CardContent } from "./ui/card";
import { 
  V2XMarkerHigh, 
  V2XMarkerMedium, 
  V2XMarkerLow,
  YourCarMarkerHigh,
  YourCarMarkerMedium,
  YourCarMarkerLow,
  NetworkMarkerHigh,
  NetworkMarkerMedium,
  NetworkMarkerLow
} from "./MapMarkerIcons";

interface MapLegendProps {
  compact?: boolean;
}

export function MapLegend({ compact = false }: MapLegendProps) {
  if (compact) {
    return (
      <Card className="bg-slate-900/95 border-slate-700/50 backdrop-blur-sm">
        <CardContent className="p-3">
          <div className="space-y-2">
            <div className="flex items-center justify-between">
              <span className="text-slate-300 text-xs">Sources:</span>
              <div className="flex items-center gap-2">
                <div className="flex items-center gap-1">
                  <V2XMarkerMedium className="w-4 h-4" />
                  <span className="text-slate-400 text-xs">V2X</span>
                </div>
                <div className="flex items-center gap-1">
                  <YourCarMarkerMedium className="w-4 h-4" />
                  <span className="text-slate-400 text-xs">Your Car</span>
                </div>
                <div className="flex items-center gap-1">
                  <NetworkMarkerMedium className="w-4 h-4" />
                  <span className="text-slate-400 text-xs">Network</span>
                </div>
              </div>
            </div>
            <div className="flex items-center justify-between">
              <span className="text-slate-300 text-xs">Severity:</span>
              <div className="flex items-center gap-2">
                <div className="flex items-center gap-1">
                  <div className="w-3 h-3 rounded-sm bg-red-600"></div>
                  <span className="text-slate-400 text-xs">High</span>
                </div>
                <div className="flex items-center gap-1">
                  <div className="w-3 h-3 rounded-sm bg-amber-500"></div>
                  <span className="text-slate-400 text-xs">Med</span>
                </div>
                <div className="flex items-center gap-1">
                  <div className="w-3 h-3 rounded-sm bg-yellow-500"></div>
                  <span className="text-slate-400 text-xs">Low</span>
                </div>
              </div>
            </div>
          </div>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card className="bg-slate-900/95 border-slate-700/50 backdrop-blur-sm">
      <CardContent className="p-4">
        <h3 className="text-slate-200 text-sm mb-3">Map Legend</h3>
        
        {/* Source Types */}
        <div className="mb-4">
          <p className="text-slate-400 text-xs mb-2">Hazard Sources (Shapes)</p>
          <div className="space-y-2">
            <div className="flex items-center gap-2">
              <V2XMarkerMedium className="w-5 h-5 flex-shrink-0" />
              <div>
                <p className="text-slate-200 text-xs">Square - V2X</p>
                <p className="text-slate-500 text-[10px]">Infrastructure systems</p>
              </div>
            </div>
            <div className="flex items-center gap-2">
              <YourCarMarkerMedium className="w-5 h-5 flex-shrink-0" />
              <div>
                <p className="text-slate-200 text-xs">Circle - Your Car</p>
                <p className="text-slate-500 text-[10px]">Your vehicle sensors</p>
              </div>
            </div>
            <div className="flex items-center gap-2">
              <NetworkMarkerMedium className="w-5 h-5 flex-shrink-0" />
              <div>
                <p className="text-slate-200 text-xs">Triangle - Network</p>
                <p className="text-slate-500 text-[10px]">Other VW vehicles</p>
              </div>
            </div>
          </div>
        </div>

        {/* Severity Levels */}
        <div>
          <p className="text-slate-400 text-xs mb-2">Severity Levels (Colors)</p>
          <div className="space-y-2">
            <div className="flex items-center gap-2">
              <div className="flex gap-1 flex-shrink-0">
                <V2XMarkerHigh className="w-4 h-4" />
                <YourCarMarkerHigh className="w-4 h-4" />
                <NetworkMarkerHigh className="w-4 h-4" />
              </div>
              <div>
                <p className="text-slate-200 text-xs">Red - High Severity</p>
                <p className="text-slate-500 text-[10px]">Immediate attention needed</p>
              </div>
            </div>
            <div className="flex items-center gap-2">
              <div className="flex gap-1 flex-shrink-0">
                <V2XMarkerMedium className="w-4 h-4" />
                <YourCarMarkerMedium className="w-4 h-4" />
                <NetworkMarkerMedium className="w-4 h-4" />
              </div>
              <div>
                <p className="text-slate-200 text-xs">Amber - Medium Severity</p>
                <p className="text-slate-500 text-[10px]">Exercise caution</p>
              </div>
            </div>
            <div className="flex items-center gap-2">
              <div className="flex gap-1 flex-shrink-0">
                <V2XMarkerLow className="w-4 h-4" />
                <YourCarMarkerLow className="w-4 h-4" />
                <NetworkMarkerLow className="w-4 h-4" />
              </div>
              <div>
                <p className="text-slate-200 text-xs">Yellow - Low Severity</p>
                <p className="text-slate-500 text-[10px]">Minor awareness</p>
              </div>
            </div>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}

// Custom Map Marker Icons for Hazard Types
// Shapes represent source, colors represent severity
import React from 'react';

interface MapMarkerProps {
  className?: string;
}

// Color palette based on severity
const SEVERITY_COLORS = {
  high: {
    fill: '#DC2626',      // Red
    stroke: '#991B1B',
    shadow: '#DC2626'
  },
  medium: {
    fill: '#F59E0B',      // Amber/Orange
    stroke: '#D97706',
    shadow: '#F59E0B'
  },
  low: {
    fill: '#EAB308',      // Yellow
    stroke: '#CA8A04',
    shadow: '#EAB308'
  },
  resolving: {
    fill: '#94A3B8',      // Grey
    stroke: '#64748B',
    shadow: '#94A3B8'
  }
};

// ==================== SQUARE MARKERS (V2X Source) ====================

export function V2XMarkerHigh({ className = "w-8 h-8" }: MapMarkerProps) {
  return (
    <svg 
      viewBox="0 0 40 40" 
      fill="none" 
      xmlns="http://www.w3.org/2000/svg"
      className={className}
    >
      {/* Pulse effect */}
      <rect
        x="6"
        y="6"
        width="28"
        height="28"
        fill="none"
        stroke={SEVERITY_COLORS.high.shadow}
        strokeWidth="1"
        opacity="0.5"
      >
        <animate
          attributeName="width"
          from="28"
          to="36"
          dur="1.5s"
          repeatCount="indefinite"
        />
        <animate
          attributeName="height"
          from="28"
          to="36"
          dur="1.5s"
          repeatCount="indefinite"
        />
        <animate
          attributeName="x"
          from="6"
          to="2"
          dur="1.5s"
          repeatCount="indefinite"
        />
        <animate
          attributeName="y"
          from="6"
          to="2"
          dur="1.5s"
          repeatCount="indefinite"
        />
        <animate
          attributeName="opacity"
          from="0.5"
          to="0"
          dur="1.5s"
          repeatCount="indefinite"
        />
      </rect>
      {/* Square shape */}
      <rect
        x="8"
        y="8"
        width="24"
        height="24"
        fill={SEVERITY_COLORS.high.fill}
        stroke={SEVERITY_COLORS.high.stroke}
        strokeWidth="2"
        rx="2"
      />
      {/* Warning icon */}
      <path
        d="M20 14V22M20 25V26"
        stroke="white"
        strokeWidth="2.5"
        strokeLinecap="round"
      />
    </svg>
  );
}

export function V2XMarkerMedium({ className = "w-8 h-8" }: MapMarkerProps) {
  return (
    <svg 
      viewBox="0 0 40 40" 
      fill="none" 
      xmlns="http://www.w3.org/2000/svg"
      className={className}
    >
      <rect
        x="8"
        y="8"
        width="24"
        height="24"
        fill={SEVERITY_COLORS.medium.fill}
        stroke={SEVERITY_COLORS.medium.stroke}
        strokeWidth="2"
        rx="2"
      />
      <path
        d="M20 14V22M20 25V26"
        stroke="white"
        strokeWidth="2.5"
        strokeLinecap="round"
      />
    </svg>
  );
}

export function V2XMarkerLow({ className = "w-8 h-8" }: MapMarkerProps) {
  return (
    <svg 
      viewBox="0 0 40 40" 
      fill="none" 
      xmlns="http://www.w3.org/2000/svg"
      className={className}
    >
      <rect
        x="8"
        y="8"
        width="24"
        height="24"
        fill={SEVERITY_COLORS.low.fill}
        stroke={SEVERITY_COLORS.low.stroke}
        strokeWidth="2"
        rx="2"
      />
      <path
        d="M20 14V22M20 25V26"
        stroke="white"
        strokeWidth="2.5"
        strokeLinecap="round"
      />
    </svg>
  );
}

// ==================== CIRCLE MARKERS (Your Car Source) ====================

export function YourCarMarkerHigh({ className = "w-8 h-8" }: MapMarkerProps) {
  return (
    <svg 
      viewBox="0 0 40 40" 
      fill="none" 
      xmlns="http://www.w3.org/2000/svg"
      className={className}
    >
      {/* Pulse effect */}
      <circle
        cx="20"
        cy="20"
        r="14"
        stroke={SEVERITY_COLORS.high.shadow}
        strokeWidth="1"
        fill="none"
        opacity="0.5"
      >
        <animate
          attributeName="r"
          from="14"
          to="20"
          dur="1.5s"
          repeatCount="indefinite"
        />
        <animate
          attributeName="opacity"
          from="0.5"
          to="0"
          dur="1.5s"
          repeatCount="indefinite"
        />
      </circle>
      {/* Circle shape */}
      <circle
        cx="20"
        cy="20"
        r="12"
        fill={SEVERITY_COLORS.high.fill}
        stroke={SEVERITY_COLORS.high.stroke}
        strokeWidth="2"
      />
      {/* Warning icon */}
      <path
        d="M20 14V22M20 25V26"
        stroke="white"
        strokeWidth="2.5"
        strokeLinecap="round"
      />
    </svg>
  );
}

export function YourCarMarkerMedium({ className = "w-8 h-8" }: MapMarkerProps) {
  return (
    <svg 
      viewBox="0 0 40 40" 
      fill="none" 
      xmlns="http://www.w3.org/2000/svg"
      className={className}
    >
      <circle
        cx="20"
        cy="20"
        r="12"
        fill={SEVERITY_COLORS.medium.fill}
        stroke={SEVERITY_COLORS.medium.stroke}
        strokeWidth="2"
      />
      <path
        d="M20 14V22M20 25V26"
        stroke="white"
        strokeWidth="2.5"
        strokeLinecap="round"
      />
    </svg>
  );
}

export function YourCarMarkerLow({ className = "w-8 h-8" }: MapMarkerProps) {
  return (
    <svg 
      viewBox="0 0 40 40" 
      fill="none" 
      xmlns="http://www.w3.org/2000/svg"
      className={className}
    >
      <circle
        cx="20"
        cy="20"
        r="12"
        fill={SEVERITY_COLORS.low.fill}
        stroke={SEVERITY_COLORS.low.stroke}
        strokeWidth="2"
      />
      <path
        d="M20 14V22M20 25V26"
        stroke="white"
        strokeWidth="2.5"
        strokeLinecap="round"
      />
    </svg>
  );
}

// ==================== TRIANGLE MARKERS (Network Source) ====================

export function NetworkMarkerHigh({ className = "w-8 h-8" }: MapMarkerProps) {
  return (
    <svg 
      viewBox="0 0 40 40" 
      fill="none" 
      xmlns="http://www.w3.org/2000/svg"
      className={className}
    >
      {/* Pulse effect */}
      <path
        d="M20 6L32 30H8L20 6Z"
        stroke={SEVERITY_COLORS.high.shadow}
        strokeWidth="1"
        fill="none"
        opacity="0.5"
      >
        <animate
          attributeName="opacity"
          from="0.5"
          to="0"
          dur="1.5s"
          repeatCount="indefinite"
        />
      </path>
      {/* Triangle shape */}
      <path
        d="M20 8L31 30H9L20 8Z"
        fill={SEVERITY_COLORS.high.fill}
        stroke={SEVERITY_COLORS.high.stroke}
        strokeWidth="2"
        strokeLinejoin="round"
      />
      {/* Warning icon */}
      <path
        d="M20 16V22M20 25V26"
        stroke="white"
        strokeWidth="2.5"
        strokeLinecap="round"
      />
    </svg>
  );
}

export function NetworkMarkerMedium({ className = "w-8 h-8" }: MapMarkerProps) {
  return (
    <svg 
      viewBox="0 0 40 40" 
      fill="none" 
      xmlns="http://www.w3.org/2000/svg"
      className={className}
    >
      <path
        d="M20 8L31 30H9L20 8Z"
        fill={SEVERITY_COLORS.medium.fill}
        stroke={SEVERITY_COLORS.medium.stroke}
        strokeWidth="2"
        strokeLinejoin="round"
      />
      <path
        d="M20 16V22M20 25V26"
        stroke="white"
        strokeWidth="2.5"
        strokeLinecap="round"
      />
    </svg>
  );
}

export function NetworkMarkerLow({ className = "w-8 h-8" }: MapMarkerProps) {
  return (
    <svg 
      viewBox="0 0 40 40" 
      fill="none" 
      xmlns="http://www.w3.org/2000/svg"
      className={className}
    >
      <path
        d="M20 8L31 30H9L20 8Z"
        fill={SEVERITY_COLORS.low.fill}
        stroke={SEVERITY_COLORS.low.stroke}
        strokeWidth="2"
        strokeLinejoin="round"
      />
      <path
        d="M20 16V22M20 25V26"
        stroke="white"
        strokeWidth="2.5"
        strokeLinecap="round"
      />
    </svg>
  );
}

// ==================== RESOLVING MARKERS (Faded versions) ====================

export function ResolvingV2XMarker({ className = "w-8 h-8" }: MapMarkerProps) {
  return (
    <svg 
      viewBox="0 0 40 40" 
      fill="none" 
      xmlns="http://www.w3.org/2000/svg"
      className={className}
    >
      <rect
        x="8"
        y="8"
        width="24"
        height="24"
        fill={SEVERITY_COLORS.resolving.fill}
        stroke={SEVERITY_COLORS.resolving.stroke}
        strokeWidth="2"
        rx="2"
        opacity="0.6"
      />
      <path
        d="M20 14V22M20 25V26"
        stroke="white"
        strokeWidth="2"
        strokeLinecap="round"
        opacity="0.6"
      />
    </svg>
  );
}

export function ResolvingYourCarMarker({ className = "w-8 h-8" }: MapMarkerProps) {
  return (
    <svg 
      viewBox="0 0 40 40" 
      fill="none" 
      xmlns="http://www.w3.org/2000/svg"
      className={className}
    >
      <circle
        cx="20"
        cy="20"
        r="12"
        fill={SEVERITY_COLORS.resolving.fill}
        stroke={SEVERITY_COLORS.resolving.stroke}
        strokeWidth="2"
        opacity="0.6"
      />
      <path
        d="M20 14V22M20 25V26"
        stroke="white"
        strokeWidth="2"
        strokeLinecap="round"
        opacity="0.6"
      />
    </svg>
  );
}

export function ResolvingNetworkMarker({ className = "w-8 h-8" }: MapMarkerProps) {
  return (
    <svg 
      viewBox="0 0 40 40" 
      fill="none" 
      xmlns="http://www.w3.org/2000/svg"
      className={className}
    >
      <path
        d="M20 8L31 30H9L20 8Z"
        fill={SEVERITY_COLORS.resolving.fill}
        stroke={SEVERITY_COLORS.resolving.stroke}
        strokeWidth="2"
        strokeLinejoin="round"
        opacity="0.6"
      />
      <path
        d="M20 16V22M20 25V26"
        stroke="white"
        strokeWidth="2"
        strokeLinecap="round"
        opacity="0.6"
      />
    </svg>
  );
}

// ==================== LEGACY EXPORTS (for backwards compatibility) ====================

export function CriticalHazardMarker({ className = "w-10 h-10" }: MapMarkerProps) {
  return <YourCarMarkerHigh className={className} />;
}

export function HighHazardMarker({ className = "w-8 h-8" }: MapMarkerProps) {
  return <YourCarMarkerMedium className={className} />;
}

export function MediumHazardMarker({ className = "w-7 h-7" }: MapMarkerProps) {
  return <YourCarMarkerLow className={className} />;
}

export function V2XMarker({ className = "w-9 h-9" }: MapMarkerProps) {
  return <V2XMarkerHigh className={className} />;
}

// ==================== VEHICLE MARKER ====================

export function VehicleMarker({ className = "w-10 h-10" }: MapMarkerProps) {
  return (
    <svg 
      viewBox="0 0 40 40" 
      fill="none" 
      xmlns="http://www.w3.org/2000/svg"
      className={className}
    >
      {/* Outer glow ring */}
      <circle
        cx="20"
        cy="20"
        r="18"
        fill="#0070E1"
        opacity="0.2"
      />
      {/* Main circle */}
      <circle
        cx="20"
        cy="20"
        r="12"
        fill="#0070E1"
        stroke="white"
        strokeWidth="3"
      />
      {/* Direction arrow */}
      <path
        d="M20 14L24 20L20 18L16 20L20 14Z"
        fill="white"
      />
      {/* Pulse animation */}
      <circle
        cx="20"
        cy="20"
        r="12"
        stroke="#0070E1"
        strokeWidth="2"
        fill="none"
        opacity="0.6"
      >
        <animate
          attributeName="r"
          from="12"
          to="20"
          dur="2s"
          repeatCount="indefinite"
        />
        <animate
          attributeName="opacity"
          from="0.6"
          to="0"
          dur="2s"
          repeatCount="indefinite"
        />
      </circle>
    </svg>
  );
}

// ==================== MARKER SELECTION HELPER ====================

export function getMarkerIcon(
  severity: string,
  source: string,
  status?: string
): React.ComponentType<MapMarkerProps> {
  // Handle resolving status
  if (status === 'resolving') {
    switch (source) {
      case 'v2x':
        return ResolvingV2XMarker;
      case 'your-car':
        return ResolvingYourCarMarker;
      case 'network':
        return ResolvingNetworkMarker;
      default:
        return ResolvingNetworkMarker;
    }
  }

  // V2X hazards (Square)
  if (source === 'v2x') {
    switch (severity) {
      case 'high':
        return V2XMarkerHigh;
      case 'medium':
        return V2XMarkerMedium;
      case 'low':
        return V2XMarkerLow;
      default:
        return V2XMarkerMedium;
    }
  }

  // Your Car hazards (Circle)
  if (source === 'your-car') {
    switch (severity) {
      case 'high':
        return YourCarMarkerHigh;
      case 'medium':
        return YourCarMarkerMedium;
      case 'low':
        return YourCarMarkerLow;
      default:
        return YourCarMarkerMedium;
    }
  }

  // Network hazards (Triangle) - default for any other source
  switch (severity) {
    case 'high':
      return NetworkMarkerHigh;
    case 'medium':
      return NetworkMarkerMedium;
    case 'low':
      return NetworkMarkerLow;
    default:
      return NetworkMarkerMedium;
  }
}

import { Card, CardContent, CardHeader } from "./ui/card";
import { AlertCircle, ExternalLink } from "lucide-react";
import { Alert, AlertDescription } from "./ui/alert";

export function MapSetupGuide() {
  return (
    <div className="p-4 max-w-2xl mx-auto space-y-4">
      <Alert className="bg-amber-500/10 border-amber-500/30 text-amber-400">
        <AlertCircle className="h-4 w-4" />
        <AlertDescription>
          Google Maps API key required. Follow the steps below to set up your API key.
        </AlertDescription>
      </Alert>

      <Card className="bg-slate-900/80 backdrop-blur-xl border-slate-700/50">
        <CardHeader>
          <h3 className="text-slate-100">Google Maps API Setup</h3>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="space-y-3 text-slate-300 text-sm">
            <div>
              <p className="mb-2">
                <strong className="text-slate-200">Step 1:</strong> Get a Google Maps API key
              </p>
              <a
                href="https://developers.google.com/maps/documentation/javascript/get-api-key"
                target="_blank"
                rel="noopener noreferrer"
                className="inline-flex items-center gap-1 text-[#0070E1] hover:underline"
              >
                Visit Google Maps Platform
                <ExternalLink className="w-3 h-3" />
              </a>
            </div>

            <div>
              <p className="mb-2">
                <strong className="text-slate-200">Step 2:</strong> Enable these APIs
              </p>
              <ul className="list-disc list-inside ml-2 space-y-1 text-slate-400">
                <li>Maps JavaScript API</li>
                <li>Geometry API (optional)</li>
              </ul>
            </div>

            <div>
              <p className="mb-2">
                <strong className="text-slate-200">Step 3:</strong> Update the code
              </p>
              <div className="bg-slate-950/50 p-3 rounded border border-slate-700/30 font-mono text-xs overflow-x-auto">
                <p className="text-slate-400">// In /components/GoogleMapComponent.tsx, line 102:</p>
                <p className="text-amber-400 mt-1">
                  script.src = `https://maps.googleapis.com/maps/api/js?key=
                  <span className="text-green-400">YOUR_API_KEY_HERE</span>
                  &libraries=geometry`;
                </p>
              </div>
              <p className="text-slate-400 mt-2 text-xs">
                Replace <code className="bg-slate-800 px-1 py-0.5 rounded">YOUR_API_KEY_HERE</code> with your actual API key
              </p>
            </div>

            <div>
              <p className="mb-2">
                <strong className="text-slate-200">Step 4:</strong> Set API restrictions (recommended)
              </p>
              <ul className="list-disc list-inside ml-2 space-y-1 text-slate-400">
                <li>Application restrictions: HTTP referrers</li>
                <li>API restrictions: Limit to Maps JavaScript API</li>
              </ul>
            </div>
          </div>

          <Alert className="bg-blue-500/10 border-blue-500/30">
            <AlertCircle className="h-4 w-4 text-blue-400" />
            <AlertDescription className="text-slate-300 text-xs">
              Note: Google Maps Platform offers a $200 monthly credit. Most development and small-scale production use falls within this free tier.
            </AlertDescription>
          </Alert>
        </CardContent>
      </Card>
    </div>
  );
}

// Notification Service for Hazard Scout Critical Alerts

export interface HazardNotificationData {
  id: string;
  type: string;
  severity: 'high' | 'medium' | 'low';
  distance: number; // in meters
  location: string;
  latitude?: number;
  longitude?: number;
}

export interface NotificationSettings {
  enabled: boolean;
  proximityThreshold: number; // in meters (500, 1000, 2000)
  criticalOnly: boolean; // Only Tier 1/2 (high/medium severity)
  doNotDisturb: {
    enabled: boolean;
    startTime: string; // HH:mm format
    endTime: string; // HH:mm format
  };
}

export class HazardNotificationService {
  private static instance: HazardNotificationService;
  private notifiedHazards: Set<string> = new Set();
  private settings: NotificationSettings;

  private constructor() {
    this.settings = this.loadSettings();
  }

  static getInstance(): HazardNotificationService {
    if (!HazardNotificationService.instance) {
      HazardNotificationService.instance = new HazardNotificationService();
    }
    return HazardNotificationService.instance;
  }

  // Request notification permission from the user
  async requestPermission(): Promise<NotificationPermission> {
    if (!('Notification' in window)) {
      // Browser doesn't support notifications
      return 'denied';
    }

    if (Notification.permission === 'granted') {
      return 'granted';
    }

    if (Notification.permission !== 'denied') {
      const permission = await Notification.requestPermission();
      return permission;
    }

    return Notification.permission;
  }

  // Check if we're in Do Not Disturb period
  private isInDoNotDisturb(): boolean {
    if (!this.settings.doNotDisturb.enabled) {
      return false;
    }

    const now = new Date();
    const currentTime = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
    const { startTime, endTime } = this.settings.doNotDisturb;

    // Handle overnight DND (e.g., 22:00 to 07:00)
    if (startTime > endTime) {
      return currentTime >= startTime || currentTime < endTime;
    }

    // Handle same-day DND (e.g., 13:00 to 14:00)
    return currentTime >= startTime && currentTime < endTime;
  }

  // Calculate if hazard is within proximity threshold
  private isWithinProximity(hazard: HazardNotificationData): boolean {
    return hazard.distance <= this.settings.proximityThreshold;
  }

  // Check if hazard meets severity criteria
  private meetsSeverityCriteria(hazard: HazardNotificationData): boolean {
    if (!this.settings.criticalOnly) {
      return true;
    }
    // Critical only means high or medium severity (Tier 1/2)
    return hazard.severity === 'high' || hazard.severity === 'medium';
  }

  // Show notification for a critical hazard
  async notifyHazard(hazard: HazardNotificationData): Promise<void> {
    // Check if notifications are enabled
    if (!this.settings.enabled) {
      return;
    }

    // Check if already notified for this hazard
    if (this.notifiedHazards.has(hazard.id)) {
      return;
    }

    // Check Do Not Disturb
    if (this.isInDoNotDisturb()) {
      return;
    }

    // Check proximity
    if (!this.isWithinProximity(hazard)) {
      return;
    }

    // Check severity criteria
    if (!this.meetsSeverityCriteria(hazard)) {
      return;
    }

    // Check permission
    if (Notification.permission !== 'granted') {
      // Permission not granted - silently skip notification
      return;
    }

    // Create notification
    const title = this.getNotificationTitle(hazard);
    const body = this.getNotificationBody(hazard);
    const icon = this.getNotificationIcon(hazard.severity);

    try {
      const notification = new Notification(title, {
        body,
        icon,
        badge: icon,
        tag: `hazard-${hazard.id}`, // Prevents duplicate notifications
        requireInteraction: hazard.severity === 'high', // High severity stays visible
        silent: false,
        vibrate: hazard.severity === 'high' ? [200, 100, 200] : [200],
        data: hazard,
      });

      // Mark as notified
      this.notifiedHazards.add(hazard.id);

      // Auto-close after delay (except for high severity)
      if (hazard.severity !== 'high') {
        setTimeout(() => {
          notification.close();
        }, 8000);
      }

      // Handle notification click
      notification.onclick = () => {
        window.focus();
        notification.close();
        // Could navigate to map view showing the hazard
      };
    } catch (error) {
      // Failed to show notification - silently skip
    }
  }

  // Get notification title based on hazard
  private getNotificationTitle(hazard: HazardNotificationData): string {
    const urgency = hazard.severity === 'high' ? ' CRITICAL: ' : ' ';
    return `${urgency}${hazard.type} Ahead`;
  }

  // Get notification body
  private getNotificationBody(hazard: HazardNotificationData): string {
    const distanceText = hazard.distance < 1000 
      ? `${Math.round(hazard.distance)}m ahead`
      : `${(hazard.distance / 1000).toFixed(1)}km ahead`;
    
    return `${distanceText} on ${hazard.location}. Drive with caution.`;
  }

  // Get notification icon based on severity
  private getNotificationIcon(severity: string): string {
    // In production, use actual icon files
    // For now, we'll use data URIs or default browser icons
    return '/hazard-icon.png'; // Placeholder
  }

  // Update notification settings
  updateSettings(newSettings: Partial<NotificationSettings>): void {
    this.settings = { ...this.settings, ...newSettings };
    this.saveSettings();
  }

  // Get current settings
  getSettings(): NotificationSettings {
    return { ...this.settings };
  }

  // Load settings from localStorage
  private loadSettings(): NotificationSettings {
    const saved = localStorage.getItem('hazard-notification-settings');
    if (saved) {
      try {
        return JSON.parse(saved);
      } catch (e) {
        // Failed to parse settings - will use defaults
      }
    }
    
    // Default settings
    return {
      enabled: true,
      proximityThreshold: 1000, // 1km default
      criticalOnly: true, // Only Tier 1/2 by default
      doNotDisturb: {
        enabled: false,
        startTime: '22:00',
        endTime: '07:00',
      },
    };
  }

  // Save settings to localStorage
  private saveSettings(): void {
    try {
      localStorage.setItem('hazard-notification-settings', JSON.stringify(this.settings));
    } catch (e) {
      // Failed to save settings - will retry next time
    }
  }

  // Clear notification history (useful when hazards are resolved)
  clearNotifiedHazard(hazardId: string): void {
    this.notifiedHazards.delete(hazardId);
  }

  // Clear all notification history
  clearAllNotified(): void {
    this.notifiedHazards.clear();
  }

  // Check multiple hazards and notify if needed
  async checkHazards(hazards: HazardNotificationData[]): Promise<void> {
    for (const hazard of hazards) {
      await this.notifyHazard(hazard);
    }
  }
}

// Export singleton instance
export const notificationService = HazardNotificationService.getInstance();

import { Shield, MapPin, AlertTriangle, CheckCircle2, TrendingUp, Eye, EyeOff, Radio, Settings, ChevronRight, BellRing, ThumbsUp, ThumbsDown, Clock, Users, AlertCircle, Check, X, Navigation } from "lucide-react";
import { Card, CardContent } from "./ui/card";
import { Badge } from "./ui/badge";
import { Switch } from "./ui/switch";
import { Button } from "./ui/button";
import { useState, useEffect } from "react";
import { notificationService } from "./NotificationService";
import { hazardService, HazardData, formatTimeRemaining, getRelativeTime } from "./HazardService";
import { toast } from "sonner";
import { Progress } from "./ui/progress";
import { MapboxMap } from "./MapboxMap";
import { LiveNavigationMapScreen } from "./LiveNavigationMapScreen";

interface SafetyScoutScreenProps {
  onNavigateToSettings: () => void;
}

export function SafetyScoutScreen({ onNavigateToSettings }: SafetyScoutScreenProps) {
  const [scoutMonitoring, setScoutMonitoring] = useState(true);
  const [selectedHazard, setSelectedHazard] = useState<HazardData | null>(null);
  const [notificationsEnabled, setNotificationsEnabled] = useState(false);
  const [hazards, setHazards] = useState<HazardData[]>([]);
  const [showResolved, setShowResolved] = useState(false);
  const [navigationActive, setNavigationActive] = useState(false);
  const [navigatingTo, setNavigatingTo] = useState<string | null>(null);
  const [liveNavigationActive, setLiveNavigationActive] = useState(false);
  const [navigationStart, setNavigationStart] = useState<[number, number] | null>(null);
  const [navigationDest, setNavigationDest] = useState<[number, number] | null>(null);
  const [navigationDestName, setNavigationDestName] = useState<string>('');

  // Load hazards and check notification status
  useEffect(() => {
    const settings = notificationService.getSettings();
    const hasPermission = typeof Notification !== 'undefined' && Notification.permission === 'granted';
    setNotificationsEnabled(settings.enabled && hasPermission);

    loadHazards();

    // Refresh hazards every 10 seconds
    const interval = setInterval(loadHazards, 10000);
    return () => clearInterval(interval);
  }, []);

  const loadHazards = () => {
    const allHazards = hazardService.getAllHazards();
    setHazards(allHazards);
  };

  const activeHazards = hazards.filter(h => h.status === 'active' || h.status === 'resolving');
  const resolvedHazards = hazards.filter(h => h.status === 'resolved').slice(0, 5);

  const handleConfirmStillThere = (hazardId: string) => {
    const success = hazardService.confirmHazardStillThere(hazardId);
    if (success) {
      toast.success("Thanks for confirming! Hazard status updated.", {
        description: "Other drivers will be alerted about this hazard.",
        duration: 3000,
      });
      loadHazards();
    } else {
      toast.info("You've already confirmed this hazard recently.", {
        description: "You can confirm again in 1 hour.",
        duration: 3000,
      });
    }
  };

  const handleReportGone = (hazardId: string) => {
    const success = hazardService.reportHazardGone(hazardId);
    if (success) {
      const progress = hazardService.getResolutionProgress(hazardId);
      const remaining = progress ? progress.confirmationsNeeded - progress.currentGoneReports : 0;
      
      if (remaining <= 0) {
        toast.success("Hazard marked as resolved!", {
          description: "Thanks for helping keep the map accurate.",
          duration: 3000,
        });
      } else {
        toast.success(`Report submitted. ${remaining} more needed to resolve.`, {
          description: "We verify reports to ensure accuracy.",
          duration: 3000,
        });
      }
      loadHazards();
      
      // Close the selected hazard if it's resolved
      if (remaining <= 0 && selectedHazard?.id === hazardId) {
        setSelectedHazard(null);
      }
    } else {
      toast.info("You've already reported this hazard recently.", {
        description: "You can report again in 1 hour.",
        duration: 3000,
      });
    }
  };

  const handleStartNavigation = (hazard: HazardData) => {
    setNavigationActive(true);
    setNavigatingTo(hazard.id);
    toast.success(`Navigation started to ${hazard.type}`, {
      description: hazard.locationName,
      duration: 3000,
    });
  };

  const handleStopNavigation = () => {
    setNavigationActive(false);
    setNavigatingTo(null);
    toast.info("Navigation stopped");
  };

  const handleStartLiveNavigation = (start: [number, number], dest: [number, number], destName: string) => {
    setNavigationStart(start);
    setNavigationDest(dest);
    setNavigationDestName(destName);
    setLiveNavigationActive(true);
  };

  const handleEndLiveNavigation = () => {
    setLiveNavigationActive(false);
    setNavigationStart(null);
    setNavigationDest(null);
    setNavigationDestName('');
    toast.info("Navigation ended");
  };

  const getSeverityColor = (severity: string) => {
    switch(severity) {
      case 'high': return 'text-red-400 bg-red-500/20 border-red-500/30';
      case 'medium': return 'text-amber-400 bg-amber-500/20 border-amber-500/30';
      case 'low': return 'text-blue-400 bg-blue-500/20 border-blue-500/30';
      default: return 'text-slate-400 bg-slate-500/20 border-slate-500/30';
    }
  };

  const getStatusColor = (status: string) => {
    switch(status) {
      case 'active': return 'text-green-400 bg-green-500/20 border-green-500/30';
      case 'resolving': return 'text-amber-400 bg-amber-500/20 border-amber-500/30';
      case 'resolved': return 'text-slate-400 bg-slate-500/20 border-slate-500/30';
      default: return 'text-slate-400 bg-slate-500/20 border-slate-500/30';
    }
  };

  const getSourceIcon = (source: string) => {
    if (source === 'v2x') return '';
    if (source === 'your-car') return '';
    if (source === 'user-report') return '';
    return '';
  };

  const getSourceLabel = (source: string) => {
    if (source === 'v2x') return 'VW Car2X';
    if (source === 'your-car') return 'Your Car';
    if (source === 'user-report') return 'User Report';
    return 'Scout Network';
  };

  // Show Live Navigation Screen when active
  if (liveNavigationActive && navigationStart && navigationDest) {
    return (
      <LiveNavigationMapScreen
        startLocation={navigationStart}
        destinationLocation={navigationDest}
        destinationName={navigationDestName}
        hazards={activeHazards}
        onEndNavigation={handleEndLiveNavigation}
      />
    );
  }

  return (
    <div className="min-h-screen bg-[#FDFAF9] dark:bg-slate-950 flex flex-col pb-20 sm:pb-24">
      {/* Header */}
      <div className="bg-gradient-to-b from-white to-[#FDFAF9] dark:from-slate-900 dark:to-slate-950 px-4 pt-6 pb-3 flex-shrink-0">
        <div className="flex items-start justify-between mb-2">
          <div className="flex-1">
            <h1 className="text-[#1F2F57] dark:text-slate-100 text-xl mb-1">Live Hazard Map</h1>
            <p className="text-[#484B6A] dark:text-slate-400 text-sm">Network-detected road hazards near you</p>
          </div>
          {notificationsEnabled && (
            <Badge className="bg-orange-500/20 text-orange-400 border-orange-500/30 text-xs flex items-center gap-1 flex-shrink-0">
              <BellRing className="w-3 h-3" />
              Push Alerts
            </Badge>
          )}
        </div>
      </div>

      {/* Live Map - 2/3 of viewport */}
      <div className="flex-1 relative bg-slate-200 dark:bg-slate-900">
        <MapboxMap 
          hazards={activeHazards} 
          onHazardClick={setSelectedHazard}
          viewMode="fullscreen"
          className="w-full h-full"
          onStartLiveNavigation={handleStartLiveNavigation}
        />

        {/* Legend Overlay */}
        <div className="absolute top-4 left-4 bg-white/90 dark:bg-slate-900/90 backdrop-blur-sm border border-slate-300 dark:border-slate-700/50 rounded-lg p-3 space-y-2 z-10">
          <div className="flex items-center gap-2">
            <div className="w-4 h-4 bg-red-500 rounded-full border border-red-700" />
            <span className="text-[#484B6A] dark:text-slate-300 text-xs">Critical Hazard</span>
          </div>
          <div className="flex items-center gap-2">
            <div className="w-4 h-4 bg-amber-500 rounded-full border border-amber-700" />
            <span className="text-[#484B6A] dark:text-slate-300 text-xs">High Hazard</span>
          </div>
          <div className="flex items-center gap-2">
            <div className="w-4 h-4 bg-[#0070E1] rounded-full border border-blue-700" />
            <span className="text-[#484B6A] dark:text-slate-300 text-xs">V2X Official</span>
          </div>
        </div>

        {/* Selected Hazard Detail Card */}
        {selectedHazard && (
          <div className="absolute bottom-4 left-4 right-4 max-h-[50vh] overflow-y-auto z-20 [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]">
            <Card className="bg-white/95 dark:bg-slate-900/95 backdrop-blur-lg border-slate-300 dark:border-slate-700/50">
              <CardContent className="p-4">
                <div className="flex items-start justify-between mb-3">
                  <div className="flex items-start gap-3 flex-1">
                    <div className={`w-10 h-10 rounded-full flex items-center justify-center ${getSeverityColor(selectedHazard.severity)}`}>
                      <AlertTriangle className="w-5 h-5" />
                    </div>
                    <div className="flex-1">
                      <div className="flex items-center gap-2 mb-1 flex-wrap">
                        <p className="text-[#1F2F57] dark:text-slate-200 text-sm">{selectedHazard.type}</p>
                        <Badge className={`text-xs ${getSeverityColor(selectedHazard.severity)}`}>
                          {selectedHazard.severity}
                        </Badge>
                        <Badge className={`text-xs ${getStatusColor(selectedHazard.status)}`}>
                          {selectedHazard.status}
                        </Badge>
                      </div>
                      <p className="text-[#9394a5] dark:text-slate-400 text-xs mb-1">{selectedHazard.locationName}</p>
                      <div className="flex items-center gap-3 text-xs flex-wrap">
                        {selectedHazard.distance && (
                          <>
                            <span className="text-[#0070E1]">{selectedHazard.distance} ahead</span>
                            <span className="text-[#A8A8A8] dark:text-slate-500"></span>
                          </>
                        )}
                        <span className="text-[#A8A8A8] dark:text-slate-500">{getRelativeTime(selectedHazard.firstDetectedAt)}</span>
                      </div>
                      <div className="mt-2 flex items-center gap-1.5">
                        <span className="text-xs">{getSourceIcon(selectedHazard.source)}</span>
                        <span className="text-xs text-[#9394a5] dark:text-slate-400">
                          {getSourceLabel(selectedHazard.source)}
                        </span>
                      </div>
                    </div>
                  </div>
                  <button 
                    onClick={() => setSelectedHazard(null)}
                    className="text-[#9394a5] hover:text-[#1F2F57] dark:text-slate-400 dark:hover:text-slate-200 flex-shrink-0"
                  >
                    
                  </button>
                </div>

                {/* Hazard Statistics */}
                <div className="grid grid-cols-3 gap-2 mb-3 pb-3 border-b border-slate-200 dark:border-slate-700/30">
                  <div className="text-center">
                    <p className="text-[#9394a5] dark:text-slate-400 text-[10px] mb-0.5">Detected</p>
                    <p className="text-[#1F2F57] dark:text-slate-200 text-sm">{selectedHazard.detectionCount}x</p>
                  </div>
                  <div className="text-center border-x border-slate-200 dark:border-slate-700/30">
                    <p className="text-[#9394a5] dark:text-slate-400 text-[10px] mb-0.5">Confirmed</p>
                    <p className="text-green-400 text-sm">{selectedHazard.confirmationCount}</p>
                  </div>
                  <div className="text-center">
                    <p className="text-[#9394a5] dark:text-slate-400 text-[10px] mb-0.5">Reported Gone</p>
                    <p className="text-amber-400 text-sm">{selectedHazard.reportedGoneCount}</p>
                  </div>
                </div>

                {/* Resolution Progress (if resolving) */}
                {selectedHazard.status === 'resolving' && (() => {
                  const progress = hazardService.getResolutionProgress(selectedHazard.id);
                  if (!progress) return null;
                  
                  return (
                    <div className="mb-3 pb-3 border-b border-slate-200 dark:border-slate-700/30">
                      <div className="flex items-center justify-between mb-2">
                        <div className="flex items-center gap-2">
                          <Clock className="w-4 h-4 text-amber-400" />
                          <span className="text-amber-400 text-xs">Pending Resolution</span>
                        </div>
                        <span className="text-[#9394a5] dark:text-slate-400 text-xs">
                          {progress.currentGoneReports}/{progress.confirmationsNeeded} reports
                        </span>
                      </div>
                      <Progress value={progress.percentageToResolution} className="h-2 mb-2" />
                      {progress.timeRemainingMs && (
                        <p className="text-[#A8A8A8] dark:text-slate-500 text-[10px]">
                          Auto-resolves in {formatTimeRemaining(progress.timeRemainingMs)} without confirmation
                        </p>
                      )}
                    </div>
                  );
                })()}

                {/* User Action Buttons */}
                {selectedHazard.status !== 'resolved' && (
                  <div className="space-y-2">
                    {/* Navigation Button */}
                    <Button
                      onClick={() => handleStartNavigation(selectedHazard)}
                      className="w-full bg-[#0070E1] hover:bg-[#0056b3] text-white h-auto py-3 flex items-center justify-center gap-2"
                    >
                      <Navigation className="w-4 h-4" />
                      <span className="text-sm">Navigate to Hazard</span>
                    </Button>
                    
                    <p className="text-[#484B6A] dark:text-slate-300 text-xs mb-2">Help us verify this hazard:</p>
                    <div className="grid grid-cols-2 gap-2">
                      <Button
                        onClick={() => handleConfirmStillThere(selectedHazard.id)}
                        disabled={hazardService.hasUserConfirmed(selectedHazard.id, 'still-there')}
                        variant="outline"
                        className="w-full border-green-500/30 text-green-400 hover:bg-green-500/10 h-auto py-2.5 flex flex-col items-center gap-1"
                      >
                        {hazardService.hasUserConfirmed(selectedHazard.id, 'still-there') ? (
                          <>
                            <Check className="w-4 h-4" />
                            <span className="text-xs">Confirmed</span>
                          </>
                        ) : (
                          <>
                            <ThumbsUp className="w-4 h-4" />
                            <span className="text-xs">Still There</span>
                          </>
                        )}
                      </Button>
                      <Button
                        onClick={() => handleReportGone(selectedHazard.id)}
                        disabled={hazardService.hasUserConfirmed(selectedHazard.id, 'gone')}
                        variant="outline"
                        className="w-full border-red-500/30 text-red-400 hover:bg-red-500/10 h-auto py-2.5 flex flex-col items-center gap-1"
                      >
                        {hazardService.hasUserConfirmed(selectedHazard.id, 'gone') ? (
                          <>
                            <X className="w-4 h-4" />
                            <span className="text-xs">Reported</span>
                          </>
                        ) : (
                          <>
                            <ThumbsDown className="w-4 h-4" />
                            <span className="text-xs">Hazard Gone</span>
                          </>
                        )}
                      </Button>
                    </div>
                    <div className="bg-slate-100 dark:bg-slate-800/50 rounded-lg p-2 border border-slate-200 dark:border-slate-700/30">
                      <p className="text-[#9394a5] dark:text-slate-400 text-[10px] leading-relaxed">
                        {selectedHazard.status === 'active' 
                          ? "Your feedback helps other drivers stay safe and keeps our map accurate."
                          : `${3 - selectedHazard.reportedGoneCount} more "gone" reports needed to resolve this hazard.`
                        }
                      </p>
                    </div>
                  </div>
                )}

                {/* Resolved message */}
                {selectedHazard.status === 'resolved' && (
                  <div className="bg-green-500/10 rounded-lg p-3 border border-green-500/30">
                    <div className="flex items-center gap-2">
                      <CheckCircle2 className="w-4 h-4 text-green-400" />
                      <p className="text-green-400 text-xs">
                        This hazard has been resolved. Thanks to everyone who reported!
                      </p>
                    </div>
                  </div>
                )}
              </CardContent>
            </Card>
          </div>
        )}

        {/* Map Legend */}
        <div className="absolute top-2 sm:top-4 right-2 sm:right-4 bg-white/95 dark:bg-slate-900/95 backdrop-blur-lg border border-slate-300 dark:border-slate-700/50 rounded-lg p-2 sm:p-3 z-10 shadow-lg max-w-[120px]">
          <div className="flex items-center gap-1.5 mb-2 pb-2 border-b border-slate-200 dark:border-slate-700/50">
            <Shield className="w-3 h-3 text-[#0070E1]" />
            <span className="text-[#484B6A] dark:text-slate-300 text-[10px] sm:text-xs">Legend</span>
          </div>
          <div className="space-y-1.5 sm:space-y-2 mb-2 pb-2 border-b border-slate-200 dark:border-slate-700/50">
            <div className="flex items-center gap-1.5 sm:gap-2">
              <div className="w-2.5 h-2.5 sm:w-3 sm:h-3 rounded-full bg-red-500 flex-shrink-0"></div>
              <span className="text-[#484B6A] dark:text-slate-300 text-[10px] sm:text-xs">High</span>
            </div>
            <div className="flex items-center gap-1.5 sm:gap-2">
              <div className="w-2.5 h-2.5 sm:w-3 sm:h-3 rounded-full bg-amber-500 flex-shrink-0"></div>
              <span className="text-[#484B6A] dark:text-slate-300 text-[10px] sm:text-xs">Medium</span>
            </div>
            <div className="flex items-center gap-1.5 sm:gap-2">
              <div className="w-2.5 h-2.5 sm:w-3 sm:h-3 rounded-full bg-blue-500 flex-shrink-0"></div>
              <span className="text-[#484B6A] dark:text-slate-300 text-[10px] sm:text-xs">Low</span>
            </div>
          </div>
          <div className="space-y-1.5 sm:space-y-2">
            <div className="flex items-center gap-1.5 sm:gap-2">
              <Clock className="w-2.5 h-2.5 sm:w-3 sm:h-3 text-amber-400 flex-shrink-0" />
              <span className="text-[#484B6A] dark:text-slate-300 text-[10px] sm:text-xs">Resolving</span>
            </div>
          </div>
        </div>

        {/* Current Status Badge */}
        <div className="absolute bottom-3 left-3 right-3">
          <Card className="bg-white/95 dark:bg-slate-900/95 backdrop-blur-lg border-slate-300 dark:border-slate-700/50">
            <CardContent className="p-3">
              <div className="flex items-center justify-between gap-2">
                <div className="flex items-center gap-2 min-w-0">
                  <Shield className="w-5 h-5 text-[#0070E1] flex-shrink-0" />
                  <div className="min-w-0">
                    <p className="text-[#1F2F57] dark:text-slate-200 text-sm truncate">Monitoring Active</p>
                    <p className="text-[#9394a5] dark:text-slate-400 text-xs truncate">{activeHazards.length} active hazards nearby</p>
                  </div>
                </div>
                <Badge className="bg-green-500/20 text-green-400 border-green-500/30 text-xs flex-shrink-0">
                  Live
                </Badge>
              </div>
            </CardContent>
          </Card>
        </div>
      </div>

      {/* Bottom 1/3 - Scrollable Cards */}
      <div className="flex-shrink-0 h-[40vh] bg-[#FDFAF9] dark:bg-slate-950 overflow-y-auto [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]">
        <div className="px-4 py-4 space-y-4">
            {/* Contribution Status Card */}
            <Card className="bg-gradient-to-br from-[#0070E1]/10 to-blue-500/10 border-[#0070E1]/30">
              <CardContent className="p-4">
                <div className="flex items-center justify-between mb-3 gap-2">
                  <div className="flex items-center gap-3 min-w-0">
                    <div className="w-10 h-10 rounded-full bg-[#0070E1]/20 flex items-center justify-center flex-shrink-0">
                      {scoutMonitoring ? (
                        <Eye className="w-5 h-5 text-[#0070E1]" />
                      ) : (
                        <EyeOff className="w-5 h-5 text-slate-400" />
                      )}
                    </div>
                    <div className="min-w-0">
                      <p className="text-[#1F2F57] dark:text-slate-200 text-sm truncate">Hazard Detection</p>
                      <p className="text-[#9394a5] dark:text-slate-400 text-xs truncate">
                        {scoutMonitoring ? "Sharing hazard data with other drivers" : "Detection paused"}
                      </p>
                    </div>
                  </div>
                  <Switch
                    checked={scoutMonitoring}
                    onCheckedChange={setScoutMonitoring}
                    className="flex-shrink-0"
                  />
                </div>
                <div className="bg-slate-100 dark:bg-slate-800/50 rounded-lg p-3 border border-slate-200 dark:border-slate-700/30">
                  <div className="flex items-center gap-2">
                    <Shield className="w-4 h-4 text-green-400 flex-shrink-0" />
                    <p className="text-[#484B6A] dark:text-slate-300 text-xs">Your privacy is protected - faces & plates are blurred</p>
                  </div>
                </div>
              </CardContent>
            </Card>

            {/* Active Alerts List Card */}
            <Card className="bg-white dark:bg-slate-900/90 border-slate-200 dark:border-slate-700/50">
              <CardContent className="p-4">
                <div className="flex items-center justify-between mb-3">
                  <h3 className="text-[#1F2F57] dark:text-slate-200 text-sm">Active Hazards</h3>
                  <Badge variant="outline" className="border-slate-300 dark:border-slate-600 text-[#9394a5] dark:text-slate-400 text-xs">
                    {activeHazards.length} total
                  </Badge>
                </div>
                {activeHazards.length === 0 ? (
                  <div className="text-center py-6">
                    <CheckCircle2 className="w-12 h-12 text-green-400 mx-auto mb-2 opacity-50" />
                    <p className="text-[#9394a5] dark:text-slate-400 text-sm">No active hazards nearby</p>
                    <p className="text-[#A8A8A8] dark:text-slate-500 text-xs mt-1">Drive safe!</p>
                  </div>
                ) : (
                  <div className="space-y-2">
                    {activeHazards.map((hazard) => (
                      <div
                        key={hazard.id}
                        onClick={() => setSelectedHazard(hazard)}
                        className="bg-slate-100 dark:bg-slate-800/50 rounded-lg p-2 sm:p-3 border border-slate-200 dark:border-slate-700/30 cursor-pointer hover:bg-slate-200 dark:hover:bg-slate-800/70 transition-colors"
                      >
                        <div className="flex items-start justify-between gap-2">
                          <div className="flex items-start gap-2 sm:gap-3 flex-1 min-w-0">
                            <div className={`w-7 h-7 sm:w-8 sm:h-8 rounded-full flex items-center justify-center flex-shrink-0 ${getSeverityColor(hazard.severity)}`}>
                              <AlertTriangle className="w-3.5 h-3.5 sm:w-4 sm:h-4" />
                            </div>
                            <div className="flex-1 min-w-0">
                              <div className="flex items-center gap-1.5 sm:gap-2 mb-0.5 sm:mb-1 flex-wrap">
                                <p className="text-[#1F2F57] dark:text-slate-200 text-xs sm:text-sm">{hazard.type}</p>
                                <Badge className={`text-[10px] sm:text-xs ${getSeverityColor(hazard.severity)}`}>
                                  {hazard.severity}
                                </Badge>
                                {hazard.status === 'resolving' && (
                                  <Badge className="text-[10px] sm:text-xs bg-amber-500/20 text-amber-400 border-amber-500/30">
                                    <Clock className="w-2.5 h-2.5 mr-1" />
                                    Resolving
                                  </Badge>
                                )}
                              </div>
                              <p className="text-[#9394a5] dark:text-slate-400 text-[10px] sm:text-xs mb-0.5 sm:mb-1 truncate">{hazard.locationName}</p>
                              <div className="flex items-center gap-2 mb-1">
                                <span className="text-[10px] sm:text-xs">{getSourceIcon(hazard.source)}</span>
                                <span className="text-[#A8A8A8] dark:text-slate-500 text-[10px] sm:text-xs">{getSourceLabel(hazard.source)}</span>
                                <span className="text-[#D4D4D4] dark:text-slate-600 text-[10px]"></span>
                                <p className="text-[#A8A8A8] dark:text-slate-500 text-[10px] sm:text-xs">{getRelativeTime(hazard.firstDetectedAt)}</p>
                              </div>
                              <div className="flex items-center gap-3 text-[10px]">
                                <div className="flex items-center gap-1">
                                  <ThumbsUp className="w-2.5 h-2.5 text-green-400" />
                                  <span className="text-green-400">{hazard.confirmationCount}</span>
                                </div>
                                <div className="flex items-center gap-1">
                                  <ThumbsDown className="w-2.5 h-2.5 text-red-400" />
                                  <span className="text-red-400">{hazard.reportedGoneCount}</span>
                                </div>
                              </div>
                            </div>
                          </div>
                          {hazard.distance && (
                            <div className="text-right flex-shrink-0">
                              <p className="text-[#0070E1] text-xs sm:text-sm">{hazard.distance}</p>
                            </div>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </CardContent>
            </Card>

            {/* Verification Info Card */}
            <Card className="bg-gradient-to-br from-amber-500/10 to-orange-500/10 border-amber-500/30">
              <CardContent className="p-4">
                <div className="flex items-start gap-3 mb-2">
                  <div className="w-10 h-10 rounded-full bg-amber-500/20 flex items-center justify-center flex-shrink-0">
                    <Users className="w-5 h-5 text-amber-400" />
                  </div>
                  <div>
                    <p className="text-[#1F2F57] dark:text-slate-200 text-sm mb-1">Community Verification</p>
                    <p className="text-[#9394a5] dark:text-slate-400 text-xs leading-relaxed">
                      Help keep the hazard map accurate by confirming or reporting hazards as you drive. 
                      Your feedback directly impacts other drivers' safety.
                    </p>
                  </div>
                </div>
                <div className="grid grid-cols-2 gap-2 mt-3">
                  <div className="bg-slate-100 dark:bg-slate-800/50 rounded-lg p-2.5 border border-slate-200 dark:border-slate-700/30 text-center">
                    <div className="flex items-center justify-center gap-1 mb-1">
                      <ThumbsUp className="w-3.5 h-3.5 text-green-400" />
                      <p className="text-[#484B6A] dark:text-slate-300 text-xs">Still There</p>
                    </div>
                    <p className="text-[#A8A8A8] dark:text-slate-500 text-[10px]">Extends alert</p>
                  </div>
                  <div className="bg-slate-100 dark:bg-slate-800/50 rounded-lg p-2.5 border border-slate-200 dark:border-slate-700/30 text-center">
                    <div className="flex items-center justify-center gap-1 mb-1">
                      <ThumbsDown className="w-3.5 h-3.5 text-red-400" />
                      <p className="text-[#484B6A] dark:text-slate-300 text-xs">Hazard Gone</p>
                    </div>
                    <p className="text-[#A8A8A8] dark:text-slate-500 text-[10px]">3 reports = resolved</p>
                  </div>
                </div>
              </CardContent>
            </Card>

            {/* Recently Resolved Card */}
            {resolvedHazards.length > 0 && (
              <Card className="bg-white dark:bg-slate-900/90 border-slate-200 dark:border-slate-700/50">
                <CardContent className="p-4">
                  <div className="flex items-center justify-between mb-3">
                    <h3 className="text-[#1F2F57] dark:text-slate-200 text-sm">Recently Resolved</h3>
                    <Badge variant="outline" className="border-slate-300 dark:border-slate-600 text-[#9394a5] dark:text-slate-400 text-xs">
                      {resolvedHazards.length} cleared
                    </Badge>
                  </div>
                  <div className="space-y-2">
                    {resolvedHazards.map((hazard) => (
                      <div
                        key={hazard.id}
                        className="bg-slate-50 dark:bg-slate-800/30 rounded-lg p-3 border border-slate-200 dark:border-slate-700/20"
                      >
                        <div className="flex items-center gap-3">
                          <div className="w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center flex-shrink-0">
                            <CheckCircle2 className="w-4 h-4 text-green-400" />
                          </div>
                          <div className="flex-1 min-w-0">
                            <p className="text-[#484B6A] dark:text-slate-300 text-xs mb-0.5">{hazard.type}</p>
                            <p className="text-[#A8A8A8] dark:text-slate-500 text-[10px] sm:text-xs truncate">{hazard.locationName}</p>
                          </div>
                          <p className="text-[#D4D4D4] dark:text-slate-600 text-[10px] flex-shrink-0">{getRelativeTime(hazard.lastUpdatedAt)}</p>
                        </div>
                      </div>
                    ))}
                  </div>
                </CardContent>
              </Card>
            )}

            {/* Settings Link Card */}
            <button 
              onClick={onNavigateToSettings}
              className="w-full"
            >
              <Card className="bg-white dark:bg-slate-900/90 border-slate-200 dark:border-slate-700/50 hover:bg-slate-50 dark:hover:bg-slate-800/90 hover:border-[#0070E1]/50 transition-all cursor-pointer">
                <CardContent className="p-4">
                  <div className="flex items-center gap-3">
                    <div className="w-10 h-10 rounded-full bg-[#0070E1]/20 flex items-center justify-center">
                      <Settings className="w-5 h-5 text-[#0070E1]" />
                    </div>
                    <div className="flex-1 text-left">
                      <p className="text-[#1F2F57] dark:text-slate-200 text-sm">Hazard Scout Settings</p>
                      <p className="text-[#9394a5] dark:text-slate-400 text-xs">Configure alerts & resolution</p>
                    </div>
                    <ChevronRight className="w-5 h-5 text-[#A8A8A8] dark:text-slate-500" />
                  </div>
                </CardContent>
              </Card>
            </button>
          </div>
      </div>
    </div>
  );
}
import { Calendar, MapPin, Phone, BookOpen, Calculator, CreditCard, CheckCircle2, Clock, AlertCircle, ShieldAlert } from "lucide-react";
import { Card, CardContent, CardHeader } from "./ui/card";
import { Button } from "./ui/button";
import { Badge } from "./ui/badge";
import { Vehicle } from "../types/vehicle";
import { toast } from "sonner";

interface ServiceScreenProps {
  vehicle: Vehicle;
}

export function ServiceScreen({ vehicle }: ServiceScreenProps) {
  const handleBookService = () => {
    toast.success("Opening Service Booking", {
      description: "Loading available appointments at nearby VW service centers.",
      duration: 3000,
    });
  };

  const handleFindDealer = () => {
    toast.info("Finding Nearest Dealers", {
      description: "Searching for authorized VW service centers near you.",
      duration: 3000,
    });
  };

  const handleRoadsideAssist = () => {
    toast.success("Roadside Assistance", {
      description: "Connecting you to 24/7 VW emergency support.",
      duration: 4000,
    });
  };

  const handleScheduleUrgent = () => {
    toast.success("Scheduling Urgent Service", {
      description: "Priority booking for suspension check. We'll contact you shortly.",
      duration: 3000,
    });
  };

  const handleOpenManual = () => {
    toast.info("Owner's Manual", {
      description: "Opening digital manual for your VW " + vehicle.model,
      duration: 3000,
    });
  };

  const handleServiceCostCalculator = () => {
    toast.info("Service Cost Calculator", {
      description: "Estimate maintenance costs for your vehicle.",
      duration: 3000,
    });
  };

  const handleEMICalculator = () => {
    toast.info("EMI Calculator", {
      description: "Calculate financing options for your service.",
      duration: 3000,
    });
  };

  const handleEmergencyCall = () => {
    toast.error("Emergency Roadside Assistance", {
      description: "Calling VW 24/7 support: 1-800-VW-ASSIST",
      duration: 5000,
    });
  };

  const serviceHistory = [
    {
      id: 1,
      date: "Oct 15, 2024",
      type: "Annual Service",
      dealer: "VW Service Center, Connaught Place",
      status: "completed",
      cost: "12,500"
    },
    {
      id: 2,
      date: "Jun 20, 2024",
      type: "Oil Change & Filter",
      dealer: "VW Service Center, Connaught Place",
      status: "completed",
      cost: "4,200"
    },
    {
      id: 3,
      date: "Mar 10, 2024",
      type: "Tire Rotation",
      dealer: "VW Service Center, Saket",
      status: "completed",
      cost: "2,800"
    }
  ];

  const upcomingMaintenance = [
    {
      service: "Suspension Check Recommended",
      due: "Soon",
      priority: "high",
      reason: "High Impact Events Logged"
    },
    {
      service: "Annual Service",
      due: "In 5,000 km",
      priority: "medium"
    },
    {
      service: "Brake Inspection",
      due: "In 8,000 km",
      priority: "low"
    }
  ];

  return (
    <div className="min-h-screen bg-[#FDFAF9] dark:bg-slate-950 pb-20 sm:pb-24">
      {/* Header */}
      <div className="bg-gradient-to-b from-white to-[#FDFAF9] dark:from-slate-900 dark:to-slate-950 px-4 pt-6 pb-4">
        <h1 className="text-[#1F2F57] dark:text-slate-100 text-xl mb-1">Service & Maintenance</h1>
        <p className="text-[#484B6A] dark:text-slate-400 text-sm">VW {vehicle.model}  {vehicle.mileage.toLocaleString()} km</p>
      </div>

      {/* Upcoming Maintenance Alert */}
      <div className="px-4 -mt-2">
        <Card className="bg-gradient-to-br from-red-50 to-amber-50 dark:from-red-900/20 dark:to-amber-900/20 border-red-300 dark:border-red-700/50 shadow-lg">
          <CardContent className="p-4">
            <div className="flex items-start gap-3">
              <div className="w-12 h-12 rounded-full bg-red-100 dark:bg-red-500/20 flex items-center justify-center flex-shrink-0 animate-pulse">
                <ShieldAlert className="w-6 h-6 text-red-600 dark:text-red-400" />
              </div>
              <div className="flex-1">
                <p className="text-[#1F2F57] dark:text-slate-200 mb-1"> Predictive Maintenance Alert</p>
                <p className="text-[#484B6A] dark:text-slate-400 text-xs mb-2">
                  <strong>Suspension Check Recommended</strong> - High Impact Events Logged
                </p>
                <p className="text-[#9394a5] dark:text-slate-400 text-xs">
                  Your vehicle has encountered multiple high-severity road hazards. Schedule a suspension inspection to prevent damage.
                </p>
                <Button 
                  onClick={handleScheduleUrgent}
                  size="sm" 
                  className="bg-red-600 hover:bg-red-700 text-white mt-3"
                >
                  Schedule Service Now
                </Button>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Primary Action Buttons */}
      <div className="px-4 mt-6">
        <div className="grid gap-3">
          <Button 
            onClick={handleBookService}
            className="bg-[#0070E1] hover:bg-[#0060C1] text-white h-auto py-4 justify-start"
          >
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center">
                <Calendar className="w-5 h-5" />
              </div>
              <div className="text-left">
                <p className="text-sm">Book Service Appointment</p>
                <p className="text-xs text-blue-100">Schedule your next visit</p>
              </div>
            </div>
          </Button>

          <div className="grid grid-cols-2 gap-3">
            <Button
              onClick={handleFindDealer}
              variant="outline"
              className="bg-white dark:bg-slate-900/50 border-slate-300 dark:border-slate-700/50 text-[#484B6A] dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-800/50 h-auto py-3 flex-col gap-2"
            >
              <MapPin className="w-5 h-5 text-[#0070E1]" />
              <span className="text-xs">Find Dealer</span>
            </Button>
            <Button
              onClick={handleRoadsideAssist}
              variant="outline"
              className="bg-white dark:bg-slate-900/50 border-slate-300 dark:border-slate-700/50 text-[#484B6A] dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-800/50 h-auto py-3 flex-col gap-2"
            >
              <Phone className="w-5 h-5 text-red-400" />
              <span className="text-xs">Roadside Assist</span>
            </Button>
          </div>
        </div>
      </div>

      {/* Recommended Maintenance */}
      <div className="px-4 mt-6">
        <h3 className="text-[#9394a5] dark:text-slate-300 text-sm mb-3">Upcoming Maintenance</h3>
        <div className="space-y-2">
          {upcomingMaintenance.map((item, index) => (
            <Card 
              key={index} 
              className={`backdrop-blur-xl ${
                item.priority === "high" 
                  ? "bg-amber-500/10 border-amber-500/30" 
                  : "bg-white dark:bg-slate-900/90 border-slate-200 dark:border-slate-700/50"
              }`}
            >
              <CardContent className="p-4">
                <div className="flex items-start justify-between">
                  <div className="flex items-start gap-3 flex-1">
                    <div className={`w-2 h-2 rounded-full mt-2 ${
                      item.priority === "high" ? "bg-amber-400" :
                      item.priority === "medium" ? "bg-amber-400" : "bg-slate-500"
                    }`} />
                    <div className="flex-1">
                      <p className="text-[#1F2F57] dark:text-slate-200 text-sm mb-1">{item.service}</p>
                      {item.reason && (
                        <p className="text-[#9394a5] dark:text-slate-400 text-xs mb-2">{item.reason}</p>
                      )}
                      <p className="text-[#9394a5] dark:text-slate-400 text-xs">{item.due}</p>
                    </div>
                  </div>
                  <div className="flex flex-col gap-2 items-end">
                    <Badge 
                      variant="outline" 
                      className={`text-xs ${
                        item.priority === "high" 
                          ? "border-amber-500/50 text-amber-400" 
                          : "border-slate-600 text-slate-400"
                      }`}
                    >
                      {item.priority === "high" ? "Urgent" : item.priority === "medium" ? "Soon" : "Later"}
                    </Badge>
                    {item.priority === "high" && (
                      <Button 
                        onClick={handleScheduleUrgent}
                        size="sm" 
                        className="bg-[#0070E1] hover:bg-[#0060C1] text-white h-7 text-xs"
                      >
                        Schedule
                      </Button>
                    )}
                  </div>
                </div>
              </CardContent>
            </Card>
          ))}
        </div>
      </div>

      {/* Service History */}
      <div className="px-4 mt-6">
        <h3 className="text-[#9394a5] dark:text-slate-300 text-sm mb-3">Service History</h3>
        <div className="space-y-3">
          {serviceHistory.map((service) => (
            <Card key={service.id} className="bg-white dark:bg-slate-900/90 border-slate-200 dark:border-slate-700/50 backdrop-blur-xl">
              <CardContent className="p-4">
                <div className="flex items-start justify-between mb-2">
                  <div className="flex items-start gap-3">
                    <div className="w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                      <CheckCircle2 className="w-5 h-5 text-green-400" />
                    </div>
                    <div>
                      <p className="text-[#1F2F57] dark:text-slate-200 text-sm mb-1">{service.type}</p>
                      <p className="text-[#9394a5] dark:text-slate-400 text-xs mb-1">{service.dealer}</p>
                      <div className="flex items-center gap-2 text-[#A8A8A8] dark:text-slate-500 text-xs">
                        <Clock className="w-3 h-3" />
                        {service.date}
                      </div>
                    </div>
                  </div>
                  <div className="text-right">
                    <Badge className="bg-green-500/20 text-green-400 border-green-500/30 text-xs mb-1">
                      {service.status}
                    </Badge>
                    <p className="text-[#484B6A] dark:text-slate-300 text-sm">{service.cost}</p>
                  </div>
                </div>
              </CardContent>
            </Card>
          ))}
        </div>
      </div>

      {/* Digital Tools */}
      <div className="px-4 mt-6">
        <h3 className="text-slate-300 text-sm mb-3">Helpful Tools</h3>
        <div className="space-y-3">
          {/* Owner's Manual */}
          <Card className="bg-slate-900/90 border-slate-700/50 backdrop-blur-xl">
            <CardContent className="p-4">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-full bg-[#0070E1]/20 flex items-center justify-center">
                  <BookOpen className="w-5 h-5 text-[#0070E1]" />
                </div>
                <div className="flex-1">
                  <p className="text-slate-200 text-sm">Digital Owner's Manual</p>
                  <p className="text-slate-400 text-xs">Access your vehicle manual</p>
                </div>
                <Button
                  onClick={handleOpenManual}
                  variant="ghost"
                  size="sm"
                  className="text-[#0070E1] hover:text-[#0060C1] hover:bg-[#0070E1]/10"
                >
                  Open
                </Button>
              </div>
            </CardContent>
          </Card>

          {/* Financial Tools */}
          <div className="grid grid-cols-2 gap-3">
            <Card 
              onClick={handleServiceCostCalculator}
              className="bg-slate-900/90 border-slate-700/50 backdrop-blur-xl cursor-pointer hover:bg-slate-800/90 transition-colors"
            >
              <CardContent className="p-4">
                <div className="flex flex-col items-center text-center gap-2">
                  <div className="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center">
                    <Calculator className="w-5 h-5 text-slate-300" />
                  </div>
                  <div>
                    <p className="text-slate-200 text-sm">Service Cost</p>
                    <p className="text-slate-400 text-xs">Calculator</p>
                  </div>
                </div>
              </CardContent>
            </Card>

            <Card 
              onClick={handleEMICalculator}
              className="bg-slate-900/90 border-slate-700/50 backdrop-blur-xl cursor-pointer hover:bg-slate-800/90 transition-colors"
            >
              <CardContent className="p-4">
                <div className="flex flex-col items-center text-center gap-2">
                  <div className="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center">
                    <CreditCard className="w-5 h-5 text-slate-300" />
                  </div>
                  <div>
                    <p className="text-slate-200 text-sm">EMI</p>
                    <p className="text-slate-400 text-xs">Calculator</p>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>
        </div>
      </div>

      {/* Contact Support */}
      <div className="px-4 mt-6 mb-6">
        <Card className="bg-gradient-to-br from-slate-900/90 to-slate-800/90 border-slate-700/50">
          <CardContent className="p-4">
            <div className="text-center">
              <p className="text-slate-300 text-sm mb-3">Need help right now?</p>
              <Button 
                onClick={handleEmergencyCall}
                className="bg-red-500 hover:bg-red-600 text-white w-full"
              >
                <Phone className="w-4 h-4 mr-2" />
                Call Emergency Roadside Assistance
              </Button>
              <p className="text-slate-500 text-xs mt-2">24/7 support</p>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}
import { createContext, useContext, useState, useEffect, ReactNode } from "react";

type Theme = "dark" | "light";
type TextSize = "normal" | "large" | "xlarge";

interface AccessibilitySettings {
  reducedMotion: boolean;
  highContrast: boolean;
  textSize: TextSize;
}

interface ThemeContextType {
  theme: Theme;
  toggleTheme: () => void;
  setTheme: (theme: Theme) => void;
  accessibility: AccessibilitySettings;
  updateAccessibility: (settings: Partial<AccessibilitySettings>) => void;
}

const ThemeContext = createContext<ThemeContextType | undefined>(undefined);

export function ThemeProvider({ children }: { children: ReactNode }) {
  const [theme, setThemeState] = useState<Theme>(() => {
    const saved = localStorage.getItem("hazard-scout-theme");
    return (saved as Theme) || "dark";
  });

  const [accessibility, setAccessibility] = useState<AccessibilitySettings>(() => {
    const saved = localStorage.getItem("hazard-scout-accessibility");
    return saved ? JSON.parse(saved) : {
      reducedMotion: false,
      highContrast: false,
      textSize: "normal"
    };
  });

  useEffect(() => {
    const root = document.documentElement;
    
    // Apply theme
    if (theme === "dark") {
      root.classList.add("dark");
      root.classList.remove("light");
    } else {
      root.classList.add("light");
      root.classList.remove("dark");
    }
    
    // Apply accessibility settings
    if (accessibility.reducedMotion) {
      root.classList.add("reduce-motion");
    } else {
      root.classList.remove("reduce-motion");
    }
    
    if (accessibility.highContrast) {
      root.classList.add("high-contrast");
    } else {
      root.classList.remove("high-contrast");
    }
    
    // Apply text size
    root.classList.remove("text-normal", "text-large", "text-xlarge");
    root.classList.add(`text-${accessibility.textSize}`);
    
    localStorage.setItem("hazard-scout-theme", theme);
    localStorage.setItem("hazard-scout-accessibility", JSON.stringify(accessibility));
  }, [theme, accessibility]);

  const toggleTheme = () => {
    setThemeState(prev => prev === "dark" ? "light" : "dark");
  };

  const setTheme = (newTheme: Theme) => {
    setThemeState(newTheme);
  };

  const updateAccessibility = (settings: Partial<AccessibilitySettings>) => {
    setAccessibility(prev => ({ ...prev, ...settings }));
  };

  return (
    <ThemeContext.Provider value={{ theme, toggleTheme, setTheme, accessibility, updateAccessibility }}>
      {children}
    </ThemeContext.Provider>
  );
}

export function useTheme() {
  const context = useContext(ThemeContext);
  if (context === undefined) {
    throw new Error("useTheme must be used within a ThemeProvider");
  }
  return context;
}

import { useEffect, useRef } from 'react';
import { notificationService, HazardNotificationData } from './NotificationService';

interface HazardData {
  id: string;
  type: string;
  severity: 'high' | 'medium' | 'low';
  distance: string; // e.g., "300m", "1.2km"
  location: string;
  latitude?: number;
  longitude?: number;
}

// Convert distance string to meters
function parseDistanceToMeters(distance: string): number {
  const match = distance.match(/^([\d.]+)(m|km)$/);
  if (!match) return 0;
  
  const value = parseFloat(match[1]);
  const unit = match[2];
  
  return unit === 'km' ? value * 1000 : value;
}

// Convert HazardData to HazardNotificationData
function convertToNotificationData(hazard: HazardData): HazardNotificationData {
  return {
    id: hazard.id,
    type: hazard.type,
    severity: hazard.severity,
    distance: parseDistanceToMeters(hazard.distance),
    location: hazard.location,
    latitude: hazard.latitude,
    longitude: hazard.longitude,
  };
}

export function useHazardNotifications(hazards: HazardData[]) {
  const previousHazardsRef = useRef<Set<string>>(new Set());
  const checkIntervalRef = useRef<NodeJS.Timeout | null>(null);

  useEffect(() => {
    // Check hazards immediately
    checkHazardsForNotifications();

    // Set up periodic checking (every 5 seconds)
    checkIntervalRef.current = setInterval(() => {
      checkHazardsForNotifications();
    }, 5000);

    return () => {
      if (checkIntervalRef.current) {
        clearInterval(checkIntervalRef.current);
      }
    };
  }, [hazards]);

  const checkHazardsForNotifications = async () => {
    const currentHazardIds = new Set(hazards.map(h => h.id));
    
    // Check for new or updated hazards
    const notificationData = hazards.map(convertToNotificationData);
    await notificationService.checkHazards(notificationData);

    // Clean up notified hazards that no longer exist (resolved)
    previousHazardsRef.current.forEach(hazardId => {
      if (!currentHazardIds.has(hazardId)) {
        notificationService.clearNotifiedHazard(hazardId);
      }
    });

    previousHazardsRef.current = currentHazardIds;
  };
}

// Test notification function for settings screen
export async function testHazardNotification(): Promise<void> {
  const testHazard: HazardNotificationData = {
    id: 'test-' + Date.now(),
    type: 'Pothole',
    severity: 'high',
    distance: 500, // 500m
    location: 'Test Road, Downtown',
  };

  await notificationService.notifyHazard(testHazard);
}

import { Activity, MapPin, ShieldAlert, Circle, CheckCircle2, AlertTriangle, Navigation, Battery, Droplet, Settings, ChevronRight, Fuel } from "lucide-react";
import { Card, CardContent, CardHeader } from "./ui/card";
import { Badge } from "./ui/badge";
import { Switch } from "./ui/switch";
import { Progress } from "./ui/progress";
import { useState } from "react";
import { Vehicle } from "../types/vehicle";

interface VehicleStatusScreenProps {
  onNavigateToSettings: () => void;
  vehicle: Vehicle;
}

export function VehicleStatusScreen({ onNavigateToSettings, vehicle }: VehicleStatusScreenProps) {
  const [antiTheftEnabled, setAntiTheftEnabled] = useState(true);
  const [geofencingEnabled, setGeofencingEnabled] = useState(true);
  const [hazardScoutEnabled, setHazardScoutEnabled] = useState(true);

  return (
    <div className="min-h-screen bg-[#FDFAF9] dark:bg-slate-950 pb-20 sm:pb-24">
      {/* Header */}
      <div className="bg-gradient-to-b from-white to-[#FDFAF9] dark:from-slate-900 dark:to-slate-950 px-4 pt-6 pb-4">
        <h1 className="text-[#1F2F57] dark:text-slate-100 text-xl mb-1">Vehicle Status</h1>
        <p className="text-[#484B6A] dark:text-slate-400 text-sm">VW {vehicle.model}  {vehicle.plateNumber}</p>
      </div>

      {/* Overall Health Score */}
      <div className="px-4 -mt-2">
        <Card className="bg-green-50 dark:bg-slate-900/90 border-green-200 dark:border-slate-700/50">
          <CardContent className="p-6">
            <div className="flex items-center justify-between mb-4">
              <div>
                <h3 className="text-[#1F2F57] dark:text-slate-100 text-lg mb-1">Health Score</h3>
                <p className="text-[#484B6A] dark:text-slate-400 text-sm">All systems working normally</p>
              </div>
              <div className="relative w-20 h-20">
                <svg className="w-20 h-20 transform -rotate-90">
                  <circle
                    cx="40"
                    cy="40"
                    r="34"
                    stroke="currentColor"
                    strokeWidth="6"
                    fill="none"
                    className="text-slate-300 dark:text-slate-700"
                  />
                  <circle
                    cx="40"
                    cy="40"
                    r="34"
                    stroke="currentColor"
                    strokeWidth="6"
                    fill="none"
                    strokeDasharray="213.63"
                    strokeDashoffset="21.36"
                    className="text-green-600 dark:text-green-400"
                  />
                </svg>
                <div className="absolute inset-0 flex items-center justify-center">
                  <span className="text-green-600 dark:text-green-400 text-xl">90</span>
                </div>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Road Impact Score */}
      <div className="px-4 mt-4">
        <Card className="bg-gradient-to-br from-red-50 to-orange-50 dark:from-red-900/20 dark:to-orange-900/20 border-red-300 dark:border-red-700/50 shadow-lg">
          <CardContent className="p-4">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="w-12 h-12 rounded-full bg-red-100 dark:bg-red-500/20 flex items-center justify-center animate-pulse">
                  <Activity className="w-6 h-6 text-red-600 dark:text-red-400" />
                </div>
                <div>
                  <p className="text-[#1F2F57] dark:text-slate-200 mb-1">Road Impact Score</p>
                  <p className="text-[#484B6A] dark:text-slate-400 text-xs">High severity hazards detected</p>
                </div>
              </div>
              <div className="text-right">
                <p className="text-red-600 dark:text-red-400">High Impact</p>
                <div className="flex items-center gap-1 mt-1">
                  <div className="w-2.5 h-2.5 rounded-full bg-red-400 animate-pulse"></div>
                  <div className="w-2.5 h-2.5 rounded-full bg-red-400 animate-pulse"></div>
                  <div className="w-2.5 h-2.5 rounded-full bg-red-400"></div>
                  <div className="w-2.5 h-2.5 rounded-full bg-red-400"></div>
                  <div className="w-2.5 h-2.5 rounded-full bg-red-400"></div>
                </div>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Vehicle Health Report */}
      <div className="px-4 mt-6">
        <h3 className="text-[#9394a5] dark:text-slate-300 text-sm mb-3">System Checks</h3>
        <div className="space-y-3">
          {/* Tire Pressure */}
          <Card className="bg-white dark:bg-slate-900/90 border-slate-200 dark:border-slate-700/50">
            <CardContent className="p-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center">
                    <Circle className="w-5 h-5 text-green-400" />
                  </div>
                  <div>
                    <p className="text-[#1F2F57] dark:text-slate-200 text-sm">Tire Pressure</p>
                    <p className="text-[#9394a5] dark:text-slate-400 text-xs">All tires are properly inflated</p>
                  </div>
                </div>
                <CheckCircle2 className="w-5 h-5 text-green-400" />
              </div>
              <div className="mt-4 grid grid-cols-4 gap-2">
                <div className="text-center">
                  <p className="text-[#9394a5] dark:text-slate-400 text-xs mb-1">FL</p>
                  <p className="text-[#1F2F57] dark:text-slate-200 text-sm">32 PSI</p>
                </div>
                <div className="text-center">
                  <p className="text-[#9394a5] dark:text-slate-400 text-xs mb-1">FR</p>
                  <p className="text-[#1F2F57] dark:text-slate-200 text-sm">32 PSI</p>
                </div>
                <div className="text-center">
                  <p className="text-[#9394a5] dark:text-slate-400 text-xs mb-1">RL</p>
                  <p className="text-[#1F2F57] dark:text-slate-200 text-sm">30 PSI</p>
                </div>
                <div className="text-center">
                  <p className="text-[#9394a5] dark:text-slate-400 text-xs mb-1">RR</p>
                  <p className="text-[#1F2F57] dark:text-slate-200 text-sm">30 PSI</p>
                </div>
              </div>
            </CardContent>
          </Card>

          {/* Oil Level - Only for ICE vehicles */}
          {vehicle.type !== 'electric' && (
            <Card className="bg-white dark:bg-slate-900/90 border-slate-200 dark:border-slate-700/50">
              <CardContent className="p-4">
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <div className="w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center">
                      <Droplet className="w-5 h-5 text-green-400" />
                    </div>
                    <div>
                      <p className="text-[#1F2F57] dark:text-slate-200 text-sm">Engine Oil</p>
                      <p className="text-[#9394a5] dark:text-slate-400 text-xs">Healthy - Change due in 3,200 km</p>
                    </div>
                  </div>
                  <CheckCircle2 className="w-5 h-5 text-green-400" />
                </div>
                <div className="mt-3">
                  <Progress value={85} className="h-2 bg-slate-200 dark:bg-slate-800" />
                  <p className="text-[#9394a5] dark:text-slate-400 text-xs mt-1">85% life remaining</p>
                </div>
              </CardContent>
            </Card>
          )}

          {/* Fuel Level - Only for ICE vehicles */}
          {vehicle.type !== 'electric' && (
            <Card className="bg-white dark:bg-slate-900/90 border-slate-200 dark:border-slate-700/50">
              <CardContent className="p-4">
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <div className="w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center">
                      <Fuel className="w-5 h-5 text-green-400" />
                    </div>
                    <div>
                      <p className="text-[#1F2F57] dark:text-slate-200 text-sm">Fuel Level</p>
                      <p className="text-[#9394a5] dark:text-slate-400 text-xs">{vehicle.fuelLevel}% - ~{Math.round(vehicle.fuelLevel * 6)} km range</p>
                    </div>
                  </div>
                  <CheckCircle2 className="w-5 h-5 text-green-400" />
                </div>
                <div className="mt-3">
                  <Progress value={vehicle.fuelLevel} className="h-2 bg-slate-200 dark:bg-slate-800" />
                  <p className="text-[#9394a5] dark:text-slate-400 text-xs mt-1">{vehicle.fuelLevel}% capacity</p>
                </div>
              </CardContent>
            </Card>
          )}

          {/* High Voltage Traction Battery - Only for EV */}
          {vehicle.type === 'electric' && (
            <Card className="bg-gradient-to-br from-[#0070E1]/10 to-blue-500/10 border-[#0070E1]/30">
              <CardContent className="p-4">
                <div className="flex items-center justify-between mb-4">
                  <div className="flex items-center gap-3">
                    <div className="w-10 h-10 rounded-full bg-[#0070E1]/20 flex items-center justify-center">
                      <Battery className="w-5 h-5 text-[#0070E1]" />
                    </div>
                    <div>
                      <p className="text-[#1F2F57] dark:text-slate-200 text-sm">High Voltage Battery</p>
                      <p className="text-[#9394a5] dark:text-slate-400 text-xs">{vehicle.fuelLevel}% - {vehicle.range} km range</p>
                    </div>
                  </div>
                  <CheckCircle2 className="w-5 h-5 text-green-400" />
                </div>
                <div className="mb-3">
                  <Progress value={vehicle.fuelLevel} className="h-2 bg-slate-200 dark:bg-slate-800" />
                  <p className="text-[#9394a5] dark:text-slate-400 text-xs mt-1">{vehicle.fuelLevel}% charge</p>
                </div>
                <div className="grid grid-cols-2 gap-2">
                  <div className="bg-slate-100 dark:bg-slate-800/50 rounded-lg p-2 border border-slate-200 dark:border-slate-700/30">
                    <p className="text-[#9394a5] dark:text-slate-400 text-xs mb-0.5">Battery Temp</p>
                    <p className="text-[#1F2F57] dark:text-slate-200 text-sm">28C</p>
                  </div>
                  <div className="bg-slate-100 dark:bg-slate-800/50 rounded-lg p-2 border border-slate-200 dark:border-slate-700/30">
                    <p className="text-[#9394a5] dark:text-slate-400 text-xs mb-0.5">Next Charge</p>
                    <p className="text-[#1F2F57] dark:text-slate-200 text-sm">11PM</p>
                  </div>
                </div>
              </CardContent>
            </Card>
          )}

          {/* 12V Auxiliary Battery - Show for all vehicles */}
          <Card className="bg-white dark:bg-slate-900/90 border-slate-200 dark:border-slate-700/50">
            <CardContent className="p-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center">
                    <Battery className="w-5 h-5 text-green-400" />
                  </div>
                  <div>
                    <p className="text-[#1F2F57] dark:text-slate-200 text-sm">12V Auxiliary Battery</p>
                    <p className="text-[#9394a5] dark:text-slate-400 text-xs">
                      {vehicle.type === 'electric' ? 'Powers accessories & electronics' : 'Powers starter & electronics'}
                    </p>
                  </div>
                </div>
                <CheckCircle2 className="w-5 h-5 text-green-400" />
              </div>
              <div className="mt-3">
                <Progress value={92} className="h-2 bg-slate-200 dark:bg-slate-800" />
                <p className="text-[#9394a5] dark:text-slate-400 text-xs mt-1">92% health  12.4V</p>
              </div>
            </CardContent>
          </Card>
        </div>
      </div>

      {/* Location Card */}
      <div className="px-4 mt-6">
        <h3 className="text-[#9394a5] dark:text-slate-300 text-sm mb-3">Vehicle Location</h3>
        <Card className="bg-white dark:bg-slate-900/90 border-slate-200 dark:border-slate-700/50 overflow-hidden">
          <div className="h-32 bg-gradient-to-br from-slate-200 to-slate-300 dark:from-slate-800 dark:to-slate-900 relative flex items-center justify-center">
            <MapPin className="w-12 h-12 text-[#0070E1]" />
            {/* Placeholder for map */}
            <div className="absolute inset-0 opacity-20 bg-[linear-gradient(rgba(0,112,225,0.1)_1px,transparent_1px),linear-gradient(90deg,rgba(0,112,225,0.1)_1px,transparent_1px)] bg-[size:20px_20px]" />
          </div>
          <CardContent className="p-4">
            <div className="flex items-start gap-3">
              <Navigation className="w-5 h-5 text-[#0070E1] mt-0.5" />
              <div className="flex-1">
                <p className="text-[#1F2F57] dark:text-slate-200 text-sm mb-1">Connaught Place Parking</p>
                <p className="text-[#9394a5] dark:text-slate-400 text-xs">New Delhi, India</p>
                <p className="text-[#A8A8A8] dark:text-slate-500 text-xs mt-2">Parked 2 hours ago</p>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Security Monitoring */}
      <div className="px-4 mt-6">
        <h3 className="text-[#9394a5] dark:text-slate-300 text-sm mb-3">Security & Alerts</h3>
        <div className="space-y-3">
          {/* Geo-fencing */}
          <Card className="bg-white dark:bg-slate-900/90 border-slate-200 dark:border-slate-700/50">
            <CardContent className="p-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-full bg-[#0070E1]/20 flex items-center justify-center">
                    <MapPin className="w-5 h-5 text-[#0070E1]" />
                  </div>
                  <div>
                    <p className="text-[#1F2F57] dark:text-slate-200 text-sm">Location Alerts</p>
                    <p className="text-[#9394a5] dark:text-slate-400 text-xs">
                      {geofencingEnabled ? "Alert me if vehicle leaves area" : "Off"}
                    </p>
                  </div>
                </div>
                <Switch
                  checked={geofencingEnabled}
                  onCheckedChange={setGeofencingEnabled}
                />
              </div>
            </CardContent>
          </Card>

          {/* Anti-Theft Alarm */}
          <Card className="bg-white dark:bg-slate-900/90 border-slate-200 dark:border-slate-700/50">
            <CardContent className="p-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-full bg-red-500/20 flex items-center justify-center">
                    <ShieldAlert className="w-5 h-5 text-red-400" />
                  </div>
                  <div>
                    <p className="text-[#1F2F57] dark:text-slate-200 text-sm">Theft Alerts</p>
                    <p className="text-[#9394a5] dark:text-slate-400 text-xs">
                      {antiTheftEnabled ? "Notify me of suspicious activity" : "Off"}
                    </p>
                  </div>
                </div>
                <Switch
                  checked={antiTheftEnabled}
                  onCheckedChange={setAntiTheftEnabled}
                />
              </div>
            </CardContent>
          </Card>

          {/* Hazard Scout Data Contribution */}
          <Card className="bg-white dark:bg-slate-900/90 border-slate-200 dark:border-slate-700/50">
            <CardContent className="p-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-full bg-[#0070E1]/20 flex items-center justify-center">
                    <ShieldAlert className="w-5 h-5 text-[#0070E1]" />
                  </div>
                  <div>
                    <p className="text-[#1F2F57] dark:text-slate-200 text-sm">Share Hazard Data</p>
                    <p className="text-[#9394a5] dark:text-slate-400 text-xs">
                      {hazardScoutEnabled ? "Helping other drivers" : "Paused"}
                    </p>
                  </div>
                </div>
                <Switch
                  checked={hazardScoutEnabled}
                  onCheckedChange={setHazardScoutEnabled}
                />
              </div>
            </CardContent>
          </Card>

          {/* Hazard Scout Settings Link */}
          <button 
            onClick={onNavigateToSettings}
            className="w-full"
          >
            <Card className="bg-white dark:bg-slate-900/90 border-slate-200 dark:border-slate-700/50 hover:bg-slate-50 dark:hover:bg-slate-800/90 hover:border-[#0070E1]/50 transition-all cursor-pointer">
              <CardContent className="p-4">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-full bg-slate-200 dark:bg-slate-700/50 flex items-center justify-center">
                    <Settings className="w-5 h-5 text-[#484B6A] dark:text-slate-400" />
                  </div>
                  <div className="flex-1 text-left">
                    <p className="text-[#1F2F57] dark:text-slate-200 text-sm">Hazard Scout Settings</p>
                    <p className="text-[#9394a5] dark:text-slate-400 text-xs">Configure detection & alerts</p>
                  </div>
                  <ChevronRight className="w-5 h-5 text-[#A8A8A8] dark:text-slate-500" />
                </div>
              </CardContent>
            </Card>
          </button>
        </div>
      </div>


    </div>
  );
}
import { useState, useEffect } from "react";
import { DashboardScreen } from "./DashboardScreen";
import { VehicleStatusScreen } from "./VehicleStatusScreen";
import { SafetyScoutScreen } from "./SafetyScoutScreen";
import { ServiceScreen } from "./ServiceScreen";
import { AccountScreen } from "./AccountScreen";
import { HazardScoutSettingsScreen } from "./HazardScoutSettingsScreen";
import { BottomNavigation } from "./BottomNavigation";
import { useHazardNotifications } from "./useHazardNotifications";
import { hazardService } from "./HazardService";
import { Vehicle } from "../types/vehicle";

type Tab = "home" | "status" | "scout" | "service" | "account";
type Screen = Tab | "hazard-settings";

interface VWConnectAppProps {
  onLogout: () => void;
}

export function VWConnectApp({ onLogout }: VWConnectAppProps) {
  const [activeTab, setActiveTab] = useState<Tab>("home");
  const [currentScreen, setCurrentScreen] = useState<Screen>("home");

  // Centralized vehicle state
  const [vehicles] = useState<Vehicle[]>([
    {
      id: '1',
      name: 'My Electric',
      model: 'ID.4',
      plateNumber: 'DL 01 AB 1234',
      type: 'electric',
      fuelLevel: 85,
      mileage: 8450,
      range: 340,
      imageUrl: 'https://assets.volkswagen.com/is/image/volkswagenag/ID4-banner1-1920x1080?Zml0PWNyb3AsMSZmbXQ9d2VicCZxbHQ9Nzkmd2lkPTE5MjAmaGVpPTEwODAmYWxpZ249MC4wMCwwLjAwJmJmYz1vZmYmM2E1Nw==',
      isLocked: true
    },
    {
      id: '2',
      name: 'Family Sedan',
      model: 'Virtus',
      plateNumber: 'DL 02 CD 5678',
      type: 'petrol',
      fuelLevel: 72,
      mileage: 12450,
      imageUrl: 'https://assets.volkswagen.com/is/image/volkswagenag/exterior-integrator-led-lamps?Zml0PWNyb3AsMSZmbXQ9d2VicCZxbHQ9Nzkmd2lkPTk2MCZhbGlnbj0wLjAwLDAuMDAmYmZjPW9mZiZhZTFl',
      isLocked: true
    },
    {
      id: '3',
      name: 'Weekend SUV',
      model: 'Tiguan',
      plateNumber: 'DL 03 EF 9012',
      type: 'diesel',
      fuelLevel: 68,
      mileage: 24680,
      imageUrl: 'https://assets.volkswagen.com/is/image/volkswagenag/beyond-bolder-1?Zml0PWNyb3AsMSZmbXQ9d2VicCZxbHQ9Nzkmd2lkPTE5MjAmYWxpZ249MC4wMCwwLjAwJmJmYz1vZmYmNzgwOQ==',
      isLocked: false
    }
  ]);

  const [selectedVehicleId, setSelectedVehicleId] = useState<string>('1');

  const selectedVehicle = vehicles.find(v => v.id === selectedVehicleId) || vehicles[0];

  // Initialize sample hazards on first load
  useEffect(() => {
    const existingHazards = hazardService.getActiveHazards();
    
    // Only add sample hazards if none exist
    if (existingHazards.length === 0) {
      // **DEMO-READY HAZARDS** - Strategically placed for controlled demonstration
      const demoHazards = [
        // **Scene 1: Circle Marker (Your Car) - For Resolution Demo**
        {
          type: 'Pothole',
          severity: 'high' as const,
          location: { latitude: 12.9650, longitude: 80.2250 },
          locationName: 'Madipakkam Main Road Junction',
          distance: '800m',
          source: 'your-car' as const, // CIRCLE MARKER
          autoResolveAfterHours: 24,
          requireConfirmationsForResolution: 3
        },
        
        // **Scene 2: Triangle Marker (Network) - For Proximity Alert & Resolution**
        {
          type: 'Debris',
          severity: 'medium' as const,
          location: { latitude: 12.9620, longitude: 80.2300 },
          locationName: 'Velachery Bypass Road',
          distance: '1.2km',
          source: 'network' as const, // TRIANGLE MARKER
          autoResolveAfterHours: 24,
          requireConfirmationsForResolution: 3
        },
        
        // **Scene 4: Square Marker (V2X) - For Network Proof**
        {
          type: 'Road Work',
          severity: 'high' as const,
          location: { latitude: 12.9595, longitude: 80.2370 },
          locationName: 'OMR - Velachery Bypass',
          distance: '2.0km',
          source: 'v2x' as const, // SQUARE MARKER
          autoResolveAfterHours: 48,
          requireConfirmationsForResolution: 3
        },
        
        // Additional hazards along Chennai route for navigation demo
        {
          type: 'Speed Bump',
          severity: 'low' as const,
          location: { latitude: 12.9612, longitude: 80.2429 },
          locationName: 'Perungudi Industrial Estate',
          distance: '2.5km',
          source: 'network' as const,
          autoResolveAfterHours: 24,
          requireConfirmationsForResolution: 3
        },
        {
          type: 'Uneven Surface',
          severity: 'medium' as const,
          location: { latitude: 12.9750, longitude: 80.1950 },
          locationName: 'Pallavaram - Inner Ring Road Junction',
          distance: '3.5km',
          source: 'your-car' as const,
          autoResolveAfterHours: 24,
          requireConfirmationsForResolution: 3
        }
      ];

      demoHazards.forEach(hazard => {
        hazardService.addHazard(hazard);
      });

      // **Pre-simulate some confirmations for realism**
      const hazards = hazardService.getActiveHazards();
      if (hazards.length > 0) {
        // Simulate detection count increases on first hazard (Your Car)
        hazardService.incrementDetectionCount(hazards[0].id);
        hazardService.incrementDetectionCount(hazards[0].id);
        
        // Add 1 "gone" report to Triangle marker for demo progression (2/3 needed)
        if (hazards.length > 1) {
          hazardService.reportHazardGone(hazards[1].id);
        }
      }
    }
  }, []);

  // Get active hazards for notification monitoring
  const activeHazards = hazardService.getActiveHazards().map(h => ({
    id: h.id,
    type: h.type,
    severity: h.severity,
    distance: h.distance || '0m',
    location: h.locationName,
    latitude: h.location.latitude,
    longitude: h.location.longitude,
  }));

  // Monitor hazards and trigger notifications when appropriate
  useHazardNotifications(activeHazards);

  const handleTabChange = (tab: Tab) => {
    setActiveTab(tab);
    setCurrentScreen(tab);
  };

  const navigateToHazardSettings = () => {
    setCurrentScreen("hazard-settings");
  };

  const navigateBack = () => {
    setCurrentScreen(activeTab);
  };

  const showBottomNav = currentScreen !== "hazard-settings";

  return (
    <div className="min-h-screen bg-slate-950">
      {/* Content */}
      <div className="relative">
        {currentScreen === "home" && (
          <DashboardScreen 
            onNavigateToScout={() => handleTabChange("scout")}
            vehicles={vehicles}
            selectedVehicleId={selectedVehicleId}
            onSelectVehicle={setSelectedVehicleId}
          />
        )}
        {currentScreen === "status" && (
          <VehicleStatusScreen 
            onNavigateToSettings={navigateToHazardSettings}
            vehicle={selectedVehicle}
          />
        )}
        {currentScreen === "scout" && <SafetyScoutScreen onNavigateToSettings={navigateToHazardSettings} />}
        {currentScreen === "service" && (
          <ServiceScreen 
            vehicle={selectedVehicle}
          />
        )}
        {currentScreen === "account" && (
          <AccountScreen 
            onLogout={onLogout} 
            onNavigateToSettings={navigateToHazardSettings}
            vehicles={vehicles}
          />
        )}
        {currentScreen === "hazard-settings" && <HazardScoutSettingsScreen onBack={navigateBack} />}
      </div>

      {/* Bottom Navigation */}
      {showBottomNav && <BottomNavigation activeTab={activeTab} onTabChange={handleTabChange} />}
    </div>
  );
}
// Google Maps TypeScript declarations
// These are minimal declarations for the features used in this app

declare global {
  interface Window {
    google: typeof google;
  }
}

declare namespace google.maps {
  class Map {
    constructor(mapDiv: Element, opts?: MapOptions);
    setCenter(latlng: LatLng | LatLngLiteral): void;
    setZoom(zoom: number): void;
    getCenter(): LatLng;
    getZoom(): number;
  }

  interface MapOptions {
    center?: LatLng | LatLngLiteral;
    zoom?: number;
    styles?: MapTypeStyle[];
    disableDefaultUI?: boolean;
    zoomControl?: boolean;
    mapTypeControl?: boolean;
    streetViewControl?: boolean;
    fullscreenControl?: boolean;
  }

  interface MapTypeStyle {
    elementType?: string;
    featureType?: string;
    stylers?: Array<{ [key: string]: string | number }>;
  }

  class Marker {
    constructor(opts?: MarkerOptions);
    setMap(map: Map | null): void;
  }

  interface MarkerOptions {
    position?: LatLng | LatLngLiteral;
    map?: Map;
    icon?: string | Icon | Symbol;
    title?: string;
  }

  interface Icon {
    url: string;
    scaledSize?: Size;
  }

  interface Symbol {
    path: SymbolPath | string;
    scale?: number;
    fillColor?: string;
    fillOpacity?: number;
    strokeColor?: string;
    strokeWeight?: number;
  }

  enum SymbolPath {
    CIRCLE = 0,
    FORWARD_CLOSED_ARROW = 1,
    FORWARD_OPEN_ARROW = 2,
    BACKWARD_CLOSED_ARROW = 3,
    BACKWARD_OPEN_ARROW = 4,
  }

  class LatLng {
    constructor(lat: number, lng: number);
    lat(): number;
    lng(): number;
  }

  interface LatLngLiteral {
    lat: number;
    lng: number;
  }

  class Size {
    constructor(width: number, height: number);
  }

  class Polyline {
    constructor(opts?: PolylineOptions);
    setMap(map: Map | null): void;
  }

  interface PolylineOptions {
    path?: LatLng[] | LatLngLiteral[];
    strokeColor?: string;
    strokeOpacity?: number;
    strokeWeight?: number;
    geodesic?: boolean;
    map?: Map;
  }

  class OverlayView {
    onAdd(): void;
    draw(): void;
    onRemove(): void;
    setMap(map: Map | null): void;
    getMap(): Map | null;
    getPanes(): MapPanes | null;
    getProjection(): MapCanvasProjection;
  }

  interface MapPanes {
    floatPane: Element;
    mapPane: Element;
    markerLayer: Element;
    overlayLayer: Element;
    overlayMouseTarget: Element;
  }

  interface MapCanvasProjection {
    fromLatLngToDivPixel(latLng: LatLng | LatLngLiteral): Point | null;
  }

  interface Point {
    x: number;
    y: number;
  }
}

export {};

// Type definitions for Mapbox GL JS
declare module 'mapbox-gl' {
  export interface MapboxOptions {
    container: string | HTMLElement;
    style: string;
    center?: [number, number];
    zoom?: number;
    pitch?: number;
    bearing?: number;
    attributionControl?: boolean;
  }

  export class Map {
    constructor(options: MapboxOptions);
    on(event: string, callback: () => void): this;
    addControl(control: any, position?: string): this;
    remove(): void;
    setBearing(bearing: number): void;
    scrollZoom: {
      disable(): void;
      enable(): void;
    };
    boxZoom: {
      disable(): void;
    };
    dragRotate: {
      disable(): void;
    };
    dragPan: {
      disable(): void;
    };
    keyboard: {
      disable(): void;
    };
    doubleClickZoom: {
      disable(): void;
    };
    touchZoomRotate: {
      disable(): void;
    };
  }

  export interface MarkerOptions {
    element?: HTMLElement;
    anchor?: string;
  }

  export class Marker {
    constructor(options?: MarkerOptions);
    setLngLat(lngLat: [number, number]): this;
    addTo(map: Map): this;
    remove(): void;
  }

  export class NavigationControl {
    constructor();
  }

  export let accessToken: string;
}

declare module 'mapbox-gl/dist/mapbox-gl.css' {
  const content: any;
  export default content;
}

export type VehicleType = 'electric' | 'petrol' | 'diesel';

export interface Vehicle {
  id: string;
  name: string;
  model: string;
  plateNumber: string;
  type: VehicleType;
  fuelLevel: number;
  mileage: number;
  range?: number; // Only for electric
  imageUrl: string;
  isLocked: boolean;
}

import { useState } from "react";
import { LoginScreen } from "./components/LoginScreen";
import { VWConnectApp } from "./components/VWConnectApp";
import { ThemeProvider } from "./components/ThemeProvider";
import { Toaster } from "./components/ui/sonner";

type Screen = "login" | "dashboard";

export default function App() {
  const [currentScreen, setCurrentScreen] = useState<Screen>("login");

  const handleAuthenticate = () => {
    setCurrentScreen("dashboard");
  };

  const handleLogout = () => {
    setCurrentScreen("login");
  };

  return (
    <ThemeProvider>
      {currentScreen === "login" && (
        <LoginScreen onAuthenticate={handleAuthenticate} />
      )}
      {currentScreen === "dashboard" && (
        <VWConnectApp onLogout={handleLogout} />
      )}
      <Toaster position="top-center" />
    </ThemeProvider>
  );
}


  import { createRoot } from "react-dom/client";
  import App from "./App.tsx";
  import "./index.css";

  createRoot(document.getElementById("root")!).render(<App />);
  
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from 'path'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./"),
    },
  },
  server: {
    port: 3000,
    open: true,
  },
})

